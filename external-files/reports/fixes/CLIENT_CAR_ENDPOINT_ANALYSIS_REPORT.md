# –ê–Ω–∞–ª–∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤

## üéØ –¶–µ–ª—å –∞–Ω–∞–ª–∏–∑–∞
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ –±—ç–∫–µ–Ω–¥–æ–º –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤ `GET/PUT /api/v1/clients/:client_id/cars/:id`

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π VIN - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–µ `vin` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ –≤ `car_params` –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –Ω–æ **–û–¢–°–£–¢–°–¢–í–û–í–ê–õ–û** –≤ —Å—Ö–µ–º–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `client_cars`!

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `:vin` –∏–∑ `car_params` –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `vin` –∏–∑ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (`ClientCar`, `ClientCarFormData`)
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ VIN –∏–∑ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—è VIN
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–µ `vin` –±–æ–ª—å—à–µ –Ω–µ –≤–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ.

### 2. üîÑ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö brand/model

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –±—ç–∫–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Ä–∫–∞–º–∏ –∏ –º–æ–¥–µ–ª—è–º–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π.

**–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
```typescript
interface ClientCarFormData {
  brand: string;        // –°—Ç—Ä–æ–∫–∞
  model: string;        // –°—Ç—Ä–æ–∫–∞
  year: number;
  vin: string;
  license_plate: string;
}
```

**–ë—ç–∫–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç:**
```ruby
def car_params
  params.require(:car).permit(
    :brand_id, :model_id,    # –ß–∏—Å–ª–æ–≤—ã–µ ID
    :year, :registration_number, :vin,
    :tire_r, :tire_width, :tire_height, 
    :name, :is_active
  )
end
```

**–°—Ö–µ–º–∞ –ë–î:**
```sql
create_table "client_cars" do |t|
  t.bigint "brand_id", null: false     # Foreign key
  t.bigint "model_id", null: false     # Foreign key
  -- ...
end
```

### 3. üìù –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ç–∫–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç, –Ω–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
- `registration_number` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä
- `tire_r`, `tire_width`, `tire_height` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∏–Ω
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ/–∏–º—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- `is_active` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏

**–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –ë–î, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**
- `tire_type_id` - ID —Ç–∏–ø–∞ —à–∏–Ω
- `tire_size` - —Ä–∞–∑–º–µ—Ä —à–∏–Ω
- `notes` - –∑–∞–º–µ—Ç–∫–∏
- `is_primary` - –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
- `car_type_id` - ID —Ç–∏–ø–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

### 4. üîß –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞

**–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
```javascript
// –ü—Ä—è–º–æ –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
{
  brand: "Toyota",
  model: "Camry",
  year: 2020,
  vin: "12345",
  license_plate: "AA1234BB"
}
```

**–ë—ç–∫–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç:**
```ruby
# –í –æ–±–µ—Ä—Ç–∫–µ :car
{
  car: {
    brand_id: 1,
    model_id: 5,
    year: 2020,
    registration_number: "12345",
    license_plate: "AA1234BB",
    is_active: true
  }
}
```

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**
```typescript
interface ClientCarFormData {
  brand_id: number;           // –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ —á–∏—Å–ª–æ–≤–æ–π ID
  model_id: number;           // –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ —á–∏—Å–ª–æ–≤–æ–π ID
  year: number;
  registration_number?: string; // –î–æ–±–∞–≤–∏—Ç—å
  license_plate: string;
  is_active?: boolean;        // –î–æ–±–∞–≤–∏—Ç—å
  // –£–¥–∞–ª–∏—Ç—å vin –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ë–î
}
```

2. **–î–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞—Ä–∫–∏ –∏ –º–æ–¥–µ–ª–∏:**
- –ó–∞–≥—Ä—É–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ —á–µ—Ä–µ–∑ `/api/v1/car_brands`
- –ó–∞–≥—Ä—É–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ `/api/v1/car_models` –∏–ª–∏ `/api/v1/car_brands/:brand_id/car_models`

3. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–∞:**
```javascript
const carData = {
  car: {
    brand_id: selectedBrandId,
    model_id: selectedModelId,
    year: formData.year,
    registration_number: formData.registration_number,
    license_plate: formData.license_plate,
    is_active: true
  }
};
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –±—ç–∫–µ–Ω–¥

1. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ VIN –≤ —Å—Ö–µ–º—É –ë–î:**
```ruby
# –ú–∏–≥—Ä–∞—Ü–∏—è
add_column :client_cars, :vin, :string
```

2. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö brand/model:**
```ruby
def car_params
  permitted = params.require(:car).permit(
    :brand_id, :model_id, :brand, :model,
    :year, :registration_number, :vin,
    :license_plate, :is_active
  )
  
  # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤ ID –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  if permitted[:brand].present?
    brand = CarBrand.find_or_create_by(name: permitted[:brand])
    permitted[:brand_id] = brand.id
  end
  
  if permitted[:model].present?
    model = CarModel.find_or_create_by(name: permitted[:model])
    permitted[:model_id] = model.id
  end
  
  permitted.except(:brand, :model)
end
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–í—ã–±–∏—Ä–∞–µ–º –í–∞—Ä–∏–∞–Ω—Ç 1** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, —Ç–∞–∫ –∫–∞–∫:

1. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ foreign keys –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –ë–î
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ò–∑–±–µ–≥–∞–µ–º –ø–æ–∏—Å–∫–∞/—Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
3. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
4. **UX:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∞ –Ω–µ –≤–≤–æ–¥–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç

## üìã –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ VIN –≤ —Å—Ö–µ–º—É –ë–î** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã TypeScript** –¥–ª—è ClientCarFormData
3. **–î–æ–±–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç—ã –±—Ä–µ–Ω–¥–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π** –≤ —Ñ–æ—Ä–º—É
4. **–û–±–Ω–æ–≤–∏—Ç—å API –∑–∞–ø—Ä–æ—Å—ã** –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
5. **–û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
6. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å –ø–æ–º–æ—â—å—é —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **Backend:** `tire-service-master-api/app/controllers/api/v1/cars_controller.rb`
- **Backend:** `tire-service-master-api/app/models/client_car.rb`
- **Frontend:** `tire-service-master-web/src/pages/clients/ClientCarFormPage.tsx`
- **Frontend:** `tire-service-master-web/src/api/clients.api.ts`
- **Frontend:** `tire-service-master-web/src/types/client.ts`
- **–¢–µ—Å—Ç:** `tire-service-master-web/external-files/testing/html/test_client_car_edit_endpoint.html`

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: 19.06.2025*
*–ê–≤—Ç–æ—Ä: AI Assistant* 