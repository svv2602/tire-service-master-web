# Отчет об исправлении проблемы с двойным нажатием при авторизации

## Проблема

При попытке входа в систему требовалось двойное нажатие на кнопку "Войти". Первое нажатие вызывало ошибку 500, а второе нажатие успешно авторизовывало пользователя.

## Анализ

1. Проблема была связана с двумя факторами:
   - Отсутствие поддержки cookies в Rails API (исправлено ранее)
   - Конфликт между interceptor в apiClient и запросом авторизации

2. При первом нажатии на кнопку "Войти":
   - Запрос отправлялся через apiClient
   - Interceptor пытался добавить токен из localStorage, который еще не существовал
   - Это приводило к ошибке 500 на сервере

3. При втором нажатии:
   - Запрос проходил успешно, так как первый запрос инициализировал сессию на сервере

## Решение

1. Изменен механизм отправки запроса авторизации:
   - Вместо apiClient используется чистый axios без интерцепторов
   - Добавлен параметр withCredentials: true для поддержки cookies
   - Добавлены правильные заголовки Content-Type

2. Код изменения в authSlice.ts:
```typescript
// Используем чистый axios без интерцепторов для авторизации
// чтобы избежать проблемы с двойным нажатием
const API_URL = `${config.API_URL}${config.API_PREFIX}`;
const response = await axios.post<LoginResponse>(
  `${API_URL}/auth/login`, 
  { email, password },
  { 
    withCredentials: true,
    headers: { 'Content-Type': 'application/json' }
  }
);
```

## Результат

1. Авторизация работает с первого нажатия на кнопку "Войти"
2. Система корректно сохраняет refresh токен в HttpOnly cookies
3. Access токен передается в ответе и сохраняется на клиенте
4. Отсутствуют ошибки 500 при авторизации

## Рекомендации

1. Рассмотреть возможность использования RTK Query для всех API запросов вместо прямых вызовов axios
2. Добавить более детальное логирование ошибок авторизации
3. Реализовать механизм автоматического обновления токена доступа при его истечении