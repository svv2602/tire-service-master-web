# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥ –≤ —Ñ–æ—Ä–º–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 30 –∏—é–Ω—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

## üö® –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/admin/bookings/8/edit`:
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ù–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –ø–æ–ª–µ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥" –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å –ø—É—Å—Ç—ã–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã–ª –∑–∞–Ω–æ–≤–æ –≤—ã–±–∏—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é

## üîç –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä–Ω–µ–≤—ã—Ö –ø—Ä–∏—á–∏–Ω

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è –≤ API –æ—Ç–≤–µ—Ç–µ
- –í `BookingSerializer` –Ω–µ –±—ã–ª–æ –ø–æ–ª—è `service_category_id`
- API –≤–æ–∑–≤—Ä–∞—â–∞–ª –¥–∞–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
- –í `booking_update_params` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –ø–∞—Ä–∞–º–µ—Ç—Ä `service_category_id`
- –ü–æ–ª–µ –Ω–µ –±—ã–ª–æ –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- –í `useEffect` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `booking.category_id`
- –ù–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `booking.service_category_id`

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1. –û–±–Ω–æ–≤–ª–µ–Ω BookingSerializer
```ruby
# tire-service-master-api/app/serializers/booking_serializer.rb
class BookingSerializer < ActiveModel::Serializer
  attributes :id, :client_id, :service_point_id, :car_id, :booking_date, :start_time, :end_time, 
             :status_id, :payment_status_id, :cancellation_reason_id, :cancellation_comment, 
             :total_price, :payment_method, :notes, :created_at, :updated_at, :car_type_id,
             :service_category_id, # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥
             :status, :payment_status, :service_point, :client, :car_type, :car,
             :car_brand, :car_model, :license_plate, :service_recipient, :is_guest_booking
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω BookingsController
```ruby
# tire-service-master-api/app/controllers/api/v1/bookings_controller.rb
def booking_update_params
  if current_user.admin? || current_user.partner? || current_user.manager?
    permitted_params += [
      :booking_date, :start_time, :end_time, :payment_status_id, 
      :payment_method, :total_price, :car_id, :car_type_id, :service_category_id, # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
      # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    ]
  end
end
```

### Frontend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ BookingFormPage.tsx
```typescript
// tire-service-master-web/src/pages/bookings/BookingFormPage.tsx
useEffect(() => {
  if (isEditMode && bookingData) {
    const booking = bookingData as any;
    
    formik.setFieldValue('car_type_id', booking.car_type_id || '');
    formik.setFieldValue('category_id', booking.service_category_id || ''); // ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
    
    // ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
    setCurrentServicePointId(Number(booking.service_point_id) || 0);
    setCurrentCategoryId(Number(booking.service_category_id) || 0); // ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  }
}, [isEditMode, bookingData, formik.setFieldValue, setServices]);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. –û—Ç–∫—Ä—ã—Ç—å `/admin/bookings/8/edit`
2. –í—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Å–ª—É–≥
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –ü–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
5. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö API
```json
{
  "id": 8,
  "service_category_id": 1,
  "service_point_id": 7,
  "car_type_id": 3,
  "booking_date": "2025-07-03",
  "start_time": "12:30",
  "end_time": "13:05",
  "notes": "...",
  "status_id": 1
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
```ruby
# app/models/booking.rb
belongs_to :service_category, optional: true
validate :service_category_matches_service_point, if: :service_category_id?
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

- **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞**
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ä–º—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- –£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É API –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend:
- `app/serializers/booking_serializer.rb`
- `app/controllers/api/v1/bookings_controller.rb`

### Frontend:
- `src/pages/bookings/BookingFormPage.tsx`

## üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ò–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤—ã–µ, —Ç–∞–∫ –∏ —Å—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã 