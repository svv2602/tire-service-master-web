# üéØ –û—Ç—á–µ—Ç: –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "–æ—Ç–∫–ª–æ–Ω–µ–Ω" –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤

**–î–∞—Ç–∞:** 24 –∏—é–Ω—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º—ã:** –°—Ç–∞—Ç—É—Å "–æ—Ç–∫–ª–æ–Ω–µ–Ω" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª, –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å, –∫–Ω–æ–ø–∫–∏ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª–∏

## üö® –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –°—Ç–∞—Ç—É—Å "rejected" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
- –ú–æ–¥–µ–ª—å Review –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ —Ç–æ–ª—å–∫–æ 'published' –∏–ª–∏ 'pending'
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —Å–ø–æ—Å–æ–± —Ä–∞–∑–ª–∏—á–∞—Ç—å "pending" –∏ "rejected" —Å—Ç–∞—Ç—É—Å—ã
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–º–µ–ª –ª–æ–≥–∏–∫—É –¥–ª—è rejected, –Ω–æ –º–æ–¥–µ–ª—å –µ—ë –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∞

### 2. UI –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /admin/reviews
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ (tooltips) –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å
- –ö–Ω–æ–ø–∫–∏ "–û–¥–æ–±—Ä–∏—Ç—å" –∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è (tire-service-master-api)

#### –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è status
ALTER TABLE reviews ADD COLUMN status VARCHAR DEFAULT 'published' NOT NULL;
CREATE INDEX ON reviews (status);

-- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
UPDATE reviews 
SET status = CASE 
  WHEN is_published = true THEN 'published'
  ELSE 'pending'
END;
```

#### –ú–æ–¥–µ–ª—å Review:
```ruby
class Review < ApplicationRecord
  # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
  validates :status, presence: true, inclusion: { in: %w[pending published rejected] }
  
  # –ù–æ–≤—ã–µ —Å–∫–æ—É–ø—ã
  scope :published, -> { where(status: 'published') }
  scope :pending, -> { where(status: 'pending') }
  scope :rejected, -> { where(status: 'rejected') }
  
  # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è is_published —Å status
  before_save :sync_is_published_with_status
  
  private
  
  def sync_is_published_with_status
    self.is_published = (status == 'published')
  end
end
```

#### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ReviewsController:
```ruby
# –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
if params[:status].present?
  @reviews = @reviews.where(status: params[:status])
end

# –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
@review = Review.new(
  rating: params[:review][:rating],
  comment: params[:review][:comment],
  client: client,
  service_point: service_point,
  status: params[:review][:status] || 'published'
)

# –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
if @review.update(review_params)
```

#### –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä:
```ruby
class ReviewSerializer < ActiveModel::Serializer
  attributes :id, :rating, :comment, :partner_response, :is_published, :status, :created_at, :updated_at
  
  # –£–±—Ä–∞–Ω–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ status - —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ –ë–î
end
```

### 2. Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è (tire-service-master-web)

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –∏ –∫–Ω–æ–ø–æ–∫:
```tsx
// –ó–∞–º–µ–Ω–µ–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ MUI
import { IconButton, Tooltip as MuiTooltip } from '@mui/material';

// –ü—Ä–æ—Å—Ç—ã–µ IconButton –≤–º–µ—Å—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö Button
{review.status === 'pending' && (
  <>
    <MuiTooltip title="–û–¥–æ–±—Ä–∏—Ç—å">
      <IconButton
        onClick={() => handleStatusChange(review, 'published')}
        size="small"
        sx={{
          '&:hover': {
            backgroundColor: `${theme.palette.success.main}15`
          }
        }}
      >
        <CheckIcon color="success" />
      </IconButton>
    </MuiTooltip>
    <MuiTooltip title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">
      <IconButton
        onClick={() => handleStatusChange(review, 'rejected')}
        size="small"
        sx={{
          '&:hover': {
            backgroundColor: `${theme.palette.error.main}15`
          }
        }}
      >
        <CloseIcon color="error" />
      </IconButton>
    </MuiTooltip>
  </>
)}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª:
`tire-service-master-api/external-files/testing/test_review_rejected_status.html`

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤ —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º status
3. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ "rejected"
4. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É "rejected"
5. ‚úÖ –¢–µ—Å—Ç —Å–º–µ–Ω—ã –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (pending ‚Üí published ‚Üí rejected)

### API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ rejected
curl -X PATCH http://localhost:8000/api/v1/reviews/10 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"review":{"status":"rejected"}}'

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
curl "http://localhost:8000/api/v1/reviews?status=rejected" \
  -H "Authorization: Bearer $TOKEN"
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–°—Ç–∞—Ç—É—Å "rejected"** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
2. **–ü–æ–¥—Å–∫–∞–∑–∫–∏** - –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
3. **–ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π** - "–û–¥–æ–±—Ä–∏—Ç—å" –∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å" —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –ø–æ –≤—Å–µ–º —Ç—Ä–µ–º —Å—Ç–∞—Ç—É—Å–∞–º (pending, published, rejected)
5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤
6. **API** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- –ü–æ–ª–µ `status` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –ë–î —Å –∏–Ω–¥–µ–∫—Å–æ–º
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø–æ–ª–µ–º `is_published` —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- UI –æ–±–Ω–æ–≤–ª–µ–Ω —Å —Ä–∞–±–æ—á–∏–º–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –∏ –∫–Ω–æ–ø–∫–∞–º–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–∏–≥—Ä–∞—Ü–∏—è:
- **–§–∞–π–ª:** `20250624094659_add_status_to_reviews.rb`
- **–ü–æ–ª–µ:** `status VARCHAR DEFAULT 'published' NOT NULL`
- **–ò–Ω–¥–µ–∫—Å:** `CREATE INDEX ON reviews (status)`

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `app/models/review.rb` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
2. `app/controllers/api/v1/reviews_controller.rb` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞
3. `app/serializers/review_serializer.rb` - —É–±—Ä–∞–Ω–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
4. `src/pages/reviews/ReviewsPage.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ö–æ–º–º–∏—Ç—ã:
- **Backend:** –ú–∏–≥—Ä–∞—Ü–∏—è –∏ –º–æ–¥–µ–ª—å
- **Frontend:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –æ–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–û–±—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω–∞–º

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–∞ "–æ—Ç–∫–ª–æ–Ω–µ–Ω" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–∑—ã–≤–æ–≤ —Å –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. 