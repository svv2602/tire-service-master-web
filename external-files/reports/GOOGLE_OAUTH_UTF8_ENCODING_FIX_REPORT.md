# üîß –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8 –≤ Google OAuth

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google OAuth –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –≤ –∏–º–µ–Ω–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üîç –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. FRONTEND –ø—Ä–æ–±–ª–µ–º—ã:
- –§—É–Ω–∫—Ü–∏—è `atob()` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–ª–∞ UTF-8 —Å–∏–º–≤–æ–ª—ã –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —è–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8 –≤ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ JWT payload

### 2. BACKEND –ø—Ä–æ–±–ª–µ–º—ã:
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∏–º–µ–Ω
- –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è UTF-8 –æ—Ç–≤–µ—Ç–æ–≤
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### Frontend (`GoogleLoginButton.tsx`):

#### 1. –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è UTF-8:
```typescript
const decodeBase64UTF8 = (base64String: string): string => {
  try {
    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64 –≤ binary string
    const binaryString = atob(base64String);
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º binary string –≤ UTF-8
    const bytes = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    
    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º UTF-8 bytes –≤ —Å—Ç—Ä–æ–∫—É
    const decoder = new TextDecoder('utf-8');
    return decoder.decode(bytes);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è UTF-8:', error);
    return atob(base64String); // Fallback
  }
};
```

#### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è UTF-8 —Å—Ç—Ä–æ–∫:
```typescript
const normalizeUTF8 = (str: string): string => {
  if (!str) return '';
  try {
    return decodeURIComponent(escape(str));
  } catch {
    return str;
  }
};
```

#### 3. –Ø–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ UTF-8 –≤ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö:
```typescript
headers: {
  'Content-Type': 'application/json; charset=utf-8',
},
```

### Backend (`clients_controller.rb`):

#### 1. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∏:
```ruby
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
if first_name.present?
  first_name = first_name.to_s.force_encoding('UTF-8')
  unless first_name.valid_encoding?
    Rails.logger.warn "‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ first_name, –ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å"
    first_name = first_name.encode('UTF-8', invalid: :replace, undef: :replace, replace: '?')
  end
end
```

#### 2. UTF-8 –≤ JSON –æ—Ç–≤–µ—Ç–µ:
```ruby
response_data = {
  user: {
    first_name: user.first_name.to_s.force_encoding('UTF-8'),
    last_name: user.last_name.to_s.force_encoding('UTF-8'),
    # ...
  }
}

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è UTF-8
response.headers['Content-Type'] = 'application/json; charset=utf-8'
```

#### 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```ruby
Rails.logger.info "üîß –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ UTF-8: first_name='#{first_name}', last_name='#{last_name}'"
Rails.logger.info "‚úÖ Social auth —É—Å–ø–µ—à–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: #{user.id}, –∏–º—è: '#{response_data[:user][:first_name]} #{response_data[:user][:last_name]}'"
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
1. **test_google_oauth_encoding.rb** - —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π
2. **check_user_encoding.rb** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î –∏ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. **test_google_oauth_encoding_fix.html** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è
- ‚úÖ Backend API: JSON —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
- ‚úÖ Frontend: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å: –ò–º–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üìä –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- **Email:** test@gmail.com
- **–ò–º—è:** –û–ª–µ–∫—Å–∞–Ω–¥—Ä (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- **–§–∞–º–∏–ª–∏—è:** –ü–µ—Ç—Ä–µ–Ω–∫–æ (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- **ID:** 24

### –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –≤ –ë–î:
```
first_name encoding: UTF-8
first_name bytes: [208, 158, 208, 187, 208, 181, 208, 186, 209, 129, 208, 176, 208, 189, 208, 180, 209, 128]
```

### JSON API –æ—Ç–≤–µ—Ç:
```json
{
  "user": {
    "first_name": "–û–ª–µ–∫—Å–∞–Ω–¥—Ä",
    "last_name": "–ü–µ—Ç—Ä–µ–Ω–∫–æ"
  }
}
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

1. **–ö–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏–µ –∏–º–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è** –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
4. **–î–æ–±–∞–≤–ª–µ–Ω—ã fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Frontend:
- `src/components/auth/GoogleLoginButton.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT
- `external-files/testing/test_google_oauth_encoding_fix.html` - —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

### Backend:
- `app/controllers/api/v1/clients_controller.rb` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ UTF-8 –≤ social_auth
- `test_google_oauth_encoding.rb` - —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `check_user_encoding.rb` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –≤ –ë–î

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã  
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ 