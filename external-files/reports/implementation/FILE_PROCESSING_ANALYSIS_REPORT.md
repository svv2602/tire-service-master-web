# üìã –ê–ù–ê–õ–ò–ó –û–ë–†–ê–ë–û–¢–ö–ò –§–ê–ô–õ–û–í - "–ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª –ø–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å"

## üîç –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢ –°–ï–ô–ß–ê–°

### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤:

**–£—Å–ª–æ–≤–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "–±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞":**
```ruby
if xml_content.size > 5.megabytes
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ (>5MB):**
```ruby
# TODO: –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ Sidekiq
render json: {
  success: true,
  message: "–ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª –ø–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É",
  processing: true
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –º–∞–ª—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (<5MB):**
```ruby
# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
processor = SupplierXmlProcessor.new(@supplier, xml_content)
result = processor.process
```

---

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´ –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### 1. **–§–ò–ö–¢–ò–í–ù–ê–Ø –û–ß–ï–†–ï–î–¨**
- ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ "–ø–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å" - **–õ–û–ñ–ù–û–ï**
- ‚ùå –§–∞–π–ª **–ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è** –≤–æ–æ–±—â–µ
- ‚ùå –¢–æ–ª—å–∫–æ –∏–º–∏—Ç–∞—Ü–∏—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –æ—á–µ—Ä–µ–¥—å (TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
- ‚ùå Frontend –ø–æ–ª—É—á–∞–µ—Ç `processing: true`, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

### 2. **–ü–û–¢–ï–†–Ø –î–ê–ù–ù–´–•**
- ‚ùå –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –ø—Ä–æ—Å—Ç–æ **–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è**
- ‚ùå –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- ‚ùå –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

### 3. **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï –û–ñ–ò–î–ê–ù–ò–Ø**
- ‚ùå UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ø–µ—Ö, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- ‚ùå –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –¥—É–º–∞—é—Ç —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ—Ç
- ‚ùå –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

---

## üìä –ê–ù–ê–õ–ò–ó –†–ê–ó–ú–ï–†–û–í –§–ê–ô–õ–û–í

### –†–µ–∞–ª—å–Ω—ã–µ XML –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã:

**–ü—Ä–∏–º–µ—Ä hotline.xml:**
- –†–∞–∑–º–µ—Ä: **~30MB** (176,521 —Å—Ç—Ä–æ–∫–∞)
- –¢–æ–≤–∞—Ä–æ–≤: **~17,000** –∑–∞–ø–∏—Å–µ–π
- –°–∂–∞—Ç–∏–µ: XML –º–æ–∂–Ω–æ —Å–∂–∞—Ç—å –¥–æ ~3-5MB

**–¢–∏–ø–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø—Ä–∞–π—Å–æ–≤:**
- –ú–∞–ª—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫: 1-3MB (1,000-5,000 —Ç–æ–≤–∞—Ä–æ–≤)
- –°—Ä–µ–¥–Ω–∏–π: 5-15MB (5,000-15,000 —Ç–æ–≤–∞—Ä–æ–≤)  
- –ö—Ä—É–ø–Ω—ã–π: 20-50MB (15,000-50,000 —Ç–æ–≤–∞—Ä–æ–≤)

**–õ–∏–º–∏—Ç 5MB:**
- ‚ùå **–°–õ–ò–®–ö–û–ú –ù–ò–ó–ö–ò–ô** –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–π—Å–æ–≤
- ‚ùå –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ "–±–æ–ª—å—à–∏–µ"
- ‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## üõ†Ô∏è –¢–ï–ö–£–©–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê (–¥–ª—è —Ñ–∞–π–ª–æ–≤ <5MB)

### SupplierXmlProcessor –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è XML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä–Ω–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (`<price>`, `<firmId>`, `<items>`)
   - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ firmId –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞

2. **–°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–π—Å–∞**
   - Checksum —Ñ–∞–π–ª–∞ (SHA256)
   - –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤**
   - –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
   - –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–∂–¥–æ–≥–æ `<item>` —ç–ª–µ–º–µ–Ω—Ç–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –≤ –Ω–∞–ª–∏—á–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ —à–∏–Ω

4. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î**
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ `<param>` —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `supplier_tire_products`

5. **–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

---

## üîß –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
```ruby
# –í–º–µ—Å—Ç–æ 5MB –ø–æ–¥–Ω—è—Ç—å –¥–æ 20-30MB
if xml_content.size > 25.megabytes
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —Å—Ä–∞–∑—É

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚ùå –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â—É—é —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
```ruby
# –î–æ–±–∞–≤–∏—Ç—å Sidekiq
gem 'sidekiq'

# –°–æ–∑–¥–∞—Ç—å job
class ProcessSupplierPriceJob < ApplicationJob
  def perform(supplier_id, xml_content)
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ñ–æ–Ω–µ
  end
end
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ùå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Redis)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```ruby
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —á–∞—Å—Ç—è–º –±–µ–∑ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–º—è—Ç—å
def process_streaming(xml_content)
  # SAX –ø–∞—Ä—Å–µ—Ä –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
end
```

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–û–ï –†–ï–®–ï–ù–ò–ï

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ (–±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ):
1. **–ü–æ–¥–Ω—è—Ç—å –ª–∏–º–∏—Ç –¥–æ 25MB**
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–£–ª—É—á—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ (–ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ):
1. **–í–Ω–µ–¥—Ä–∏—Ç—å Sidekiq** –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. **WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ —Å—Ç–∞—Ç—É—Å–µ
3. **Dashboard –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. **Chunked upload** –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

---

## üí° –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```ruby
# –í–º–µ—Å—Ç–æ TODO - —á–µ—Å—Ç–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
if xml_content.size > 25.megabytes
  render json: {
    success: false,
    error: "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (#{xml_content.size / 1.megabyte}MB). –ú–∞–∫—Å–∏–º—É–º: 25MB",
    file_size_mb: xml_content.size / 1.megabyte,
    max_size_mb: 25
  }, status: :payload_too_large
end
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –≤ UI
```typescript
// Frontend –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
if (response.processing) {
  setStatus('–§–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –æ–∂–∏–¥–∞–π—Ç–µ...');
  // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä
}
```

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤
```ruby
Rails.logger.info "üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º #{xml_content.size / 1.megabyte}MB"
```

---

## üìà –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

1. **–†–∞–∑–º–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤**
2. **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏** (–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ä–∞–∑–º–µ—Ä–æ–º)
3. **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫**
4. **–ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–≥—Ä—É–∑–æ–∫ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤**
5. **–ü–∏–∫–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä

---

## ‚ö° –í–´–í–û–î

**–°–µ–π—á–∞—Å:** –°–∏—Å—Ç–µ–º–∞ **–ù–ï –†–ê–ë–û–¢–ê–ï–¢** –¥–ª—è —Ñ–∞–π–ª–æ–≤ >5MB (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–π—Å–æ–≤)

**–ù—É–∂–Ω–æ:** –ß–µ—Å—Ç–Ω–æ —Å–æ–æ–±—â–∞—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —Å–∏—Å—Ç–µ–º—ã –∏ –ª–∏–±–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç, –ª–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â—É—é —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ª–æ–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é!