<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Google OAuth</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #ffebee; padding: 15px; border-radius: 5px; margin: 10px 0; color: #c62828; }
        .success { background: #e8f5e9; padding: 15px; border-radius: 5px; margin: 10px 0; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1565c0; }
        code { background: #f5f5f5; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Google OAuth</h1>
        
        <div class="info">
            <h3>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</h3>
            <p><strong>–î–æ–º–µ–Ω:</strong> <span id="currentDomain"></span></p>
            <p><strong>URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>Google Client ID:</strong> <code id="clientId">58596894866-lr2c548esilum4eeosploiifascl912a.apps.googleusercontent.com</code></p>
        </div>

        <div class="info">
            <h3>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã Google OAuth:</h3>
            <ol>
                <li>–í Google Cloud Console –¥–æ–±–∞–≤–∏—Ç—å <code>http://localhost:3008</code> –≤ "Authorized JavaScript origins"</li>
                <li>–í Google Cloud Console –¥–æ–±–∞–≤–∏—Ç—å <code>http://localhost:3008/login</code> –≤ "Authorized redirect URIs"</li>
                <li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Client ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –∞–∫—Ç–∏–≤–Ω—ã–π</li>
                <li>–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ OAuth consent screen –Ω–∞—Å—Ç—Ä–æ–µ–Ω</li>
            </ol>
        </div>

        <button onclick="testBasicGoogleOAuth()">üß™ –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ Google OAuth</button>
        <button onclick="testGooglePopup()">ü™ü –¢–µ—Å—Ç Google Popup</button>
        <button onclick="openGoogleConsole()">‚öôÔ∏è –û—Ç–∫—Ä—ã—Ç—å Google Cloud Console</button>
        
        <div id="googleButtonContainer" style="margin: 20px 0;"></div>
        
        <div id="results"></div>
    </div>

    <script>
        const CLIENT_ID = '58596894866-lr2c548esilum4eeosploiifascl912a.apps.googleusercontent.com';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `
                <div class="${className}">
                    <strong>[${timestamp}]</strong> ${message}
                </div>
            `;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateDomainInfo() {
            document.getElementById('currentDomain').textContent = window.location.hostname;
            document.getElementById('currentUrl').textContent = window.location.href;
        }

        function testBasicGoogleOAuth() {
            log('üîß –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ Google OAuth...', 'info');
            
            if (!window.google) {
                log('‚ùå Google SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.', 'error');
                return;
            }

            try {
                log('‚úÖ Google SDK –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                
                window.google.accounts.id.initialize({
                    client_id: CLIENT_ID,
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true,
                    use_fedcm_for_prompt: false
                });

                log('‚úÖ Google OAuth –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–∫–∞–∑–∞—Ç—å One Tap
                window.google.accounts.id.prompt((notification) => {
                    if (notification.isNotDisplayed()) {
                        log('‚ö†Ô∏è Google One Tap –Ω–µ –ø–æ–∫–∞–∑–∞–Ω. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:', 'error');
                        log('‚Ä¢ –î–æ–º–µ–Ω –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ Google Cloud Console', 'error');
                        log('‚Ä¢ –ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–∫–ª–∞–º—ã/popup', 'error');
                        log('‚Ä¢ –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Client ID', 'error');
                        log('‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                        
                        // –ü—Ä–æ–±—É–µ–º –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤–º–µ—Å—Ç–æ One Tap
                        renderGoogleButton();
                    } else if (notification.isSkippedMoment()) {
                        log('‚ö†Ô∏è Google One Tap –ø—Ä–æ–ø—É—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'info');
                        renderGoogleButton();
                    } else if (notification.isDismissedMoment()) {
                        log('‚ö†Ô∏è Google One Tap –∑–∞–∫—Ä—ã—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º', 'info');
                        renderGoogleButton();
                    } else if (notification.isDisplayed()) {
                        log('‚úÖ Google One Tap –ø–æ–∫–∞–∑–∞–Ω!', 'success');
                    }
                });

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        function renderGoogleButton() {
            log('üñ≤Ô∏è –°–æ–∑–¥–∞–µ–º Google –∫–Ω–æ–ø–∫—É –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É...', 'info');
            
            const container = document.getElementById('googleButtonContainer');
            container.innerHTML = '<p>Google –∫–Ω–æ–ø–∫–∞:</p>';
            
            window.google.accounts.id.renderButton(container, {
                theme: 'outline',
                size: 'large',
                type: 'standard',
                text: 'continue_with',
                locale: 'ru'
            });
            
            log('‚úÖ Google –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞', 'success');
        }

        function handleCredentialResponse(response) {
            log('üéâ Google OAuth —É—Å–ø–µ—à–µ–Ω!', 'success');
            log(`üìÑ Credential –ø–æ–ª—É—á–µ–Ω: ${response.credential ? '–î–∞' : '–ù–µ—Ç'}`, 'info');
            
            if (response.credential) {
                try {
                    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º JWT –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
                    const payload = JSON.parse(atob(response.credential.split('.')[1]));
                    log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${payload.email} (${payload.name})`, 'success');
                    log(`üÜî Google ID: ${payload.sub}`, 'info');
                    log(`üñºÔ∏è –ê–≤–∞—Ç–∞—Ä: ${payload.picture || '–Ω–µ—Ç'}`, 'info');
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ${error.message}`, 'error');
                }
            }
        }

        function testGooglePopup() {
            log('ü™ü –¢–µ—Å—Ç–∏—Ä—É–µ–º Google popup –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...', 'info');
            
            const authUrl = `https://accounts.google.com/oauth/v2/auth?` +
                `client_id=${encodeURIComponent(CLIENT_ID)}&` +
                `redirect_uri=${encodeURIComponent(window.location.origin + '/login')}&` +
                `scope=${encodeURIComponent('openid email profile')}&` +
                `response_type=code&` +
                `access_type=offline&` +
                `prompt=consent`;

            log(`üîó URL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${authUrl}`, 'info');
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const popup = window.open(authUrl, 'googleAuth', 'width=500,height=600');
            
            if (popup) {
                log('‚úÖ Popup –æ—Ç–∫—Ä—ã—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ.', 'success');
            } else {
                log('‚ùå Popup –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ popup –¥–ª—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞.', 'error');
            }
        }

        function openGoogleConsole() {
            const consoleUrl = 'https://console.cloud.google.com/apis/credentials';
            window.open(consoleUrl, '_blank');
            log('üîó –û—Ç–∫—Ä—ã—Ç Google Cloud Console. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OAuth 2.0.', 'info');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            updateDomainInfo();
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            log('üí° –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ Google OAuth" –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏', 'info');
        });
    </script>
</body>
</html> 