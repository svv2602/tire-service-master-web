<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-case {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            background: #fafafa;
        }
        .test-case h3 {
            margin-top: 0;
            color: #333;
        }
        .input-output {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        .input-output div {
            flex: 1;
        }
        .input-output strong {
            display: block;
            margin-bottom: 5px;
        }
        .result {
            font-family: monospace;
            background: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .success {
            color: #28a745;
            background: #d4edda;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
        }
        .api-test {
            background: #e3f2fd;
            border: 1px solid #2196f3;
        }
        .api-test h3 {
            color: #1976d2;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>

    <div class="test-container">
        <h2>üì± –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
        
        <div class="test-case">
            <h3>–°–ª—É—á–∞–π 1: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä</h3>
            <div class="input-output">
                <div>
                    <strong>–í—Ö–æ–¥–Ω–æ–π –Ω–æ–º–µ—Ä:</strong>
                    <div class="result">+38 (000) 000-11-11</div>
                </div>
                <div>
                    <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
                    <div class="result">380000001111</div>
                </div>
            </div>
            <button onclick="testPhoneNormalization('+38 (000) 000-11-11', '380000001111')">
                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <div id="test1-result"></div>
        </div>

        <div class="test-case">
            <h3>–°–ª—É—á–∞–π 2: –ù–æ–º–µ—Ä —Å –∫–æ–¥–æ–º —Å—Ç—Ä–∞–Ω—ã</h3>
            <div class="input-output">
                <div>
                    <strong>–í—Ö–æ–¥–Ω–æ–π –Ω–æ–º–µ—Ä:</strong>
                    <div class="result">+380501234567</div>
                </div>
                <div>
                    <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
                    <div class="result">380501234567</div>
                </div>
            </div>
            <button onclick="testPhoneNormalization('+380501234567', '380501234567')">
                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <div id="test2-result"></div>
        </div>

        <div class="test-case">
            <h3>–°–ª—É—á–∞–π 3: –ù–æ–º–µ—Ä –±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã</h3>
            <div class="input-output">
                <div>
                    <strong>–í—Ö–æ–¥–Ω–æ–π –Ω–æ–º–µ—Ä:</strong>
                    <div class="result">0501234567</div>
                </div>
                <div>
                    <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
                    <div class="result">380501234567</div>
                </div>
            </div>
            <button onclick="testPhoneNormalization('0501234567', '380501234567')">
                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <div id="test3-result"></div>
        </div>

        <div class="test-case">
            <h3>–°–ª—É—á–∞–π 4: –¢–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä –∏–∑ –¥–∏–∞–ª–æ–≥–∞</h3>
            <div class="input-output">
                <div>
                    <strong>–í—Ö–æ–¥–Ω–æ–π –Ω–æ–º–µ—Ä:</strong>
                    <div class="result">0000001111</div>
                </div>
                <div>
                    <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
                    <div class="result">380000001111</div>
                </div>
            </div>
            <button onclick="testPhoneNormalization('0000001111', '380000001111')">
                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <div id="test4-result"></div>
        </div>
    </div>

    <div class="test-container api-test">
        <h2>üåê API —Ç–µ—Å—Ç –≤—Ö–æ–¥–∞</h2>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
        
        <div class="test-case">
            <h3>–¢–µ—Å—Ç –≤—Ö–æ–¥–∞ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º</h3>
            <div class="input-output">
                <div>
                    <strong>–õ–æ–≥–∏–Ω:</strong>
                    <div class="result">380000001111</div>
                </div>
                <div>
                    <strong>–ü–∞—Ä–æ–ª—å:</strong>
                    <div class="result">0000001111</div>
                </div>
            </div>
            <button onclick="testLogin()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥</button>
            <div id="login-result"></div>
        </div>

        <div class="test-case">
            <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ API</h3>
            <button onclick="checkApiRoutes()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>
            <div id="routes-result"></div>
        </div>
    </div>

    <div class="test-container">
        <h2>üìã –ñ—É—Ä–Ω–∞–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="test-log" class="log"></div>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –∂—É—Ä–Ω–∞–ª</button>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–æ–ø–∏—è –∏–∑ UniversalLoginForm)
        function normalizePhoneNumber(phone, loginType = 'phone') {
            let normalizedLogin = phone.trim();
            
            if (loginType === 'phone') {
                // –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
                const digitsOnly = phone.replace(/[^\d]/g, '');
                
                // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 38, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                // –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0, –¥–æ–±–∞–≤–ª—è–µ–º 38 –≤ –Ω–∞—á–∞–ª–æ
                if (digitsOnly.startsWith('0') && digitsOnly.length === 10) {
                    normalizedLogin = '38' + digitsOnly; // 0501234567 -> 380501234567
                } else if (digitsOnly.startsWith('38') && digitsOnly.length === 12) {
                    normalizedLogin = digitsOnly; // 380501234567 -> 380501234567
                } else {
                    normalizedLogin = digitsOnly; // –õ—é–±–æ–π –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                }
            }
            
            return normalizedLogin;
        }

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // –¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function testPhoneNormalization(input, expected) {
            const result = normalizePhoneNumber(input);
            const isSuccess = result === expected;
            
            log(`–¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: ${input} -> ${result} (–æ–∂–∏–¥–∞–ª–æ—Å—å: ${expected}) ${isSuccess ? '‚úÖ' : '‚ùå'}`);
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const testCases = document.querySelectorAll('.test-case');
            testCases.forEach((testCase, index) => {
                if (testCase.textContent.includes(input)) {
                    const resultDiv = testCase.querySelector('[id$="-result"]');
                    if (resultDiv) {
                        resultDiv.innerHTML = `
                            <div class="result ${isSuccess ? 'success' : 'error'}">
                                –†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}<br>
                                –°—Ç–∞—Ç—É—Å: ${isSuccess ? '–£–°–ü–ï–• ‚úÖ' : '–û–®–ò–ë–ö–ê ‚ùå'}
                            </div>
                        `;
                    }
                }
            });
        }

        // –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É
        async function testLogin() {
            const loginData = {
                auth: {
                    login: '380000001111',
                    password: '0000001111'
                }
            };

            log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –≤—Ö–æ–¥–∞...');
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(loginData)
                });

                const data = await response.json();
                
                log(`–û—Ç–≤–µ—Ç API: ${response.status} ${response.statusText}`);
                log(`–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`);

                const resultDiv = document.getElementById('login-result');
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ‚úÖ –£–°–ü–ï–•: –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ<br>
                            –°—Ç–∞—Ç—É—Å: ${response.status}<br>
                            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user?.email || 'N/A'}<br>
                            –†–æ–ª—å: ${data.user?.role || 'N/A'}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            ‚ùå –û–®–ò–ë–ö–ê: ${response.status} ${response.statusText}<br>
                            –°–æ–æ–±—â–µ–Ω–∏–µ: ${data.error || data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}<br>
                            –î–µ—Ç–∞–ª–∏: ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
                const resultDiv = document.getElementById('login-result');
                resultDiv.innerHTML = `
                    <div class="result error">
                        ‚ùå –û–®–ò–ë–ö–ê –°–ï–¢–ò: ${error.message}<br>
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8000
                    </div>
                `;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ API
        async function checkApiRoutes() {
            log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤...');
            
            const routes = [
                { path: '/api/v1/auth/login', method: 'POST' },
                { path: '/api/v1/auth/me', method: 'GET' },
                { path: '/api/v1/users', method: 'GET' }
            ];

            const resultDiv = document.getElementById('routes-result');
            let results = '';

            for (const route of routes) {
                try {
                    const response = await fetch(`http://localhost:8000${route.path}`, {
                        method: route.method === 'GET' ? 'GET' : 'OPTIONS',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        credentials: 'include'
                    });

                    const status = response.status;
                    const isAvailable = status !== 404;
                    
                    results += `
                        <div class="result ${isAvailable ? 'success' : 'error'}">
                            ${route.method} ${route.path}: ${status} ${isAvailable ? '‚úÖ' : '‚ùå'}
                        </div>
                    `;
                    
                    log(`–ú–∞—Ä—à—Ä—É—Ç ${route.method} ${route.path}: ${status} ${isAvailable ? '–¥–æ—Å—Ç—É–ø–µ–Ω' : '–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}`);
                } catch (error) {
                    results += `
                        <div class="result error">
                            ${route.method} ${route.path}: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ ‚ùå
                        </div>
                    `;
                    log(`–ú–∞—Ä—à—Ä—É—Ç ${route.method} ${route.path}: –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏`);
                }
            }

            resultDiv.innerHTML = results;
        }

        // –û—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–∞
        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.');
            log('–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞.');
        };
    </script>
</body>
</html> 