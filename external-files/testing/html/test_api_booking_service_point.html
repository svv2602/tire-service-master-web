<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è - –°–µ—Ä–≤–∏—Å–Ω–∞—è –¢–æ—á–∫–∞</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
        }
        .btn { 
            background: #2196F3; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px; 
            font-size: 14px; 
        }
        .btn:hover { background: #1976D2; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .result { 
            background: #f9f9f9; 
            padding: 15px; 
            border-radius: 4px; 
            font-family: monospace; 
            white-space: pre-wrap; 
            border-left: 4px solid #2196F3; 
            margin-top: 10px; 
        }
        .error { border-left-color: #f44336; background: #ffebee; }
        .success { border-left-color: #4caf50; background: #e8f5e8; }
        .warning { border-left-color: #ff9800; background: #fff3e0; }
        h2 { color: #333; border-bottom: 2px solid #2196F3; padding-bottom: 10px; }
        .highlight { background: #ffeb3b; padding: 2px 4px; border-radius: 2px; }
        .section { margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ –¢–µ—Å—Ç API –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è - –î–∞–Ω–Ω—ã–µ –°–µ—Ä–≤–∏—Å–Ω–æ–π –¢–æ—á–∫–∏</h1>
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–µ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
    </div>

    <div class="container section">
        <h2>1. –¢–µ—Å—Ç API –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ‚Ññ12</h2>
        <button class="btn" onclick="testBookingAPI()">üìã –ó–∞–≥—Ä—É–∑–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ññ12</button>
        <div id="booking-result" class="result" style="display: none;"></div>
    </div>

    <div class="container section">
        <h2>2. –ê–Ω–∞–ª–∏–∑ –î–∞–Ω–Ω—ã—Ö –°–µ—Ä–≤–∏—Å–Ω–æ–π –¢–æ—á–∫–∏</h2>
        <div id="service-point-analysis" class="result" style="display: none;"></div>
    </div>

    <div class="container section">
        <h2>3. –¢–µ—Å—Ç –ü—Ä—è–º–æ–≥–æ API –°–µ—Ä–≤–∏—Å–Ω—ã—Ö –¢–æ—á–µ–∫</h2>
        <button class="btn" onclick="testServicePointsAPI()">üè™ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
        <div id="service-points-result" class="result" style="display: none;"></div>
    </div>

    <div class="container section">
        <h2>4. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –õ–æ–≥–∏</h2>
        <p>–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ BookingDetailsPage</p>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è JSON
        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è fetch –∑–∞–ø—Ä–æ—Å–æ–≤
        async function safeFetch(url, options = {}) {
            try {
                console.log('üöÄ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å:', url);
                const response = await fetch(url, {
                    ...options,
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        ...options.headers
                    }
                });
                
                console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üì¶ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
                return { success: true, data };
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
                return { success: false, error: error.message };
            }
        }

        // –¢–µ—Å—Ç API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        async function testBookingAPI() {
            const resultDiv = document.getElementById('booking-result');
            const analysisDiv = document.getElementById('service-point-analysis');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...';

            const result = await safeFetch(`${API_BASE}/bookings/12`);
            
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ –£–°–ü–ï–•!\n\n${formatJSON(result.data)}`;
                
                // –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏
                analyzeServicePoint(result.data);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û–®–ò–ë–ö–ê: ${result.error}`;
            }
        }

        // –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏
        function analyzeServicePoint(bookingData) {
            const analysisDiv = document.getElementById('service-point-analysis');
            analysisDiv.style.display = 'block';
            
            const servicePoint = bookingData.service_point;
            
            let analysis = 'üîç –ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–• –°–ï–†–í–ò–°–ù–û–ô –¢–û–ß–ö–ò:\n\n';
            
            if (!servicePoint) {
                analysis += '‚ùå service_point –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ API!\n';
                analysisDiv.className = 'result error';
            } else {
                analysis += `üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ service_point:\n`;
                analysis += `- ID: ${servicePoint.id}\n`;
                analysis += `- –ù–∞–∑–≤–∞–Ω–∏–µ: "${servicePoint.name}"\n`;
                analysis += `- –ê–¥—Ä–µ—Å: "${servicePoint.address || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}"\n`;
                analysis += `- –¢–µ–ª–µ—Ñ–æ–Ω: "${servicePoint.phone || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}"\n`;
                
                if (servicePoint.city) {
                    analysis += `- –ì–æ—Ä–æ–¥: ID=${servicePoint.city.id}, –ù–∞–∑–≤–∞–Ω–∏–µ="${servicePoint.city.name}"\n`;
                } else {
                    analysis += `- –ì–æ—Ä–æ–¥: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n`;
                }
                
                if (servicePoint.partner_name) {
                    analysis += `- –ü–∞—Ä—Ç–Ω–µ—Ä: "${servicePoint.partner_name}"\n`;
                } else {
                    analysis += `- –ü–∞—Ä—Ç–Ω–µ—Ä: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç\n`;
                }
                
                analysis += '\nüéØ –ü–†–û–ë–õ–ï–ú–´:\n';
                
                if (servicePoint.name && servicePoint.name.includes('–°–µ—Ä–≤–∏—Å–Ω–∞—è —Ç–æ—á–∫–∞ #')) {
                    analysis += `‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç generic –ø–∞—Ç—Ç–µ—Ä–Ω: "${servicePoint.name}"\n`;
                    analysisDiv.className = 'result error';
                } else if (servicePoint.name && servicePoint.name.includes('–¢–æ—á–∫–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è #')) {
                    analysis += `‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ä—ã–π generic –ø–∞—Ç—Ç–µ—Ä–Ω: "${servicePoint.name}"\n`;
                    analysisDiv.className = 'result error';
                } else {
                    analysis += `‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ: "${servicePoint.name}"\n`;
                    analysisDiv.className = 'result success';
                }
                
                if (!servicePoint.address) {
                    analysis += `‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–¥—Ä–µ—Å\n`;
                }
                
                if (!servicePoint.city) {
                    analysis += `‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ—Ä–æ–¥–µ\n`;
                }
            }
            
            analysisDiv.textContent = analysis;
        }

        // –¢–µ—Å—Ç API —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫
        async function testServicePointsAPI() {
            const resultDiv = document.getElementById('service-points-result');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫...';

            const result = await safeFetch(`${API_BASE}/service_points`);
            
            if (result.success) {
                resultDiv.className = 'result success';
                
                let output = `‚úÖ –ó–ê–ì–†–£–ñ–ï–ù–û ${result.data.length} –°–ï–†–í–ò–°–ù–´–• –¢–û–ß–ï–ö:\n\n`;
                
                result.data.forEach((sp, index) => {
                    output += `${index + 1}. ID: ${sp.id}\n`;
                    output += `   –ù–∞–∑–≤–∞–Ω–∏–µ: "${sp.name}"\n`;
                    output += `   –ê–¥—Ä–µ—Å: "${sp.address || '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}"\n`;
                    if (sp.city) {
                        output += `   –ì–æ—Ä–æ–¥: ${sp.city.name} (ID: ${sp.city.id})\n`;
                    }
                    if (sp.partner) {
                        output += `   –ü–∞—Ä—Ç–Ω–µ—Ä: ${sp.partner.name}\n`;
                    }
                    output += '\n';
                });
                
                resultDiv.textContent = output;
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û–®–ò–ë–ö–ê: ${result.error}`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            console.log('üé¨ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é API');
        });
    </script>
</body>
</html> 