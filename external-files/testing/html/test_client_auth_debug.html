<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #2196F3;
            background: #f8f9fa;
        }
        .success {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        .button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #1976D2;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>üîç –û—Ç–ª–∞–¥–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
    
    <div class="container">
        <h2>–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞</h2>
        
        <div class="step">
            <h3>–®–∞–≥ 1: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                <input type="text" id="phone" value="380501234567" />
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="text" id="password" value="0501234567" />
            </div>
            <button class="button" onclick="loginClient()">–í–æ–π—Ç–∏ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç</button>
        </div>
        
        <div class="step">
            <h3>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è</h3>
            <button class="button" onclick="checkAuthMe()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /auth/me</button>
            <button class="button" onclick="checkClientsMe()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /clients/me</button>
            <button class="button" onclick="checkCookies()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookies</button>
        </div>
        
        <div class="step">
            <h3>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
            <button class="button" onclick="checkBookings()">–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        </div>
    </div>
    
    <div class="container">
        <h2>–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        <div id="log" class="log"></div>
        <button class="button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <script>
        let authToken = null;
        let clientData = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
        }
        
        async function loginClient() {
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            
            log(`–í—Ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞: ${phone}`);
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/clients/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include', // –í–∞–∂–Ω–æ –¥–ª—è cookies
                    body: JSON.stringify({
                        login: phone,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    authToken = result.tokens.access;
                    clientData = result;
                    log(`–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥: ${JSON.stringify(result)}`, 'success');
                } else {
                    log(`–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${JSON.stringify(result)}`, 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
        
        async function checkAuthMe() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ /auth/me...');
            
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/me', {
                    headers: headers,
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`/auth/me —É—Å–ø–µ—à–Ω–æ: ${JSON.stringify(result)}`, 'success');
                } else {
                    log(`/auth/me –æ—à–∏–±–∫–∞: ${response.status} - ${JSON.stringify(result)}`, 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ /auth/me: ${error.message}`, 'error');
            }
        }
        
        async function checkClientsMe() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ /clients/me...');
            
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            try {
                const response = await fetch('http://localhost:8000/api/v1/clients/me', {
                    headers: headers,
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`/clients/me —É—Å–ø–µ—à–Ω–æ: ${JSON.stringify(result)}`, 'success');
                } else {
                    log(`/clients/me –æ—à–∏–±–∫–∞: ${response.status} - ${JSON.stringify(result)}`, 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ /clients/me: ${error.message}`, 'error');
            }
        }
        
        async function checkCookies() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ cookies...');
            log(`–í—Å–µ cookies: ${document.cookie}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º refresh —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ /auth/refresh
            try {
                const response = await fetch('http://localhost:8000/api/v1/auth/refresh', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`Refresh —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç: ${JSON.stringify(result)}`, 'success');
                } else {
                    log(`Refresh —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${response.status} - ${JSON.stringify(result)}`, 'warning');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ refresh: ${error.message}`, 'error');
            }
        }
        
        async function checkBookings() {
            if (!clientData || !clientData.client) {
                log('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                return;
            }
            
            log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ ${clientData.client.id}...`);
            
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            try {
                const response = await fetch(`http://localhost:8000/api/v1/bookings?client_id=${clientData.client.id}`, {
                    headers: headers,
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    log(`–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã: ${JSON.stringify(result)}`, 'success');
                } else {
                    log(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${response.status} - ${JSON.stringify(result)}`, 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('–¢–µ—Å—Ç –æ—Ç–ª–∞–¥–∫–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤');
    </script>
</body>
</html> 