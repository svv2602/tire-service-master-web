<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #4CAF50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .info { color: #2196F3; font-weight: bold; }
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #1976D2;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #4CAF50; }
        .status-error { background-color: #f44336; }
        .status-pending { background-color: #ff9800; }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª–∏</h1>
    <p><strong>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong> <span id="testDate"></span></p>

    <div class="test-section">
        <h2>üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã</h2>
        <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –º–æ–≥ –ø–æ–ø–∞—Å—Ç—å –≤ –∞–¥–º–∏–Ω—Å–∫—É—é –ø–∞–Ω–µ–ª—å –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.</p>
        <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> –°—Å—ã–ª–∫–∏ –≤ ClientNavigation –∏ SideNav —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ /admin</p>
        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–µ—Ñ–∏–∫—Å–∞ /admin/*</p>
    </div>

    <div class="test-section">
        <h2>üß™ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã</h2>
        <button class="test-button" onclick="testLogin()">1. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∞</button>
        <button class="test-button" onclick="testAdminAccess()">2. –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</button>
        <button class="test-button" onclick="testNavigationLinks()">3. –¢–µ—Å—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</button>
        <button class="test-button" onclick="testPageContentAPI()">4. –¢–µ—Å—Ç API page_contents</button>
        <button class="test-button" onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        
        <div id="testResults" class="log"></div>
    </div>

    <div class="test-section">
        <h2>üìù –†—É—á–Ω—ã–µ —Ç–µ—Å—Ç—ã</h2>
        <div id="manualTests">
            <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:</h3>
            <ol>
                <li><span class="status-indicator status-pending"></span>–ó–∞–π—Ç–∏ –Ω–∞ http://localhost:3008/</li>
                <li><span class="status-indicator status-pending"></span>–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ admin@test.com</li>
                <li><span class="status-indicator status-pending"></span>–ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ "–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å" –≤ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è</li>
                <li><span class="status-indicator status-pending"></span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ø–∞–¥–∞–µ–º –Ω–∞ /admin/dashboard</li>
                <li><span class="status-indicator status-pending"></span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ–∫–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</li>
                <li><span class="status-indicator status-pending"></span>–ö–ª–∏–∫–Ω—É—Ç—å "–ü–∞—Ä—Ç–Ω–µ—Ä—ã" ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è /admin/partners</li>
                <li><span class="status-indicator status-pending"></span>–ö–ª–∏–∫–Ω—É—Ç—å "–ö–ª–∏–µ–Ω—Ç—ã" ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è /admin/clients</li>
                <li><span class="status-indicator status-pending"></span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>üîç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h2>
        <ul>
            <li><strong>Frontend:</strong> ClientNavigation.tsx - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è handleNavigateToAdmin</li>
            <li><strong>Frontend:</strong> SideNav.tsx - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Å—ã–ª–∫–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º /admin</li>
            <li><strong>Frontend:</strong> MainLayout.tsx - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –ø—É—Ç–∏ –≤ –º–µ–Ω—é</li>
            <li><strong>Backend:</strong> page_contents_controller.rb - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å –∫–æ–ª–æ–Ω–∫–æ–π category</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="summaryResults">
            <p>–¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã" –¥–ª—è –Ω–∞—á–∞–ª–∞.</p>
        </div>
    </div>

    <script>
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById('testDate').textContent = new Date().toLocaleString('ru-RU');

        const API_BASE = 'http://localhost:8000/api/v1';
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('testResults');
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            
            testResults.push({ message, type, timestamp });
        }

        function clearLog() {
            document.getElementById('testResults').textContent = '';
            testResults = [];
        }

        async function testLogin() {
            log('üîê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'admin@test.com',
                        password: 'admin123'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('accessToken', data.access_token);
                    log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞', 'success');
                    return true;
                } else {
                    log('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + response.status, 'error');
                    return false;
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
                return false;
            }
        }

        async function testAdminAccess() {
            log('üîë –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...', 'info');
            
            const token = localStorage.getItem('accessToken');
            if (!token) {
                log('‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.', 'error');
                return false;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.user && data.user.role === 'admin') {
                        log('‚úÖ –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω', 'success');
                        return true;
                    } else {
                        log('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º', 'error');
                        return false;
                    }
                } else {
                    log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞: ' + response.status, 'error');
                    return false;
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–∞: ' + error.message, 'error');
                return false;
            }
        }

        async function testNavigationLinks() {
            log('üß≠ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏...', 'info');
            
            const adminRoutes = [
                '/admin/dashboard',
                '/admin/partners',
                '/admin/clients',
                '/admin/users',
                '/admin/service-points',
                '/admin/bookings',
                '/admin/articles',
                '/admin/page-content',
                '/admin/regions',
                '/admin/car-brands',
                '/admin/settings'
            ];

            let successCount = 0;
            
            for (const route of adminRoutes) {
                try {
                    const fullUrl = `http://localhost:3008${route}`;
                    log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞: ${route}`, 'info');
                    
                    // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –º—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Ö —Ñ–æ—Ä–º–∞—Ç
                    if (route.startsWith('/admin/')) {
                        successCount++;
                        log(`‚úÖ –ú–∞—Ä—à—Ä—É—Ç ${route} –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç`, 'success');
                    } else {
                        log(`‚ùå –ú–∞—Ä—à—Ä—É—Ç ${route} –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å–∞ /admin`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞ ${route}: ${error.message}`, 'error');
                }
            }

            const totalRoutes = adminRoutes.length;
            log(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${successCount}/${totalRoutes} –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É`, 
                successCount === totalRoutes ? 'success' : 'error');
            
            return successCount === totalRoutes;
        }

        async function testPageContentAPI() {
            log('üìÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API page_contents...', 'info');
            
            const token = localStorage.getItem('accessToken');
            if (!token) {
                log('‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.', 'error');
                return false;
            }

            try {
                const response = await fetch(`${API_BASE}/page_contents?section=client_main`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ API page_contents —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                    log(`üìä –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${data.data ? data.data.length : 0}`, 'info');
                    return true;
                } else {
                    log('‚ùå –û—à–∏–±–∫–∞ API page_contents: ' + response.status, 'error');
                    return false;
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ API: ' + error.message, 'error');
                return false;
            }
        }

        async function runAllTests() {
            clearLog();
            log('üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤...', 'info');
            log('=' .repeat(50), 'info');
            
            const tests = [
                { name: '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', func: testLogin },
                { name: '–î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏', func: testAdminAccess },
                { name: '–°—Å—ã–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏', func: testNavigationLinks },
                { name: 'API page_contents', func: testPageContentAPI }
            ];

            let passedTests = 0;
            
            for (const test of tests) {
                log(`\nüß™ –¢–µ—Å—Ç: ${test.name}`, 'info');
                const result = await test.func();
                if (result) {
                    passedTests++;
                }
                log('-' .repeat(30), 'info');
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤
            const summary = `
üìä –ò–¢–û–ì–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:
‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ: ${passedTests}/${tests.length} —Ç–µ—Å—Ç–æ–≤
${passedTests === tests.length ? 'üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!' : '‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å'}

üîß –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- –ù–∞–≤–∏–≥–∞—Ü–∏—è ClientNavigation: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- –ù–∞–≤–∏–≥–∞—Ü–∏—è SideNav: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞  
- –ù–∞–≤–∏–≥–∞—Ü–∏—è MainLayout: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- API page_contents: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- –ú–∞—Ä—à—Ä—É—Ç—ã App.tsx: ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç

üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
${passedTests === tests.length ? 
    '- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ\n- –ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É /admin\n- –í—Å–µ —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ' : 
    '- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—Å–∫ backend –∏ frontend —Å–µ—Ä–≤–µ—Ä–æ–≤\n- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞\n- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS'}
            `;

            document.getElementById('summaryResults').innerHTML = `<pre>${summary}</pre>`;
            log(summary, passedTests === tests.length ? 'success' : 'error');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ª–µ–≥–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤...', 'info');
                testNavigationLinks();
            }, 1000);
        });
    </script>
</body>
</html> 