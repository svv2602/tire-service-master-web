<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .response { background-color: #f8f9fa; padding: 10px; border-radius: 3px; white-space: pre-wrap; font-family: monospace; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h1>
    
    <div class="section info">
        <h3>üìã –ü—Ä–æ–±–ª–µ–º–∞</h3>
        <p>–ó–∞–ø–∏—Å–∏ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –∞–¥–º–∏–Ω—Å–∫–æ–π –ø–∞–Ω–µ–ª—å—é.</p>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º:</p>
        <ul>
            <li>–†–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</li>
            <li>–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ client_id</li>
            <li>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</li>
            <li>–ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</li>
        </ul>
    </div>

    <div class="section">
        <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
        <div>
            <label>Email: <input type="email" id="email" value="admin@test.com"></label>
            <label>–ü–∞—Ä–æ–ª—å: <input type="password" id="password" value="admin123"></label>
            <button onclick="login()">–í–æ–π—Ç–∏</button>
        </div>
        <div id="authResult" class="response"></div>
    </div>

    <div class="section">
        <h3>üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
        <button onclick="getAllBookings()">–ü–æ–ª—É—á–∏—Ç—å –í–°–ï –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–∞–∫ –∞–¥–º–∏–Ω)</button>
        <button onclick="getClientBookings()">–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ID=2</button>
        <div id="comparisonResult" class="response"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authToken = localStorage.getItem('tvoya_shina_token');

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (data.tokens?.access) {
                    authToken = data.tokens.access;
                    localStorage.setItem('tvoya_shina_token', authToken);
                    document.getElementById('authResult').textContent = 
                        `‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.email}\n–†–æ–ª—å: ${data.user.role}\nID: ${data.user.id}`;
                    document.getElementById('authResult').className = 'response success';
                } else {
                    document.getElementById('authResult').textContent = JSON.stringify(data, null, 2);
                    document.getElementById('authResult').className = 'response error';
                }
            } catch (error) {
                document.getElementById('authResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('authResult').className = 'response error';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (–∞–¥–º–∏–Ω—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å)
        async function getAllBookings() {
            try {
                const response = await fetch(`${API_BASE}/bookings?page=1&per_page=50`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                let result = `üîç –í–°–ï –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø (–∞–¥–º–∏–Ω—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å)\n`;
                result += `–°—Ç–∞—Ç—É—Å: ${response.status}\n`;
                result += `–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${data.data?.length || 0}\n\n`;
                
                if (data.data && data.data.length > 0) {
                    result += `üìã –°–ü–ò–°–û–ö –ó–ê–ü–ò–°–ï–ô:\n`;
                    data.data.forEach((booking, index) => {
                        result += `${index + 1}. ID: ${booking.id}, Client: ${booking.client_id}, Status: ${booking.status_id}, Date: ${booking.booking_date}\n`;
                    });
                    
                    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
                    const statusGroups = {};
                    data.data.forEach(booking => {
                        const status = booking.status_id;
                        if (!statusGroups[status]) statusGroups[status] = 0;
                        statusGroups[status]++;
                    });
                    
                    result += `\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –°–¢–ê–¢–£–°–ê–ú:\n`;
                    Object.entries(statusGroups).forEach(([status, count]) => {
                        result += `Status ${status}: ${count} –∑–∞–ø–∏—Å–µ–π\n`;
                    });
                } else {
                    result += `‚ùå –ó–∞–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã\n`;
                }
                
                document.getElementById('comparisonResult').textContent = result;
                document.getElementById('comparisonResult').className = 'response success';
            } catch (error) {
                document.getElementById('comparisonResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('comparisonResult').className = 'response error';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        async function getClientBookings() {
            try {
                const response = await fetch(`${API_BASE}/bookings?client_id=2`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                let result = `\n\nüéØ –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø –ö–õ–ò–ï–ù–¢–ê ID=2\n`;
                result += `–°—Ç–∞—Ç—É—Å: ${response.status}\n`;
                result += `–ó–∞–ø–∏—Å–µ–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞: ${data.data?.length || 0}\n\n`;
                
                if (data.data && data.data.length > 0) {
                    result += `üìã –ó–ê–ü–ò–°–ò –ö–õ–ò–ï–ù–¢–ê:\n`;
                    data.data.forEach((booking, index) => {
                        result += `${index + 1}. ID: ${booking.id}, Status: ${booking.status_id}, Date: ${booking.booking_date}, Time: ${booking.start_time}\n`;
                    });
                } else {
                    result += `‚ùå –£ –∫–ª–∏–µ–Ω—Ç–∞ ID=2 –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π\n`;
                }
                
                document.getElementById('comparisonResult').textContent += result;
            } catch (error) {
                document.getElementById('comparisonResult').textContent += '\n\n–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('comparisonResult').className = 'response error';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            const token = localStorage.getItem('tvoya_shina_token');
            if (token) {
                authToken = token;
                document.getElementById('authResult').textContent = `–ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω: ${token.substring(0, 20)}...`;
                document.getElementById('authResult').className = 'response info';
            }
        };
    </script>
</body>
</html> 