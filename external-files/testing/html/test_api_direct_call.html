<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .result {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê –¢–µ—Å—Ç API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é</p>
        </div>

        <div class="test-section">
            <h2>üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
            <div class="result info" id="config-info">
                –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...
            </div>
        </div>

        <div class="test-section">
            <h2>üîë –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
            <div>
                <label>–õ–æ–≥–∏–Ω:</label>
                <input type="text" id="login" value="0000001111" placeholder="–õ–æ–≥–∏–Ω">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" value="0000001111" placeholder="–ü–∞—Ä–æ–ª—å">
                <button onclick="testLogin()">–í–æ–π—Ç–∏</button>
            </div>
            <div class="result" id="login-result">
                –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
            </div>
        </div>

        <div class="test-section">
            <h2>üåê –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API</h2>
            <button onclick="testApiHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
            <div class="result" id="health-result">
                –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
            </div>
        </div>

        <div class="test-section">
            <h2>üîç –¢–µ—Å—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤</h2>
            <button onclick="testRoutes()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>
            <div class="result" id="routes-result">
                –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_URL = 'http://localhost:8000';
        const API_PREFIX = '/api/v1';
        const FULL_API_URL = `${API_URL}${API_PREFIX}`;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        document.getElementById('config-info').textContent = `
API_URL: ${API_URL}
API_PREFIX: ${API_PREFIX}
FULL_API_URL: ${FULL_API_URL}
Hostname: ${window.location.hostname}
Port: ${window.location.port}
        `;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = message;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function testLogin() {
            const login = document.getElementById('login').value;
            const password = document.getElementById('password').value;
            
            logResult('login-result', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...', 'info');
            
            try {
                const response = await fetch(`${FULL_API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        auth: {
                            login: login,
                            password: password
                        }
                    })
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    const data = JSON.parse(responseText);
                    logResult('login-result', `‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!
–°—Ç–∞—Ç—É—Å: ${response.status}
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.first_name} ${data.user.last_name}
Email: ${data.user.email}
–¢–µ–ª–µ—Ñ–æ–Ω: ${data.user.phone}
–†–æ–ª—å: ${data.user.role}
–¢–æ–∫–µ–Ω: ${data.access_token ? '–ü–æ–ª—É—á–µ–Ω' : '–ù–µ –ø–æ–ª—É—á–µ–Ω'}`, 'success');
                } else {
                    logResult('login-result', `‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
–°—Ç–∞—Ç—É—Å: ${response.status}
–û—Ç–≤–µ—Ç: ${responseText}`, 'error');
                }
            } catch (error) {
                logResult('login-result', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
        async function testApiHealth() {
            logResult('health-result', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/api/v1/health`, {
                    method: 'GET',
                    credentials: 'include',
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    logResult('health-result', `‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω!
–°—Ç–∞—Ç—É—Å: ${response.status}
–û—Ç–≤–µ—Ç: ${responseText}`, 'success');
                } else {
                    logResult('health-result', `‚ö†Ô∏è API –æ—Ç–≤–µ—á–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
–°—Ç–∞—Ç—É—Å: ${response.status}
–û—Ç–≤–µ—Ç: ${responseText}`, 'error');
                }
            } catch (error) {
                logResult('health-result', `‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤
        async function testRoutes() {
            logResult('routes-result', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤...', 'info');
            
            const routes = [
                '/api/v1/health',
                '/api/v1/auth/login',
                '/api/v1/auth/me',
                '/api/v1/service_points',
                '/api/v1/regions'
            ];

            let results = [];
            
            for (const route of routes) {
                try {
                    const response = await fetch(`${API_URL}${route}`, {
                        method: route.includes('login') ? 'POST' : 'GET',
                        credentials: 'include',
                        headers: route.includes('login') ? {
                            'Content-Type': 'application/json',
                        } : {},
                        body: route.includes('login') ? JSON.stringify({
                            auth: { login: 'test', password: 'test' }
                        }) : undefined
                    });

                    results.push(`${route}: ${response.status} ${response.statusText}`);
                } catch (error) {
                    results.push(`${route}: ‚ùå ${error.message}`);
                }
            }

            logResult('routes-result', `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤:
${results.join('\n')}`, 'info');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            testApiHealth();
        });
    </script>
</body>
</html> 