<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { border-color: #4CAF50; background-color: #f8fff8; }
        .error { border-color: #f44336; background-color: #fff8f8; }
        .info { border-color: #2196F3; background-color: #f8f9ff; }
        .warning { border-color: #ff9800; background-color: #fff8f0; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976D2; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success-result { background: #e8f5e8; color: #2e7d32; }
        .error-result { background: #ffebee; color: #c62828; }
        .info-result { background: #e3f2fd; color: #1565c0; }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .active { background: #4CAF50; color: white; }
        .inactive { background: #f44336; color: white; }
        .working { background: #2196F3; color: white; }
        .closed { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏: –µ—Å–ª–∏ –ø–∞—Ä—Ç–Ω–µ—Ä –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, —Ç–æ –Ω–µ–ª—å–∑—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏</p>

    <!-- –°–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="container">
        <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <div class="test-section info">
            <h3>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <button onclick="autoLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>
            <div id="authResult" class="result"></div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è backend –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
    <div class="container">
        <h2>üîß Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è</h2>
        <div class="test-section warning">
            <h3>–¢–µ—Å—Ç 1: –ü–æ–ø—ã—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—É—é —Ç–æ—á–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h3>
            <p>–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏ –ø—ã—Ç–∞–µ–º—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å–µ—Ä–≤–∏—Å–Ω—É—é —Ç–æ—á–∫—É</p>
            <button onclick="testServicePointValidation()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏</button>
            <div id="servicePointValidationResult" class="result"></div>
        </div>

        <div class="test-section warning">
            <h3>–¢–µ—Å—Ç 2: –ü–æ–ø—ã—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h3>
            <p>–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏ –ø—ã—Ç–∞–µ–º—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</p>
            <button onclick="testOperatorValidation()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</button>
            <div id="operatorValidationResult" class="result"></div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è frontend -->
    <div class="container">
        <h2>üñ•Ô∏è Frontend —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</h2>
        <div class="test-section info">
            <h3>–¢–µ—Å—Ç 3: –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏</p>
            <button onclick="testPartnerToggle()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞</button>
            <div id="partnerToggleResult" class="result"></div>
        </div>

        <div class="test-section info">
            <h3>–¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ UI</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ UI –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏</p>
            <button onclick="testUIRestrictions()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å UI –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</button>
            <div id="uiRestrictionsResult" class="result"></div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ -->
    <div class="container">
        <h2>üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h2>
        <div class="test-section">
            <h3>–ü–∞—Ä—Ç–Ω–µ—Ä –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏</h3>
            <button onclick="checkCurrentStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            <div id="statusResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authToken = null;
        let testPartnerId = 1; // ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function autoLogin() {
            const resultDiv = document.getElementById('authResult');
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'admin@test.com',
                        password: 'admin123'
                    }),
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    resultDiv.className = 'result success-result';
                    resultDiv.textContent = `‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.first_name} ${data.user.last_name}\n–†–æ–ª—å: ${data.user.role}`;
                } else {
                    const error = await response.json();
                    throw new Error(error.message || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                }
            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}`;
            }
        }

        // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏
        async function testServicePointValidation() {
            const resultDiv = document.getElementById('servicePointValidationResult');
            if (!authToken) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = '‚ùå –°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å';
                return;
            }

            try {
                resultDiv.className = 'result info-result';
                resultDiv.textContent = '‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏...';

                // 1. –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                const deactivateResponse = await fetch(`${API_BASE}/partners/${testPartnerId}/toggle_active`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        partner: { is_active: false }
                    }),
                    credentials: 'include'
                });

                if (!deactivateResponse.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞');
                }

                // 2. –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                const servicePointsResponse = await fetch(`${API_BASE}/service_points?partner_id=${testPartnerId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    credentials: 'include'
                });

                const servicePointsData = await servicePointsResponse.json();
                const servicePoints = servicePointsData.data || [];
                
                if (servicePoints.length === 0) {
                    throw new Error('–£ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –Ω–µ—Ç —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }

                const servicePoint = servicePoints[0];

                // 3. –ü—ã—Ç–∞–µ–º—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—É—é —Ç–æ—á–∫—É
                const activateResponse = await fetch(`${API_BASE}/service_points/${servicePoint.id}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        service_point: { is_active: true }
                    }),
                    credentials: 'include'
                });

                if (activateResponse.ok) {
                    resultDiv.className = 'result error-result';
                    resultDiv.textContent = '‚ùå –û–®–ò–ë–ö–ê: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞! –°–µ—Ä–≤–∏—Å–Ω–∞—è —Ç–æ—á–∫–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞, —Ö–æ—Ç—è –ø–∞—Ä—Ç–Ω–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.';
                } else {
                    const error = await activateResponse.json();
                    resultDiv.className = 'result success-result';
                    resultDiv.textContent = `‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!\n–û—à–∏–±–∫–∞: ${error.errors?.is_active?.[0] || error.message}`;
                }

            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`;
            }
        }

        // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
        async function testOperatorValidation() {
            const resultDiv = document.getElementById('operatorValidationResult');
            if (!authToken) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = '‚ùå –°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å';
                return;
            }

            try {
                resultDiv.className = 'result info-result';
                resultDiv.textContent = '‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞...';

                // 1. –ü–æ–ª—É—á–∞–µ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                const operatorsResponse = await fetch(`${API_BASE}/operators?partner_id=${testPartnerId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    credentials: 'include'
                });

                const operatorsData = await operatorsResponse.json();
                const operators = operatorsData.data || [];
                
                if (operators.length === 0) {
                    throw new Error('–£ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }

                const operator = operators[0];

                // 2. –ü—ã—Ç–∞–µ–º—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ (–ø–∞—Ä—Ç–Ω–µ—Ä —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞)
                const activateResponse = await fetch(`${API_BASE}/operators/${operator.id}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        operator: { is_active: true }
                    }),
                    credentials: 'include'
                });

                if (activateResponse.ok) {
                    resultDiv.className = 'result error-result';
                    resultDiv.textContent = '‚ùå –û–®–ò–ë–ö–ê: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞! –û–ø–µ—Ä–∞—Ç–æ—Ä –±—ã–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, —Ö–æ—Ç—è –ø–∞—Ä—Ç–Ω–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.';
                } else {
                    const error = await activateResponse.json();
                    resultDiv.className = 'result success-result';
                    resultDiv.textContent = `‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!\n–û—à–∏–±–∫–∞: ${error.errors?.is_active?.[0] || error.message}`;
                }

            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`;
            }
        }

        // –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞
        async function testPartnerToggle() {
            const resultDiv = document.getElementById('partnerToggleResult');
            if (!authToken) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = '‚ùå –°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å';
                return;
            }

            try {
                resultDiv.className = 'result info-result';
                resultDiv.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞...';

                // 1. –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                const activateResponse = await fetch(`${API_BASE}/partners/${testPartnerId}/toggle_active`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        partner: { is_active: true }
                    }),
                    credentials: 'include'
                });

                if (!activateResponse.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞');
                }

                // 2. –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (–¥–æ–ª–∂–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏)
                const deactivateResponse = await fetch(`${API_BASE}/partners/${testPartnerId}/toggle_active`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        partner: { is_active: false }
                    }),
                    credentials: 'include'
                });

                if (!deactivateResponse.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞');
                }

                // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
                await checkCurrentStatus();

                resultDiv.className = 'result success-result';
                resultDiv.textContent = '‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∏–∂–µ.';

            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`;
            }
        }

        // –¢–µ—Å—Ç UI –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        async function testUIRestrictions() {
            const resultDiv = document.getElementById('uiRestrictionsResult');
            resultDiv.className = 'result info-result';
            resultDiv.textContent = `üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞: http://localhost:3008/admin/partners/${testPartnerId}/edit

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä—Ç–Ω–µ—Ä –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–ê–∫—Ç–∏–≤–Ω—ã–π –ø–∞—Ä—Ç–Ω–µ—Ä" –≤—ã–∫–ª—é—á–µ–Ω)

3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–∏ "–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏" –∏ "–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏"

4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—É—é —Å–µ—Ä–≤–∏—Å–Ω—É—é —Ç–æ—á–∫—É –∏–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

5. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: "–ù–µ–ª—å–∑—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å, —Ç–∞–∫ –∫–∞–∫ –ø–∞—Ä—Ç–Ω–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"

6. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É - —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å`;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        async function checkCurrentStatus() {
            const resultDiv = document.getElementById('statusResult');
            if (!authToken) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = '‚ùå –°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å';
                return;
            }

            try {
                resultDiv.className = 'result info-result';
                resultDiv.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...';

                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
                const partnerResponse = await fetch(`${API_BASE}/partners/${testPartnerId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    credentials: 'include'
                });

                const partner = await partnerResponse.json();

                // –ü–æ–ª—É—á–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const relatedResponse = await fetch(`${API_BASE}/partners/${testPartnerId}/related_data`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    credentials: 'include'
                });

                const relatedData = await relatedResponse.json();

                let statusText = `üìä –°—Ç–∞—Ç—É—Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ "${partner.company_name}":
${partner.is_active ? 'üü¢ –ê–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}

üè¢ –°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏ (${relatedData.service_points.length}):`;

                relatedData.service_points.forEach(sp => {
                    statusText += `\n  ‚Ä¢ ${sp.name}: ${sp.is_active ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞' : 'üî¥ –ù–µ–∞–∫—Ç–∏–≤–Ω–∞'} (${sp.work_status})`;
                });

                statusText += `\n\nüë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (${relatedData.operators.length}):`;
                relatedData.operators.forEach(op => {
                    statusText += `\n  ‚Ä¢ ${op.user.first_name} ${op.user.last_name}: ${op.is_active ? 'üü¢ –ê–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}`;
                });

                resultDiv.className = 'result info-result';
                resultDiv.textContent = statusText;

            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            autoLogin();
        };
    </script>
</body>
</html> 