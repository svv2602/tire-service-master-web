<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –¥–ª—è client321@test.com</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –¥–ª—è client321@test.com</h1>

    <div class="test-section">
        <h2>1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <button onclick="testLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ client321@test.com</button>
        <div id="loginResult" class="log"></div>
    </div>

    <div class="test-section">
        <h2>2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
        <button onclick="testGetCurrentUser()">–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <div id="userResult" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3. –ü–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
        <button onclick="testGetBookings()">–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        <div id="bookingsResult" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é</h2>
        <button onclick="testDirectAPI()">–ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API</button>
        <div id="directResult" class="log"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authCookies = '';

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            element.scrollTop = element.scrollHeight;
        }

        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.innerHTML = '';
            
            try {
                log('loginResult', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...');
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        auth: {
                            login: 'client321@test.com',
                            password: 'client321'
                        }
                    })
                });

                log('loginResult', `–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                
                const data = await response.json();
                
                if (response.ok) {
                    log('loginResult', '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                    log('loginResult', `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.first_name} ${data.user.last_name}`);
                    log('loginResult', `Email: ${data.user.email}`);
                    log('loginResult', `Client ID: ${data.user.client_id || '–Ω–µ –∑–∞–¥–∞–Ω'}`);
                    log('loginResult', `–†–æ–ª—å: ${data.user.role}`);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫—É–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
                    const setCookieHeader = response.headers.get('Set-Cookie');
                    if (setCookieHeader) {
                        authCookies = setCookieHeader;
                        log('loginResult', '–ö—É–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤');
                    }
                } else {
                    log('loginResult', `‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                log('loginResult', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function testGetCurrentUser() {
            const resultDiv = document.getElementById('userResult');
            resultDiv.innerHTML = '';
            
            try {
                log('userResult', '–ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
                
                const response = await fetch(`${API_BASE}/auth/me`, {
                    method: 'GET',
                    credentials: 'include',
                });

                log('userResult', `–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('userResult', '‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–µ–Ω—ã!', 'success');
                    log('userResult', `JSON –æ—Ç–≤–µ—Ç: ${JSON.stringify(data, null, 2)}`);
                } else {
                    const errorData = await response.json();
                    log('userResult', `‚ùå –û—à–∏–±–∫–∞: ${JSON.stringify(errorData)}`, 'error');
                }
            } catch (error) {
                log('userResult', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function testGetBookings() {
            const resultDiv = document.getElementById('bookingsResult');
            resultDiv.innerHTML = '';
            
            try {
                log('bookingsResult', '–ü–æ–ª—É—á–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ 28...');
                
                const response = await fetch(`${API_BASE}/clients/28/bookings`, {
                    method: 'GET',
                    credentials: 'include',
                });

                log('bookingsResult', `–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log('bookingsResult', '‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã!', 'success');
                    log('bookingsResult', `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${data.data ? data.data.length : 0}`);
                    log('bookingsResult', `JSON –æ—Ç–≤–µ—Ç: ${JSON.stringify(data, null, 2)}`);
                } else {
                    const errorData = await response.json();
                    log('bookingsResult', `‚ùå –û—à–∏–±–∫–∞: ${JSON.stringify(errorData)}`, 'error');
                }
            } catch (error) {
                log('bookingsResult', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function testDirectAPI() {
            const resultDiv = document.getElementById('directResult');
            resultDiv.innerHTML = '';
            
            try {
                log('directResult', '–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ID 28...');
                
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º, –µ—Å—Ç—å –ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ID 28
                const bookingResponse = await fetch(`${API_BASE}/bookings/28`, {
                    method: 'GET',
                    credentials: 'include',
                });

                log('directResult', `–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –¥–ª—è booking/28: ${bookingResponse.status}`);
                
                if (bookingResponse.ok) {
                    const bookingData = await bookingResponse.json();
                    log('directResult', '‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ!', 'success');
                    log('directResult', `–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: ${JSON.stringify(bookingData, null, 2)}`);
                } else {
                    const errorData = await bookingResponse.json();
                    log('directResult', `‚ùå –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: ${JSON.stringify(errorData)}`, 'error');
                }

                // –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∏–º –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                log('directResult', '–ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...');
                const allBookingsResponse = await fetch(`${API_BASE}/bookings`, {
                    method: 'GET',
                    credentials: 'include',
                });

                log('directResult', `–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${allBookingsResponse.status}`);
                
                if (allBookingsResponse.ok) {
                    const allBookingsData = await allBookingsResponse.json();
                    log('directResult', `–í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${allBookingsData.data ? allBookingsData.data.length : 0}`);
                    
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ 28
                    const client28Bookings = allBookingsData.data?.filter(b => b.client_id === 28) || [];
                    log('directResult', `–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ 28: ${client28Bookings.length}`);
                    
                    if (client28Bookings.length > 0) {
                        log('directResult', `–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ 28: ${JSON.stringify(client28Bookings, null, 2)}`);
                    }
                } else {
                    const errorData = await allBookingsResponse.json();
                    log('directResult', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${JSON.stringify(errorData)}`, 'error');
                }

            } catch (error) {
                log('directResult', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('loginResult', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
        };
    </script>
</body>
</html> 