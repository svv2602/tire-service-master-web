<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π</h1>
    
    <div class="test-section info">
        <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã</h3>
        <p>–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è (29 –∏—é–Ω—è 2025) –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤", 
        —Ö–æ—Ç—è —É —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Å—Ç —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ.</p>
        
        <p><strong>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong></p>
        <ul>
            <li>–ó–∞–º–µ–Ω–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ <code>get_schedule_for_date</code> –Ω–∞ <code>has_any_working_posts_on_date</code></li>
            <li>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ <code>AvailabilityController</code> –∏ <code>DynamicAvailabilityService</code></li>
            <li>–¢–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>üß™ –¢–µ—Å—Ç—ã API</h3>
        <button onclick="testSundayAvailability()">–¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</button>
        <button onclick="testServicePointData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏</button>
        <button onclick="testPostSchedules()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤</button>
        
        <div id="apiResults"></div>
    </div>

    <div class="test-section">
        <h3>üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
        <div class="result success">
            <strong>‚úÖ –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong>
            <pre>{"is_working_day": false, "available_slots": [], "total_slots": 0}</pre>
        </div>
        <div class="result success">
            <strong>‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong>
            <pre>{"is_working_day": true, "available_slots": [...], "total_slots": 18}</pre>
        </div>
    </div>

    <div class="test-section">
        <h3>üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h3>
        <p>–î–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:</p>
        <ol>
            <li>–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ <a href="http://localhost:3008/client/booking/new-with-availability" target="_blank">—Å—Ç—Ä–∞–Ω–∏—Ü—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a></li>
            <li>–í—ã–±—Ä–∞—Ç—å "–õ—å–≤—ñ–≤" ‚Üí "–ê–≤—Ç–æ–®–∏–Ω–∞ –ü–ª—é—Å —Ü–µ–Ω—Ç—Ä"</li>
            <li>–í—ã–±—Ä–∞—Ç—å –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 29 –∏—é–Ω—è 2025</li>
            <li>–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –≤—Ä–µ–º–µ–Ω–∏</li>
            <li>–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É"</li>
        </ol>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        
        function showResult(id, content, type = 'info') {
            const container = document.getElementById(id);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = content;
            container.appendChild(div);
        }
        
        async function testSundayAvailability() {
            const resultsContainer = document.getElementById('apiResults');
            resultsContainer.innerHTML = '<h4>üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ...</h4>';
            
            try {
                const response = await fetch(`${API_BASE}/availability/4/2025-06-29`);
                const data = await response.json();
                
                if (data.is_working_day && data.total_slots > 0) {
                    showResult('apiResults', `
                        <strong>‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù!</strong><br>
                        –†–∞–±–æ—á–∏–π –¥–µ–Ω—å: ${data.is_working_day}<br>
                        –í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤: ${data.total_slots}<br>
                        –î–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤: ${data.available_slots.length}<br>
                        <details>
                            <summary>–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `, 'success');
                } else {
                    showResult('apiResults', `
                        <strong>‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù!</strong><br>
                        –†–∞–±–æ—á–∏–π –¥–µ–Ω—å: ${data.is_working_day}<br>
                        –í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤: ${data.total_slots}<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `, 'error');
                }
            } catch (error) {
                showResult('apiResults', `
                    <strong>‚ùå –û–®–ò–ë–ö–ê API:</strong><br>
                    ${error.message}
                `, 'error');
            }
        }
        
        async function testServicePointData() {
            const resultsContainer = document.getElementById('apiResults');
            
            try {
                const response = await fetch(`${API_BASE}/service_points/4`);
                const data = await response.json();
                
                showResult('apiResults', `
                    <strong>üìç –î–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏:</strong><br>
                    ID: ${data.id}<br>
                    –ù–∞–∑–≤–∞–Ω–∏–µ: ${data.name}<br>
                    –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤: ${data.service_posts?.length || 0}<br>
                    <details>
                        <summary>–ü–æ—Å—Ç—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</summary>
                        <pre>${JSON.stringify(data.service_posts, null, 2)}</pre>
                    </details>
                `, 'info');
            } catch (error) {
                showResult('apiResults', `
                    <strong>‚ùå –û–®–ò–ë–ö–ê –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–æ—á–∫–∏:</strong><br>
                    ${error.message}
                `, 'error');
            }
        }
        
        async function testPostSchedules() {
            showResult('apiResults', `
                <strong>üìÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –ø–æ—Å—Ç–æ–≤:</strong><br>
                –ü–æ—Å—Ç "–ï–∫—Å–ø—Ä–µ—Å –ø–æ—Å—Ç" (ID=10) –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å:<br>
                ‚Ä¢ has_custom_schedule: true<br>
                ‚Ä¢ working_days.sunday: true<br>
                ‚Ä¢ custom_hours: {start: "09:00", end: "18:00"}<br>
                ‚Ä¢ slot_duration: 30 –º–∏–Ω—É—Ç
            `, 'info');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(testSundayAvailability, 1000);
        });
    </script>
</body>
</html> 