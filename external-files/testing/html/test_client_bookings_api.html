<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .response { background-color: #f8f9fa; padding: 10px; border-radius: 3px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞</h1>
    
    <div class="section info">
        <h3>üìã –ü—Ä–æ–±–ª–µ–º–∞</h3>
        <p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ <code>http://localhost:3008/client/bookings</code> –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∫–µ–Ω–¥–∞.</p>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º API –∑–∞–ø—Ä–æ—Å: <code>GET /api/v1/bookings?client_id=X</code></p>
    </div>

    <div class="section">
        <h3>üîê –®–∞–≥ 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
        <button onclick="login()">–í–æ–π—Ç–∏ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç</button>
        <button onclick="checkAuth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
        <div id="authResult" class="response"></div>
    </div>

    <div class="section">
        <h3>üìä –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
        <input type="number" id="clientId" placeholder="ID –∫–ª–∏–µ–Ω—Ç–∞" value="1">
        <button onclick="getBookings()">–ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        <button onclick="getBookingsDirectly()">–ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API</button>
        <div id="bookingsResult" class="response"></div>
    </div>

    <div class="section">
        <h3>üõ†Ô∏è –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        <button onclick="createTestBooking()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
        <div id="createResult" class="response"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authToken = localStorage.getItem('auth_token');

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'client@example.com',
                        password: 'password'
                    })
                });

                const data = await response.json();
                document.getElementById('authResult').textContent = JSON.stringify(data, null, 2);

                if (data.token) {
                    authToken = data.token;
                    localStorage.setItem('auth_token', authToken);
                    document.getElementById('authResult').className = 'response success';
                } else {
                    document.getElementById('authResult').className = 'response error';
                }
            } catch (error) {
                document.getElementById('authResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('authResult').className = 'response error';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuth() {
            const token = localStorage.getItem('auth_token');
            document.getElementById('authResult').textContent = `–¢–æ–∫–µ–Ω: ${token || '–ù–µ –Ω–∞–π–¥–µ–Ω'}`;
            
            if (token) {
                try {
                    const response = await fetch(`${API_BASE}/auth/me`, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const data = await response.json();
                    document.getElementById('authResult').textContent = JSON.stringify(data, null, 2);
                    document.getElementById('authResult').className = 'response success';
                } catch (error) {
                    document.getElementById('authResult').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞: ' + error.message;
                    document.getElementById('authResult').className = 'response error';
                }
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ RTK Query —ç–Ω–¥–ø–æ–∏–Ω—Ç
        async function getBookings() {
            const clientId = document.getElementById('clientId').value;
            const token = localStorage.getItem('auth_token');

            try {
                const response = await fetch(`${API_BASE}/bookings?client_id=${clientId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                document.getElementById('bookingsResult').textContent = 
                    `–°—Ç–∞—Ç—É—Å: ${response.status}\n\n${JSON.stringify(data, null, 2)}`;
                
                if (response.ok) {
                    document.getElementById('bookingsResult').className = 'response success';
                } else {
                    document.getElementById('bookingsResult').className = 'response error';
                }
            } catch (error) {
                document.getElementById('bookingsResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('bookingsResult').className = 'response error';
            }
        }

        // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
        async function getBookingsDirectly() {
            const clientId = document.getElementById('clientId').value;

            try {
                const response = await fetch(`${API_BASE}/bookings?client_id=${clientId}`, {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                document.getElementById('bookingsResult').textContent = 
                    `–°—Ç–∞—Ç—É—Å: ${response.status}\n\n${JSON.stringify(data, null, 2)}`;
                
                if (response.ok) {
                    document.getElementById('bookingsResult').className = 'response success';
                } else {
                    document.getElementById('bookingsResult').className = 'response error';
                }
            } catch (error) {
                document.getElementById('bookingsResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('bookingsResult').className = 'response error';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        async function createTestBooking() {
            const clientId = document.getElementById('clientId').value;

            try {
                const response = await fetch(`${API_BASE}/tests/create_test_booking`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        client_id: clientId,
                        service_point_id: 1
                    })
                });

                const data = await response.json();
                document.getElementById('createResult').textContent = 
                    `–°—Ç–∞—Ç—É—Å: ${response.status}\n\n${JSON.stringify(data, null, 2)}`;
                
                if (response.ok) {
                    document.getElementById('createResult').className = 'response success';
                } else {
                    document.getElementById('createResult').className = 'response error';
                }
            } catch (error) {
                document.getElementById('createResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('createResult').className = 'response error';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkAuth();
        };
    </script>
</body>
</html> 