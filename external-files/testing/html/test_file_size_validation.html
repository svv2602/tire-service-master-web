<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ - –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-title {
            color: #1976d2;
            margin-bottom: 20px;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 10px;
        }
        .test-case {
            background: #f8f9fa;
            padding: 20px;
            border-left: 4px solid #1976d2;
            margin: 15px 0;
        }
        .api-test {
            background: #e8f5e8;
            border-left-color: #4caf50;
        }
        .ui-test {
            background: #fff3e0;
            border-left-color: #ff9800;
        }
        .error-test {
            background: #ffebee;
            border-left-color: #f44336;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin: 5px 0;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .size-info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .file-samples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .file-sample {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }
        .improvement-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">üîç –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤</h1>
        <p><strong>–¶–µ–ª—å:</strong> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤</p>
        <p><strong>–î–∞—Ç–∞:</strong> 2 –∞–≤–≥—É—Å—Ç–∞ 2025</p>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status success">–ò–°–ü–†–ê–í–õ–ï–ù–û</span></p>
    </div>

    <div class="test-container">
        <h2 class="test-title">üö® –ü—Ä–æ–±–ª–µ–º–∞ –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        
        <div class="test-case error-test">
            <h3>‚ùå –õ–æ–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ø–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å"</h3>
            <div class="code-block">
if xml_content.size > 5.megabytes
  # TODO: –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ Sidekiq
  render json: {
    success: true,
    message: "–ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª –ø–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É",
    processing: true
  }
end</div>
            <div class="status error">–ü–†–û–ë–õ–ï–ú–ê: –§–∞–π–ª –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–∞–ª–∞ –æ–± —É—Å–ø–µ—Ö–µ</div>
        </div>

        <div class="test-case error-test">
            <h3>‚ùå –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π –ª–∏–º–∏—Ç</h3>
            <div class="size-info">
                <strong>–°—Ç–∞—Ä—ã–π –ª–∏–º–∏—Ç:</strong> 5MB<br>
                <strong>–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∞–π—Å—ã:</strong> 10-50MB<br>
                <strong>–ü—Ä–∏–º–µ—Ä hotline.xml:</strong> ~30MB (17,000 —Ç–æ–≤–∞—Ä–æ–≤)
            </div>
            <div class="status error">–ü–†–û–ë–õ–ï–ú–ê: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ–ø–∞–¥–∞–ª–æ –≤ "–±–æ–ª—å—à–∏–µ"</div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">‚úÖ –†–µ—à–µ–Ω–∏–µ –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        
        <div class="test-case api-test">
            <h3>üîß –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
            <div class="code-block">
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
file_size_mb = (xml_content.size / 1.megabyte).round(2)
Rails.logger.info "üìÅ –ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º #{file_size_mb}MB"

if xml_content.size > 25.megabytes
  # –ß–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  render json: {
    success: false,
    error: "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (#{file_size_mb}MB). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 25MB",
    file_size_mb: file_size_mb,
    max_size_mb: 25,
    suggestion: "–†–∞–∑–¥–µ–ª–∏—Ç–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤"
  }, status: :payload_too_large
else
  # –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
  processor = SupplierXmlProcessor.new(@supplier, xml_content)
  result = processor.process
end</div>
            <div class="status success">–ò–°–ü–†–ê–í–õ–ï–ù–û: –ß–µ—Å—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è + —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç</div>
        </div>

        <div class="test-case ui-test">
            <h3>üé® –£–ª—É—á—à–µ–Ω–∏—è UI</h3>
            <ul>
                <li>‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ MB</li>
                <li>‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ (25MB)</li>
                <li>‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Ä–∞–∑–º–µ—Ä–∞</li>
                <li>‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º—ã</li>
            </ul>
            <div class="status success">–î–û–ë–ê–í–õ–ï–ù–û: –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏</h2>
        
        <div class="file-samples">
            <div class="file-sample">
                <h4>üìÑ –ú–∞–ª—ã–π —Ñ–∞–π–ª (< 5MB)</h4>
                <strong>–ü—Ä–∏–º–µ—Ä:</strong> 1000 —Ç–æ–≤–∞—Ä–æ–≤<br>
                <strong>–†–∞–∑–º–µ—Ä:</strong> ~2MB<br>
                <strong>–ü–æ–≤–µ–¥–µ–Ω–∏–µ:</strong> –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞<br>
                <div class="status success">–†–ê–ë–û–¢–ê–ï–¢</div>
            </div>
            
            <div class="file-sample">
                <h4>üìÑ –°—Ä–µ–¥–Ω–∏–π —Ñ–∞–π–ª (5-25MB)</h4>
                <strong>–ü—Ä–∏–º–µ—Ä:</strong> 10000 —Ç–æ–≤–∞—Ä–æ–≤<br>
                <strong>–†–∞–∑–º–µ—Ä:</strong> ~15MB<br>
                <strong>–ü–æ–≤–µ–¥–µ–Ω–∏–µ:</strong> –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º<br>
                <div class="status success">–¢–ï–ü–ï–†–¨ –†–ê–ë–û–¢–ê–ï–¢</div>
            </div>
            
            <div class="file-sample">
                <h4>üìÑ –ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª (> 25MB)</h4>
                <strong>–ü—Ä–∏–º–µ—Ä:</strong> 50000 —Ç–æ–≤–∞—Ä–æ–≤<br>
                <strong>–†–∞–∑–º–µ—Ä:</strong> ~50MB<br>
                <strong>–ü–æ–≤–µ–¥–µ–Ω–∏–µ:</strong> –û—à–∏–±–∫–∞ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º —Ä–µ—à–µ–Ω–∏—è<br>
                <div class="status warning">–ß–ï–°–¢–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï</div>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2 class="test-title">üîç API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        
        <div class="test-case api-test">
            <h3>–¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</h3>
            <div class="code-block">
# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
curl -X POST -H "Content-Type: application/json" \
  -d '{"auth":{"email":"admin@test.com","password":"admin123"}}' \
  http://localhost:8000/api/v1/auth/login

# –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–ª—ã–π —Ñ–∞–π–ª
curl -X POST \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"xml_content":"<price><firmId>23951</firmId><items><item><id>1</id><name>Test</name></item></items></price>"}' \
  http://localhost:8000/api/v1/suppliers/1/admin_upload_price</div>
            <div class="status success">–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
        </div>

        <div class="test-case error-test">
            <h3>–¢–µ—Å—Ç 2: –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª</h3>
            <div class="code-block">
# –°–∏–º—É–ª—è—Ü–∏—è –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞ (—Å–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É >25MB)
large_xml = "<price><firmId>23951</firmId><items>" + 
           ("<item><id>1</id><name>Test</name></item>" * 500000) + 
           "</items></price>"

curl -X POST \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d "{\"xml_content\":\"#{large_xml}\"}" \
  http://localhost:8000/api/v1/suppliers/1/admin_upload_price</div>
            <div class="status error">–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: HTTP 413, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ä–∞–∑–º–µ—Ä–∞</div>
        </div>
    </div>

    <div class="improvement-section">
        <h2>üöÄ –ü–ª–∞–Ω—ã –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è</h2>
        
        <h3>üìã –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:</h3>
        <ul>
            <li>üìä –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è —Ñ–∞–π–ª–æ–≤ 10MB+</li>
            <li>‚è±Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</li>
            <li>üìà –î–∞—à–±–æ—Ä–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∑–æ–∫</li>
        </ul>

        <h3>üîß –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:</h3>
        <ul>
            <li>üîÑ <strong>Sidekiq</strong> - –Ω–∞—Å—Ç–æ—è—â–∞—è —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</li>
            <li>üåê <strong>WebSocket</strong> - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</li>
            <li>üì¶ <strong>Chunked upload</strong> - –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —á–∞—Å—Ç—è–º–∏</li>
            <li>üóúÔ∏è <strong>–°–∂–∞—Ç–∏–µ</strong> - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ XML</li>
        </ul>

        <h3>üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</h3>
        <ul>
            <li>‚úÖ <strong>–ß–µ—Å—Ç–Ω–æ—Å—Ç—å</strong> - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ª–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</li>
            <li>‚úÖ <strong>–ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å</strong> - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è</li>
            <li>‚úÖ <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å</strong> - –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö</li>
            <li>‚úÖ <strong>–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å</strong> - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ</li>
        </ul>
    </div>

    <div class="test-container">
        <h2 class="test-title">üìä –ó–∞–∫–ª—é—á–µ–Ω–∏–µ</h2>
        
        <div class="test-case api-test">
            <h3>‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:</h3>
            <ul>
                <li>üö´ –£–±—Ä–∞–Ω–æ –ª–æ–∂–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ø–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å"</li>
                <li>üìè –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç —Å 5MB –¥–æ 25MB</li>
                <li>üìù –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤</li>
                <li>üé® –£–ª—É—á—à–µ–Ω UI —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–∞–∑–º–µ—Ä–æ–≤</li>
                <li>üí¨ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö</li>
            </ul>
        </div>

        <div class="test-case ui-test">
            <h3>üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
            <p><strong>–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Å—Ç–Ω–æ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ!</strong></p>
            <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —Å–∏—Å—Ç–µ–º—ã –∏ —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.</p>
            <div class="status success">–ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£</div>
        </div>
    </div>

</body>
</html>