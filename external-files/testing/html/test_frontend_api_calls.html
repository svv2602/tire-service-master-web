<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –≤—ã–∑–æ–≤–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.success {
            background: #28a745;
        }
        .button.error {
            background: #dc3545;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .section {
            margin: 20px 0;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        h2 {
            color: #343a40;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç API –≤—ã–∑–æ–≤–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞</h1>
    
    <div class="container">
        <h2>1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
        <button class="button" onclick="testLogin()">üîê –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
        <button class="button" onclick="testGetMe()">üë§ –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <button class="button" onclick="testLogout()">üö™ –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</button>
        <div id="auth-status" class="section"></div>
    </div>

    <div class="container">
        <h2>2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
        <button class="button" onclick="testGetUsers()">üë• –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
        <button class="button" onclick="testGetClients()">üè¢ –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤</button>
        <button class="button" onclick="testGetPartners()">ü§ù –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</button>
        <button class="button" onclick="testGetServicePoints()">üìç –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
        <div id="data-status" class="section"></div>
    </div>

    <div class="container">
        <h2>3. –õ–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤</h2>
        <button class="button" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        <div id="log" class="log"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authToken = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            logDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<span class="status ${type}">${message}</span>`;
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        async function makeRequest(url, options = {}) {
            const config = {
                credentials: 'include', // –í–∞–∂–Ω–æ –¥–ª—è cookie-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };

            if (authToken && !options.skipAuth) {
                config.headers['Authorization'] = `Bearer ${authToken}`;
            }

            log(`üì§ ${config.method || 'GET'} ${url}`);
            
            try {
                const response = await fetch(url, config);
                const data = await response.json();
                
                if (response.ok) {
                    log(`üì• ${response.status} - –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç`, 'success');
                    console.log('Response data:', data);
                    return { success: true, data, status: response.status };
                } else {
                    log(`üì• ${response.status} - –û—à–∏–±–∫–∞: ${data.error || data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                    return { success: false, error: data, status: response.status };
                }
            } catch (error) {
                log(`üì• –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
                return { success: false, error: error.message, status: 0 };
            }
        }

        async function testLogin() {
            updateStatus('auth-status', '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/auth/login`, {
                method: 'POST',
                body: JSON.stringify({
                    email: 'admin@test.com',
                    password: 'admin123'
                }),
                skipAuth: true
            });

            if (result.success) {
                authToken = result.data.tokens?.access;
                updateStatus('auth-status', '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É', 'success');
                log(`üîë –ü–æ–ª—É—á–µ–Ω —Ç–æ–∫–µ–Ω: ${authToken ? authToken.substring(0, 20) + '...' : '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}`, 'success');
            } else {
                updateStatus('auth-status', `‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${result.error?.error || result.error}`, 'error');
            }
        }

        async function testGetMe() {
            updateStatus('auth-status', '–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/auth/me`);

            if (result.success) {
                updateStatus('auth-status', `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${result.data.user?.email || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`, 'success');
            } else {
                updateStatus('auth-status', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${result.error?.error || result.error}`, 'error');
            }
        }

        async function testLogout() {
            updateStatus('auth-status', '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã—Ö–æ–¥...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/auth/logout`, {
                method: 'POST'
            });

            if (result.success) {
                authToken = null;
                updateStatus('auth-status', '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
            } else {
                updateStatus('auth-status', `‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ${result.error?.error || result.error}`, 'error');
            }
        }

        async function testGetUsers() {
            updateStatus('data-status', '–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/users?page=1&per_page=5`);

            if (result.success) {
                const count = result.data.data?.length || 0;
                updateStatus('data-status', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${count}`, 'success');
            } else {
                updateStatus('data-status', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${result.error?.error || result.error}`, 'error');
            }
        }

        async function testGetClients() {
            updateStatus('data-status', '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/clients?page=1&per_page=5`);

            if (result.success) {
                const count = result.data.data?.length || 0;
                updateStatus('data-status', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${count}`, 'success');
            } else {
                updateStatus('data-status', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${result.error?.error || result.error}`, 'error');
            }
        }

        async function testGetPartners() {
            updateStatus('data-status', '–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/partners?page=1&per_page=5`);

            if (result.success) {
                const count = result.data.data?.length || 0;
                updateStatus('data-status', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤: ${count}`, 'success');
            } else {
                updateStatus('data-status', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤: ${result.error?.error || result.error}`, 'error');
            }
        }

        async function testGetServicePoints() {
            updateStatus('data-status', '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫...', 'pending');
            
            const result = await makeRequest(`${API_BASE}/service_points?page=1&per_page=5`);

            if (result.success) {
                const count = result.data.data?.length || 0;
                updateStatus('data-status', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫: ${count}`, 'success');
            } else {
                updateStatus('data-status', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫: ${result.error?.error || result.error}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –≤—ã–∑–æ–≤–æ–≤ –∑–∞–ø—É—â–µ–Ω–æ');
            log('üí° –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É, –∑–∞—Ç–µ–º —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö');
        });
    </script>
</body>
</html>
