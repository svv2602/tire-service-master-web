<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stat-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            text-align: center;
            display: inline-block;
            width: 200px;
            vertical-align: top;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 5px;
        }
        
        .stat-value.success {
            color: #2e7d32;
        }
        
        .stat-value.info {
            color: #0288d1;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .test-step {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #1976d2;
            background: #f8f9fa;
        }
        
        .api-response {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .success {
            color: #2e7d32;
        }
        
        .error {
            color: #d32f2f;
        }
        
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞</h1>
        <p><strong>–ó–∞–¥–∞—á–∞:</strong> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /client/profile –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞</p>
        <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ü–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –Ω—É–ª–∏ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API /auth/me –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞</p>
    </div>

    <div class="container">
        <h2>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
        <div class="test-step">
            <h3>1. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã API (auth.api.ts)</h3>
            <ul>
                <li>–î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å <code>FullUserResponse</code> —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∫–ª–∏–µ–Ω—Ç–∞</li>
                <li>–û–±–Ω–æ–≤–ª–µ–Ω endpoint <code>getCurrentUser</code> –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞</li>
                <li>–í–∫–ª—é—á–µ–Ω—ã –ø–æ–ª—è: <code>total_bookings</code>, <code>completed_bookings</code>, <code>average_rating_given</code></li>
            </ul>
        </div>
        
        <div class="test-step">
            <h3>2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è (ClientProfilePage.tsx)</h3>
            <ul>
                <li>–î–æ–±–∞–≤–ª–µ–Ω —Ö—É–∫ <code>useGetCurrentUserQuery()</code> –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</li>
                <li>–ó–∞–º–µ–Ω–µ–Ω—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –Ω—É–ª–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API</li>
                <li>–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫</li>
                <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: –≤—Å–µ–≥–æ - –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</li>
            </ul>
        </div>
        
        <div class="test-step">
            <h3>3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã TypeScript –æ—à–∏–±–∫–∏</h3>
            <ul>
                <li>–û–±–Ω–æ–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ <code>authUser?.user</code></li>
                <li>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ <code>NewBookingWithAvailabilityPage.tsx</code></li>
                <li>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ <code>MyBookingsPage.tsx</code></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h2>
        
        <div class="test-step">
            <h3>–®–∞–≥ 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h3>
            <p>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: svv2@gmail.com / 0501111111</p>
            <button onclick="testLogin()">–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
            <div id="loginResult" class="api-response"></div>
        </div>
        
        <div class="test-step">
            <h3>–®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h3>
            <button onclick="testGetUserStats()">–¢–µ—Å—Ç /auth/me</button>
            <div id="statsResult" class="api-response"></div>
        </div>
        
        <div class="test-step">
            <h3>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ</h3>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É: <a href="http://localhost:3008/client/profile" target="_blank">http://localhost:3008/client/profile</a></p>
            <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</p>
        </div>
    </div>

    <div class="container">
        <h2>üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        
        <div class="test-step">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (svv2@gmail.com):</h3>
            <div class="stat-card">
                <div class="stat-value">1</div>
                <div class="stat-label">–í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value success">0</div>
                <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value info">1</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>
            </div>
        </div>
        
        <div class="test-step">
            <h3>‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:</h3>
            <ul>
                <li>‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ API, –∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω—É–ª–∏</li>
                <li>‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</li>
                <li>‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥</li>
                <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</li>
                <li>‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ</li>
                <li>‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>üîç –û—Ç–ª–∞–¥–∫–∞</h2>
        <div class="test-step">
            <p><strong>–ï—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:</strong></p>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ /auth/me</li>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é client —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ console.log –≤ ClientProfilePage –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</li>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç</li>
            </ol>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authToken = '';

        async function testLogin() {
            const loginResult = document.getElementById('loginResult');
            loginResult.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...';
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        auth: {
                            login: 'svv2@gmail.com',
                            password: '0501111111'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.access_token;
                    loginResult.innerHTML = `<span class="success">‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    loginResult.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                loginResult.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:</span>\n${error.message}`;
            }
        }

        async function testGetUserStats() {
            const statsResult = document.getElementById('statsResult');
            
            if (!authToken) {
                statsResult.innerHTML = `<span class="error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</span>`;
                return;
            }
            
            statsResult.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...';
            
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    statsResult.innerHTML = `<span class="success">‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞!</span>\n${JSON.stringify(data, null, 2)}`;
                    
                    // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                    if (data.client) {
                        const stats = data.client;
                        const activeBookings = stats.total_bookings - stats.completed_bookings;
                        
                        statsResult.innerHTML += `\n\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:
- –í—Å–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${stats.total_bookings}
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥: ${stats.completed_bookings}
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${activeBookings}
- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: ${stats.average_rating_given}`;
                    }
                } else {
                    statsResult.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                statsResult.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:</span>\n${error.message}`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            console.log('üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
    </script>
</body>
</html> 