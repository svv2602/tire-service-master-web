<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å Chat API</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #e74c3c;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .error-section {
            background: #fee;
            border: 1px solid #fcc;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .diagnostic-step {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #f39c12;
            margin: 15px 0;
        }
        
        .diagnostic-step h3 {
            color: #e67e22;
            margin-top: 0;
        }
        
        .code-block {
            background: #263238;
            color: #81c784;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .instruction {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .instruction h4 {
            color: #1976d2;
            margin-top: 0;
        }
        
        .checklist {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .checklist input[type="checkbox"] {
            margin-right: 10px;
        }
        
        .checklist label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
        }
        
        .api-test {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .api-test h4 {
            color: #155724;
            margin-top: 0;
        }
        
        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .note strong {
            color: #f39c12;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å Chat API</h1>
        
        <div class="error-section">
            <h2>–ü—Ä–æ–±–ª–µ–º–∞:</h2>
            <p><strong>–°–∏–º–ø—Ç–æ–º:</strong> –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —á–∞—Ç—É –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—à–∏–±–∫—É: "–ò–∑–≤–∏–Ω–∏—Ç–µ, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞."</p>
            <p><strong>–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç:</strong> –ö–∞–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–æ–≤, —Ç–∞–∫ –∏ –æ–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫ —á–∞—Ç—É</p>
            <p><strong>–í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:</strong> LLM API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ</p>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞</h3>
            <div class="instruction">
                <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h4>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="http://localhost:3008/client/tire-offers" target="_blank">—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —á–∞—Ç–æ–º</a></li>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12)</li>
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console</li>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–¥–∞—Ç—å –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å</li>
                    <li>–ù–∞–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–∞—à–µ–π –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</li>
                </ol>
            </div>
            
            <div class="checklist">
                <h4>–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:</h4>
                <label><input type="checkbox"> <code>=== sendToLLM Debug ===</code></label>
                <label><input type="checkbox"> <code>query: ...</code></label>
                <label><input type="checkbox"> <code>Request body: ...</code></label>
                <label><input type="checkbox"> <code>Response status: ...</code></label>
                <label><input type="checkbox"> <code>Response data: ...</code></label>
                <label><input type="checkbox"> –û—à–∏–±–∫–∏ —Å–µ—Ç–∏ –∏–ª–∏ 500/400 —Å—Ç–∞—Ç—É—Å—ã</label>
            </div>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ API –Ω–∞–ø—Ä—è–º—É—é</h3>
            <div class="api-test">
                <h4>–¢–µ—Å—Ç API —á–µ—Ä–µ–∑ curl:</h4>
                <div class="code-block">
curl -X POST http://localhost:8000/api/v1/tire_chat/message \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
    "locale": "ru",
    "is_quick_question": false
  }'
                </div>
                <p><strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> JSON –æ—Ç–≤–µ—Ç —Å success: true –∏ response.message</p>
            </div>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–µ–Ω–¥–∞</h3>
            <div class="checklist">
                <h4>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ:</h4>
                <label><input type="checkbox"> –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8000</label>
                <label><input type="checkbox"> –≠–Ω–¥–ø–æ–∏–Ω—Ç /api/v1/tire_chat/message —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</label>
                <label><input type="checkbox"> LLM —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, OpenAI API) –¥–æ—Å—Ç—É–ø–µ–Ω</label>
                <label><input type="checkbox"> API –∫–ª—é—á–∏ –¥–ª—è LLM –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</label>
                <label><input type="checkbox"> –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã</label>
            </div>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ—É—Ç–æ–≤</h3>
            <div class="instruction">
                <h4>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã –≤ config/routes.rb:</h4>
                <div class="code-block">
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
namespace :api do
  namespace :v1 do
    resources :tire_chat, only: [] do
      collection do
        post :message
      end
    end
  end
end
                </div>
            </div>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞</h3>
            <div class="instruction">
                <h4>–§–∞–π–ª: app/controllers/api/v1/tire_chat_controller.rb</h4>
                <p>–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:</p>
                <ul>
                    <li>–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</li>
                    <li>–ú–µ—Ç–æ–¥ <code>message</code> –æ–ø—Ä–µ–¥–µ–ª–µ–Ω</li>
                    <li>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã <code>is_brand_comparison</code> –∏ <code>brands_to_compare</code></li>
                    <li>LLM —Å–µ—Ä–≤–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è</li>
                </ul>
            </div>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 6: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ</h3>
            <div class="note">
                <strong>–ï—Å–ª–∏ LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:</strong>
                <p>–ú–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∑–∞–≥–ª—É—à–∫—É –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è frontend –ª–æ–≥–∏–∫–∏:</p>
                <div class="code-block">
def message
  # –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  if params[:is_brand_comparison]
    mock_response = "–¢–ï–°–¢–û–í–û–ï –°–†–ê–í–ù–ï–ù–ò–ï:\n\n"
    mock_response += "Continental PremiumContact 6:\n"
    mock_response += "- –û—Ç–ª–∏—á–Ω–æ–µ —Å—Ü–µ–ø–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–∫—Ä–æ–π –¥–æ—Ä–æ–≥–µ\n"
    mock_response += "- –ü—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ\n\n"
    mock_response += "Pirelli P Zero:\n"
    mock_response += "- –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏\n"
    mock_response += "- –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å\n\n"
    mock_response += "–í—ã–≤–æ–¥: –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–ª–∏—á–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π."
    
    render json: {
      success: true,
      response: {
        message: mock_response
      },
      conversation_id: SecureRandom.uuid
    }
  else
    render json: {
      success: true,
      response: {
        message: "–¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç: #{params[:message]}"
      },
      conversation_id: SecureRandom.uuid
    }
  end
end
                </div>
            </div>
        </div>

        <div class="diagnostic-step">
            <h3>–®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤</h3>
            <div class="instruction">
                <h4>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤:</h4>
                <div class="code-block">
# –í –ø–∞–ø–∫–µ tire-service-master-api
tail -f log/development.log

# –ò–ª–∏
rails server # –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
                </div>
                <p>–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ POST –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ /api/v1/tire_chat/message</p>
            </div>
        </div>

        <div class="api-test">
            <h4>–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:</h4>
            <ol>
                <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞</strong> - –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞—à–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</li>
                <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ API</strong> - 200, 404, 500?</li>
                <li><strong>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞</strong> - –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏?</li>
                <li><strong>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API –Ω–∞–ø—Ä—è–º—É—é</strong> - —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ curl –∑–∞–ø—Ä–æ—Å?</li>
                <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ LLM —Å–µ—Ä–≤–∏—Å</strong> - –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –≤–Ω–µ—à–Ω–∏–π API?</li>
            </ol>
        </div>

        <div class="note">
            <strong>–í–∞–∂–Ω–æ:</strong> –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–¥ (console.log), –ø–æ—ç—Ç–æ–º—É –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞.
        </div>
    </div>
</body>
</html>