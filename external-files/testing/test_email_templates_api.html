<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Email Templates API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            color: #1976d2;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #1565c0;
        }
        .result {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        .error {
            border-color: #f44336;
            background: #ffebee;
        }
        .template-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            background: #fafafa;
        }
        .template-name {
            font-weight: bold;
            color: #1976d2;
            margin-bottom: 5px;
        }
        .template-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .template-subject {
            background: white;
            padding: 8px;
            border-radius: 3px;
            margin-bottom: 8px;
            font-style: italic;
        }
        .status-active {
            color: #4caf50;
            font-weight: bold;
        }
        .status-inactive {
            color: #f44336;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">üß™ –¢–µ—Å—Ç Email Templates API</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Email Templates API</p>
        
        <!-- –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div class="test-section">
            <div class="test-title">üîë –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</div>
            <input type="text" id="authToken" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" style="width: 100%; padding: 8px; margin-bottom: 10px;">
            <button onclick="setDefaultToken()">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω</button>
            <div id="tokenResult" class="result" style="display: none;"></div>
        </div>

        <!-- –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ -->
        <div class="test-section">
            <div class="test-title">üìã –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤</div>
            <button onclick="getEmailTemplates()">–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —à–∞–±–ª–æ–Ω—ã</button>
            <button onclick="getEmailTemplates('?active=true')">–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ</button>
            <button onclick="getEmailTemplates('?language=uk')">–¢–æ–ª—å–∫–æ —É–∫—Ä–∞–∏–Ω—Å–∫–∏–µ</button>
            <button onclick="getEmailTemplates('?search=–±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è')">–ü–æ–∏—Å–∫ "–±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è"</button>
            <div id="templatesResult" class="result" style="display: none;"></div>
        </div>

        <!-- –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤ -->
        <div class="test-section">
            <div class="test-title">üè∑Ô∏è –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤</div>
            <button onclick="getTemplateTypes()">–ü–æ–ª—É—á–∏—Ç—å —Ç–∏–ø—ã —à–∞–±–ª–æ–Ω–æ–≤</button>
            <div id="typesResult" class="result" style="display: none;"></div>
        </div>

        <!-- –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ -->
        <div class="test-section">
            <div class="test-title">üìÑ –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞</div>
            <input type="number" id="templateId" placeholder="ID —à–∞–±–ª–æ–Ω–∞" value="1" style="padding: 8px; margin-right: 10px;">
            <button onclick="getEmailTemplate()">–ü–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
            <div id="templateResult" class="result" style="display: none;"></div>
        </div>

        <!-- –¢–µ—Å—Ç 4: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä -->
        <div class="test-section">
            <div class="test-title">üëÅÔ∏è –¢–µ—Å—Ç 4: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞</div>
            <input type="number" id="previewTemplateId" placeholder="ID —à–∞–±–ª–æ–Ω–∞" value="2" style="padding: 8px; margin-right: 10px;">
            <button onclick="previewTemplate()">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</button>
            <div id="previewResult" class="result" style="display: none;"></div>
        </div>

        <!-- –¢–µ—Å—Ç 5: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ -->
        <div class="test-section">
            <div class="test-title">‚ûï –¢–µ—Å—Ç 5: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞</div>
            <button onclick="createTestTemplate()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω</button>
            <div id="createResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api/v1';
        let authToken = '';

        function setDefaultToken() {
            authToken = 'eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyLCJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzUzMDk4MDIwfQ.3QqeGaoUbIgdapcbsESmz49r5kxyACkTbCE-VpzwElo';
            document.getElementById('authToken').value = authToken;
            showResult('tokenResult', '‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
        }

        function showResult(elementId, content, type = '') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = content;
            element.className = `result ${type}`;
        }

        async function makeApiRequest(url, options = {}) {
            const token = document.getElementById('authToken').value || authToken;
            
            if (!token) {
                return { error: '–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω"' };
            }

            try {
                const response = await fetch(API_BASE_URL + url, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`,
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                return { error: error.message };
            }
        }

        async function getEmailTemplates(params = '') {
            const data = await makeApiRequest(`/email_templates${params}`);
            
            if (data.error) {
                showResult('templatesResult', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                return;
            }

            let result = `‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —à–∞–±–ª–æ–Ω–æ–≤: ${data.data.length}\n`;
            result += `üìä –ü–∞–≥–∏–Ω–∞—Ü–∏—è: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ${data.pagination.current_page} –∏–∑ ${data.pagination.total_pages}, –≤—Å–µ–≥–æ ${data.pagination.total_count}\n\n`;
            
            data.data.forEach((template, index) => {
                result += `${index + 1}. ${template.name}\n`;
                result += `   –¢–∏–ø: ${template.template_type_name}\n`;
                result += `   –Ø–∑—ã–∫: ${template.language}\n`;
                result += `   –°—Ç–∞—Ç—É—Å: ${template.status_text}\n`;
                result += `   –¢–µ–º–∞: ${template.subject}\n`;
                result += `   –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: [${template.variables_array.join(', ')}]\n`;
                result += `   –°–æ–∑–¥–∞–Ω: ${new Date(template.created_at).toLocaleString('ru-RU')}\n\n`;
            });

            showResult('templatesResult', result, 'success');
        }

        async function getTemplateTypes() {
            const data = await makeApiRequest('/email_templates/template_types');
            
            if (data.error) {
                showResult('typesResult', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                return;
            }

            let result = `‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã —à–∞–±–ª–æ–Ω–æ–≤:\n\n`;
            data.data.forEach((type, index) => {
                result += `${index + 1}. ${type.label} (${type.value})\n`;
            });

            showResult('typesResult', result, 'success');
        }

        async function getEmailTemplate() {
            const templateId = document.getElementById('templateId').value;
            
            if (!templateId) {
                showResult('templateResult', '‚ùå –í–≤–µ–¥–∏—Ç–µ ID —à–∞–±–ª–æ–Ω–∞', 'error');
                return;
            }

            const data = await makeApiRequest(`/email_templates/${templateId}`);
            
            if (data.error) {
                showResult('templateResult', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                return;
            }

            let result = `‚úÖ –®–∞–±–ª–æ–Ω "${data.name}"\n\n`;
            result += `ID: ${data.id}\n`;
            result += `–¢–∏–ø: ${data.template_type_name} (${data.template_type})\n`;
            result += `–Ø–∑—ã–∫: ${data.language}\n`;
            result += `–°—Ç–∞—Ç—É—Å: ${data.status_text}\n`;
            result += `–¢–µ–º–∞: ${data.subject}\n`;
            result += `–û–ø–∏—Å–∞–Ω–∏–µ: ${data.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}\n`;
            result += `–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: [${data.variables_array.join(', ')}]\n`;
            result += `–°–æ–∑–¥–∞–Ω: ${new Date(data.created_at).toLocaleString('ru-RU')}\n`;
            result += `–û–±–Ω–æ–≤–ª–µ–Ω: ${new Date(data.updated_at).toLocaleString('ru-RU')}\n\n`;
            result += `–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:\n${data.body}`;

            showResult('templateResult', result, 'success');
        }

        async function previewTemplate() {
            const templateId = document.getElementById('previewTemplateId').value;
            
            if (!templateId) {
                showResult('previewResult', '‚ùå –í–≤–µ–¥–∏—Ç–µ ID —à–∞–±–ª–æ–Ω–∞', 'error');
                return;
            }

            const testVariables = {
                client_name: '–û–ª–µ–∫—Å–∞–Ω–¥—Ä –ü–µ—Ç—Ä–µ–Ω–∫–æ',
                service_name: '–ó–∞–º—ñ–Ω–∞ —à–∏–Ω',
                booking_date: '25.07.2025',
                booking_time: '14:30',
                service_point_name: '–°–¢–û –ê–≤—Ç–æ—Å–µ—Ä–≤—ñ—Å –ö–∏—ó–≤'
            };

            const data = await makeApiRequest(`/email_templates/${templateId}/preview`, {
                method: 'POST',
                body: JSON.stringify({ variables: testVariables })
            });
            
            if (data.error) {
                showResult('previewResult', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                return;
            }

            let result = `‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞\n\n`;
            result += `üìß –¢–µ–º–∞ –ø–∏—Å—å–º–∞:\n${data.subject}\n\n`;
            result += `üìù –°–æ–¥–µ—Ä–∂–∏–º–æ–µ:\n${data.body}\n\n`;
            result += `üè∑Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: [${data.variables.join(', ')}]`;

            showResult('previewResult', result, 'success');
        }

        async function createTestTemplate() {
            const templateData = {
                name: '–¢–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω API',
                subject: '–¢–µ—Å—Ç API - {service_name}',
                body: '–®–∞–Ω–æ–≤–Ω–∏–π(–∞) {client_name}!\n\n–¶–µ —Ç–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–µ —á–µ—Ä–µ–∑ API.\n\n–î–µ—Ç–∞–ª—ñ:\nüìÖ –î–∞—Ç–∞: {booking_date}\nüïí –ß–∞—Å: {booking_time}\n\n–î—è–∫—É—î–º–æ –∑–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–∞—à–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É!',
                template_type: 'user_welcome',
                language: 'uk',
                is_active: true,
                variables: ['client_name', 'service_name', 'booking_date', 'booking_time'],
                description: '–¢–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏'
            };

            const data = await makeApiRequest('/email_templates', {
                method: 'POST',
                body: JSON.stringify({ email_template: templateData })
            });
            
            if (data.error) {
                showResult('createResult', `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 'error');
                return;
            }

            let result = `‚úÖ –®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!\n\n`;
            result += `ID: ${data.id}\n`;
            result += `–ù–∞–∑–≤–∞–Ω–∏–µ: ${data.name}\n`;
            result += `–¢–∏–ø: ${data.template_type_name}\n`;
            result += `–°—Ç–∞—Ç—É—Å: ${data.status_text}\n`;
            result += `–°–æ–∑–¥–∞–Ω: ${new Date(data.created_at).toLocaleString('ru-RU')}`;

            showResult('createResult', result, 'success');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            setDefaultToken();
        };
    </script>
</body>
</html> 