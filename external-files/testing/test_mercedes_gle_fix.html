<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Mercedes GLE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .result-box {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #4ecdc4;
        }
        .success { border-left-color: #2ecc71; }
        .warning { border-left-color: #f39c12; }
        .error { border-left-color: #e74c3c; }
        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .model-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            display: inline-block;
            min-width: 200px;
        }
        .model-card.correct { border: 2px solid #2ecc71; }
        .model-card.wrong { border: 2px solid #e74c3c; }
        .timestamp {
            color: #bdc3c7;
            font-size: 12px;
            margin-bottom: 10px;
        }
        h1 { text-align: center; margin-bottom: 30px; }
        h2 { color: #4ecdc4; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ Mercedes GLE</h1>
        
        <div class="result-box">
            <h2>üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∞</h2>
            <p>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å <strong>"–º–µ—Ä—Å–µ–¥–µ—Å –≥–ª–µ"</strong> —Ç–µ–ø–µ—Ä—å:</p>
            <ul>
                <li>‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç <code>status: "success"</code> (–Ω–µ model_ambiguous)</li>
                <li>‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ GLE –º–æ–¥–µ–ª–∏ (–Ω–µ A-Class)</li>
                <li>‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ñ–æ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ "–≥–ª–µ" ‚Üí "GLE"</li>
            </ul>
        </div>

        <div style="text-align: center;">
            <button class="test-button" onclick="testOriginalQuery()">üîç –¢–µ—Å—Ç: "–º–µ—Ä—Å–µ–¥–µ—Å –∂–ª–µ"</button>
            <button class="test-button" onclick="testAlternative()">üîç –¢–µ—Å—Ç: "–º–µ—Ä—Å–µ–¥–µ—Å –≥–ª–µ"</button>
            <button class="test-button" onclick="testDirect()">üîç –¢–µ—Å—Ç: "mercedes gle"</button>
            <button class="test-button" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let testCount = 0;

        function addTimestamp() {
            return `<div class="timestamp">${new Date().toLocaleString()}</div>`;
        }

        async function testCarSearch(query, description) {
            testCount++;
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML += `
                <div class="result-box">
                    ${addTimestamp()}
                    <h2>üß™ –¢–µ—Å—Ç ${testCount}: ${description}</h2>
                    <p><strong>–ó–∞–ø—Ä–æ—Å:</strong> "${query}"</p>
                    <div id="loading-${testCount}">‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ API...</div>
                </div>
            `;

            try {
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞
                const cacheBuster = Date.now();
                const response = await fetch(`http://localhost:8000/api/v1/car_tire_search/search?_=${cacheBuster}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    body: JSON.stringify({ 
                        query: query, 
                        locale: "ru",
                        timestamp: cacheBuster
                    })
                });

                const data = await response.json();
                
                document.getElementById(`loading-${testCount}`).innerHTML = '';
                
                // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                let resultClass = 'result-box ';
                let analysis = '';
                
                if (data.status === 'success') {
                    resultClass += 'success';
                    analysis = `
                        <h3>‚úÖ –£–°–ü–ï–•! API –∏—Å–ø—Ä–∞–≤–ª–µ–Ω</h3>
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.status}</p>
                        <p><strong>–†–∞–∑–º–µ—Ä–æ–≤ —à–∏–Ω:</strong> ${data.tire_sizes?.length || 0}</p>
                        <p><strong>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:</strong> ${data.tire_offers?.length || 0}</p>
                        <p><strong>LLM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω:</strong> ${data.query?.llm_used ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}</p>
                        <p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å LLM:</strong> ${data.query?.llm_confidence || 'N/A'}</p>
                    `;
                } else if (data.status === 'model_ambiguous') {
                    const hasCorrectModels = data.models?.some(m => m.name.includes('GLE'));
                    const hasWrongModels = data.models?.some(m => m.name.includes('A-Class'));
                    
                    if (hasCorrectModels && !hasWrongModels) {
                        resultClass += 'success';
                        analysis = `
                            <h3>‚úÖ –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û</h3>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.status} (–Ω–æ –º–æ–¥–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ)</p>
                            <p><strong>–ù–∞–π–¥–µ–Ω–æ –º–æ–¥–µ–ª–µ–π:</strong> ${data.models?.length || 0}</p>
                        `;
                    } else if (hasWrongModels) {
                        resultClass += 'error';
                        analysis = `
                            <h3>‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–ê</h3>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.status}</p>
                            <p><strong>–ù–∞–π–¥–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏!</strong></p>
                        `;
                    } else {
                        resultClass += 'warning';
                        analysis = `
                            <h3>‚ö†Ô∏è –ù–ï–û–ñ–ò–î–ê–ù–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢</h3>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.status}</p>
                        `;
                    }
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–µ–ª–∏
                    if (data.models && data.models.length > 0) {
                        analysis += '<h4>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:</h4>';
                        data.models.forEach(model => {
                            const isCorrect = model.name.includes('GLE');
                            analysis += `
                                <div class="model-card ${isCorrect ? 'correct' : 'wrong'}">
                                    ${isCorrect ? '‚úÖ' : '‚ùå'} <strong>${model.name}</strong><br>
                                    <small>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π: ${model.configs_count}</small>
                                </div>
                            `;
                        });
                    }
                } else {
                    resultClass += 'error';
                    analysis = `
                        <h3>‚ùå –û–®–ò–ë–ö–ê</h3>
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.status}</p>
                        <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${data.message || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è'}</p>
                    `;
                }
                
                resultsDiv.lastElementChild.className = resultClass;
                resultsDiv.lastElementChild.innerHTML += analysis;
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π JSON –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                resultsDiv.lastElementChild.innerHTML += `
                    <details style="margin-top: 20px;">
                        <summary>üîç –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)</summary>
                        <div class="code">${JSON.stringify(data, null, 2)}</div>
                    </details>
                `;
                
            } catch (error) {
                document.getElementById(`loading-${testCount}`).innerHTML = `
                    <div class="result-box error">
                        <h3>üö´ –û–®–ò–ë–ö–ê –°–ï–¢–ò</h3>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                        <p>–í–æ–∑–º–æ–∂–Ω–æ, —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å CORS.</p>
                    </div>
                `;
            }
            
            // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            resultsDiv.lastElementChild.scrollIntoView({ behavior: 'smooth' });
        }

        async function testOriginalQuery() {
            await testCarSearch("–º–µ—Ä—Å–µ–¥–µ—Å –∂–ª–µ", "–ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å");
        }

        async function testAlternative() {
            await testCarSearch("–º–µ—Ä—Å–µ–¥–µ—Å –≥–ª–µ", "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ");
        }

        async function testDirect() {
            await testCarSearch("mercedes gle", "–õ–∞—Ç–∏–Ω–∏—Ü–∞");
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testCount = 0;
        }

        // –ê–≤—Ç–æ—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            console.log('üí° –ù–∞–∂–º–∏—Ç–µ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        };
    </script>
</body>
</html>