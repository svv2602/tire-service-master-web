<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ —à–∏–Ω</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .test-section:hover {
            border-color: #2196F3;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.1);
        }

        .test-section h3 {
            color: #1976D2;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 200px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #2196F3;
        }

        .btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #757575, #616161);
        }

        .btn.success {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }

        .btn.danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .result-area {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #2196F3;
        }

        .result-area h4 {
            color: #1976D2;
            margin-bottom: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
        }

        .status.pending {
            background: #fff3e0;
            color: #ef6c00;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .api-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #2196F3;
        }

        .api-info code {
            background: #1976D2;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .pre-code {
            background: #263238;
            color: #00e676;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            margin-top: 10px;
        }

        .tire-size {
            display: inline-block;
            background: #e3f2fd;
            color: #1976D2;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            margin: 2px;
        }

        .tire-size.stock {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .tire-size.optional {
            background: #fff3e0;
            color: #ef6c00;
        }

        .test-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #2196F3;
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1976D2;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .test-controls {
                flex-direction: column;
            }
            
            .input-group {
                min-width: auto;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ —à–∏–Ω - Frontend ‚Üî Backend API</p>
        </div>

        <div class="content">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div class="test-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successTests">0</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">–ù–µ—É–¥–∞—á–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgResponseTime">0ms</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</div>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API -->
            <div class="test-section">
                <h3>üåê –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Backend API</h3>
                <div class="api-info">
                    <strong>Endpoint:</strong> <code>GET http://localhost:8000/api/v1/tire_search/statistics</code><br>
                    <strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã
                </div>
                <div class="test-controls">
                    <button class="btn" onclick="testApiAvailability()">üöÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
                    <button class="btn secondary" onclick="clearResults('apiResult')">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="apiResult" class="result-area" style="display: none;">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ API:</h4>
                    <div id="apiContent"></div>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫ —à–∏–Ω -->
            <div class="test-section">
                <h3>üîç –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫ —à–∏–Ω –ø–æ –∑–∞–ø—Ä–æ—Å—É</h3>
                <div class="api-info">
                    <strong>Endpoint:</strong> <code>POST http://localhost:8000/api/v1/tire_search</code><br>
                    <strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —à–∏–Ω –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
                </div>
                <div class="test-controls">
                    <div class="input-group">
                        <label for="searchQuery">–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:</label>
                        <input type="text" id="searchQuery" placeholder="BMW 3 Series 2020" value="BMW 3 Series">
                    </div>
                    <div class="input-group">
                        <label for="searchLimit">–õ–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</label>
                        <select id="searchLimit">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="useLLM">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM:</label>
                        <select id="useLLM">
                            <option value="true" selected>–î–∞</option>
                            <option value="false">–ù–µ—Ç</option>
                        </select>
                    </div>
                </div>
                <div class="test-controls">
                    <button class="btn" onclick="testTireSearch()">üîç –ü–æ–∏—Å–∫ —à–∏–Ω</button>
                    <button class="btn secondary" onclick="testPredefinedQueries()">üìù –¢–µ—Å—Ç –ø—Ä–∏–º–µ—Ä–æ–≤</button>
                    <button class="btn secondary" onclick="clearResults('searchResult')">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="searchResult" class="result-area" style="display: none;">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h4>
                    <div id="searchContent"></div>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="test-section">
                <h3>üìä –¢–µ—Å—Ç 3: –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤</h3>
                <div class="api-info">
                    <strong>Endpoints:</strong> <code>GET /tire_search/brands</code>, <code>GET /tire_search/models</code>, <code>GET /tire_search/diameters</code><br>
                    <strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                </div>
                <div class="test-controls">
                    <button class="btn" onclick="testGetBrands()">üè∑Ô∏è –ü–æ–ª—É—á–∏—Ç—å –±—Ä–µ–Ω–¥—ã</button>
                    <button class="btn" onclick="testGetModels()">üöó –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª–∏</button>
                    <button class="btn" onclick="testGetDiameters()">‚ö™ –ü–æ–ª—É—á–∏—Ç—å –¥–∏–∞–º–µ—Ç—Ä—ã</button>
                    <button class="btn secondary" onclick="clearResults('filtersResult')">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="filtersResult" class="result-area" style="display: none;">
                    <h4>–î–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤:</h4>
                    <div id="filtersContent"></div>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç 4: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
            <div class="test-section">
                <h3>‚ö° –¢–µ—Å—Ç 4: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                <div class="api-info">
                    <strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö<br>
                    <strong>–ú–µ—Ç—Ä–∏–∫–∏:</strong> –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
                </div>
                <div class="test-controls">
                    <div class="input-group">
                        <label for="stressCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:</label>
                        <select id="stressCount">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="stressDelay">–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–º—Å):</label>
                        <select id="stressDelay">
                            <option value="0">0</option>
                            <option value="100" selected>100</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                        </select>
                    </div>
                </div>
                <div class="test-controls">
                    <button class="btn danger" onclick="runStressTest()">‚ö° –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç</button>
                    <button class="btn secondary" onclick="stopStressTest()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button class="btn secondary" onclick="clearResults('stressResult')">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="stressResult" class="result-area" style="display: none;">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞:</h4>
                    <div id="stressContent"></div>
                </div>
            </div>

            <!-- –¢–µ—Å—Ç 5: –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç -->
            <div class="test-section">
                <h3>üéØ –¢–µ—Å—Ç 5: –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç</h3>
                <div class="api-info">
                    <strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ —à–∏–Ω<br>
                    <strong>–í–∫–ª—é—á–∞–µ—Ç:</strong> API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
                </div>
                <div class="test-controls">
                    <button class="btn success" onclick="runFullIntegrationTest()">üéØ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
                    <button class="btn secondary" onclick="clearResults('fullTestResult')">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="fullTestResult" class="result-area" style="display: none;">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:</h4>
                    <div id="fullTestContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_BASE_URL = 'http://localhost:8000/api/v1';
        let stressTestRunning = false;
        let testStats = {
            total: 0,
            success: 0,
            failed: 0,
            responseTimes: []
        };

        // –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const predefinedQueries = [
            'BMW 3 Series',
            'BMW —Ç—Ä–æ–π–∫–∞',
            'Mercedes E-Class',
            'Volkswagen Tiguan',
            '—Ç–∏–≥—É–∞–Ω 2019',
            '—à–∏–Ω—ã –Ω–∞ –±–º–≤',
            '—Ä–µ–∑–∏–Ω–∞ R17',
            '–∑–∏–º–Ω—è—è —Ä–µ–∑–∏–Ω–∞',
            '–ª–µ—Ç–Ω–∏–µ —à–∏–Ω—ã 225/50R17'
        ];

        // –£—Ç–∏–ª–∏—Ç—ã
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('successTests').textContent = testStats.success;
            document.getElementById('failedTests').textContent = testStats.failed;
            
            const avgTime = testStats.responseTimes.length > 0 
                ? Math.round(testStats.responseTimes.reduce((a, b) => a + b, 0) / testStats.responseTimes.length)
                : 0;
            document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
        }

        function showResult(containerId, content) {
            const container = document.getElementById(containerId);
            const contentDiv = document.getElementById(containerId.replace('Result', 'Content'));
            contentDiv.innerHTML = content;
            container.style.display = 'block';
        }

        function clearResults(containerId) {
            document.getElementById(containerId).style.display = 'none';
        }

        function addTestResult(success, responseTime = 0) {
            testStats.total++;
            if (success) {
                testStats.success++;
            } else {
                testStats.failed++;
            }
            if (responseTime > 0) {
                testStats.responseTimes.push(responseTime);
            }
            updateStats();
        }

        function formatTireSizes(sizes) {
            return sizes.map(size => {
                const sizeText = `${size.width}/${size.height}R${size.diameter}`;
                const type = size.type === 'stock' ? 'stock' : 'optional';
                return `<span class="tire-size ${type}">${sizeText} (${size.type})</span>`;
            }).join(' ');
        }

        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
        async function testApiAvailability() {
            const startTime = Date.now();
            try {
                const response = await fetch(`${API_BASE_URL}/tire_search/statistics`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                if (response.ok) {
                    addTestResult(true, responseTime);
                    showResult('apiResult', `
                        <div class="result-item">
                            <span class="status success">‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω</span>
                            <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime}ms</p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${response.status} ${response.statusText}</p>
                            <div class="pre-code">${JSON.stringify(data, null, 2)}</div>
                        </div>
                    `);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                addTestResult(false, responseTime);
                showResult('apiResult', `
                    <div class="result-item">
                        <span class="status error">‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                        <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime}ms</p>
                        <p><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</strong></p>
                        <ul>
                            <li>–ó–∞–ø—É—â–µ–Ω –ª–∏ backend —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8000</li>
                            <li>–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã CORS</li>
                            <li>–î–æ—Å—Ç—É–ø–Ω—ã –ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã tire_search</li>
                        </ul>
                    </div>
                `);
            }
        }

        // –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫ —à–∏–Ω
        async function testTireSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            const limit = parseInt(document.getElementById('searchLimit').value);
            const useLLM = document.getElementById('useLLM').value === 'true';

            if (!query) {
                showResult('searchResult', `
                    <div class="result-item">
                        <span class="status error">‚ùå –û—à–∏–±–∫–∞</span>
                        <p>–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `);
                return;
            }

            const startTime = Date.now();
            try {
                const response = await fetch(`${API_BASE_URL}/tire_search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        limit: limit,
                        offset: 0,
                        use_llm: useLLM
                    })
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                if (response.ok) {
                    addTestResult(true, responseTime);
                    const results = data.results || [];
                    const total = data.total || 0;
                    const parsedData = data.parsed_data || {};

                    let resultHTML = `
                        <div class="result-item">
                            <span class="status success">‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω</span>
                            <p><strong>–ó–∞–ø—Ä–æ—Å:</strong> "${query}"</p>
                            <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime}ms</p>
                            <p><strong>–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</strong> ${results.length} –∏–∑ ${total}</p>
                            <p><strong>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong> ${JSON.stringify(parsedData)}</p>
                        </div>
                    `;

                    results.forEach((result, index) => {
                        const tireSizes = formatTireSizes(result.tire_sizes || []);
                        resultHTML += `
                            <div class="result-item">
                                <h5>${index + 1}. ${result.brand_name} ${result.model_name}</h5>
                                <p><strong>–ì–æ–¥—ã:</strong> ${result.years_display}</p>
                                <p><strong>–†–∞–∑–º–µ—Ä—ã —à–∏–Ω:</strong> ${tireSizes}</p>
                                <p><strong>–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å:</strong> ${(result.match_score || 0).toFixed(2)}</p>
                            </div>
                        `;
                    });

                    showResult('searchResult', resultHTML);
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.error || response.statusText}`);
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                addTestResult(false, responseTime);
                showResult('searchResult', `
                    <div class="result-item">
                        <span class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</span>
                        <p><strong>–ó–∞–ø—Ä–æ—Å:</strong> "${query}"</p>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                        <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime}ms</p>
                    </div>
                `);
            }
        }

        // –¢–µ—Å—Ç –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        async function testPredefinedQueries() {
            let resultHTML = '<div class="result-item"><span class="status pending">üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤...</span></div>';
            showResult('searchResult', resultHTML);

            resultHTML = '';
            for (let i = 0; i < predefinedQueries.length; i++) {
                const query = predefinedQueries[i];
                const startTime = Date.now();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/tire_search`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            query: query,
                            limit: 3,
                            offset: 0,
                            use_llm: true
                        })
                    });

                    const responseTime = Date.now() - startTime;
                    const data = await response.json();

                    if (response.ok) {
                        addTestResult(true, responseTime);
                        const results = data.results || [];
                        resultHTML += `
                            <div class="result-item">
                                <span class="status success">‚úÖ</span>
                                <strong>"${query}"</strong> - ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (${responseTime}ms)
                            </div>
                        `;
                    } else {
                        addTestResult(false, responseTime);
                        resultHTML += `
                            <div class="result-item">
                                <span class="status error">‚ùå</span>
                                <strong>"${query}"</strong> - –û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
                            </div>
                        `;
                    }
                } catch (error) {
                    const responseTime = Date.now() - startTime;
                    addTestResult(false, responseTime);
                    resultHTML += `
                        <div class="result-item">
                            <span class="status error">‚ùå</span>
                            <strong>"${query}"</strong> - –û—à–∏–±–∫–∞: ${error.message}
                        </div>
                    `;
                }

                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            showResult('searchResult', resultHTML);
        }

        // –¢–µ—Å—Ç 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        async function testGetBrands() {
            await testFilterEndpoint('brands', '–ë—Ä–µ–Ω–¥—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π');
        }

        async function testGetModels() {
            await testFilterEndpoint('models', '–ú–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π');
        }

        async function testGetDiameters() {
            await testFilterEndpoint('diameters', '–î–∏–∞–º–µ—Ç—Ä—ã —à–∏–Ω');
        }

        async function testFilterEndpoint(endpoint, title) {
            const startTime = Date.now();
            try {
                const response = await fetch(`${API_BASE_URL}/tire_search/${endpoint}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const responseTime = Date.now() - startTime;
                const data = await response.json();

                if (response.ok) {
                    addTestResult(true, responseTime);
                    const items = data[endpoint] || data.diameters || [];
                    showResult('filtersResult', `
                        <div class="result-item">
                            <span class="status success">‚úÖ ${title} –ø–æ–ª—É—á–µ–Ω—ã</span>
                            <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${items.length}</p>
                            <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime}ms</p>
                            <p><strong>–ü—Ä–∏–º–µ—Ä—ã:</strong> ${items.slice(0, 10).join(', ')}${items.length > 10 ? '...' : ''}</p>
                            <div class="pre-code">${JSON.stringify(data, null, 2)}</div>
                        </div>
                    `);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                const responseTime = Date.now() - startTime;
                addTestResult(false, responseTime);
                showResult('filtersResult', `
                    <div class="result-item">
                        <span class="status error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ${title.toLowerCase()}</span>
                        <p><strong>–û—à–∏–±–∫–∞:</strong> ${error.message}</p>
                        <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime}ms</p>
                    </div>
                `);
            }
        }

        // –¢–µ—Å—Ç 4: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        async function runStressTest() {
            const count = parseInt(document.getElementById('stressCount').value);
            const delay = parseInt(document.getElementById('stressDelay').value);
            
            stressTestRunning = true;
            
            let resultHTML = `
                <div class="result-item">
                    <span class="status pending">üîÑ –ó–∞–ø—É—Å–∫ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞...</span>
                    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${count}</p>
                    <p>–ó–∞–¥–µ—Ä–∂–∫–∞: ${delay}ms</p>
                    <div class="loading"></div>
                </div>
            `;
            showResult('stressResult', resultHTML);

            const results = [];
            const queries = ['BMW', 'Mercedes', 'Volkswagen', 'Audi', 'Toyota'];
            
            for (let i = 0; i < count && stressTestRunning; i++) {
                const query = queries[i % queries.length];
                const startTime = Date.now();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/tire_search`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            query: query,
                            limit: 5,
                            offset: 0,
                            use_llm: false
                        })
                    });

                    const responseTime = Date.now() - startTime;
                    const success = response.ok;
                    
                    results.push({
                        index: i + 1,
                        query: query,
                        success: success,
                        responseTime: responseTime,
                        status: response.status
                    });

                    addTestResult(success, responseTime);

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                    updateStressTestResults(results, i + 1, count);

                } catch (error) {
                    const responseTime = Date.now() - startTime;
                    results.push({
                        index: i + 1,
                        query: query,
                        success: false,
                        responseTime: responseTime,
                        error: error.message
                    });

                    addTestResult(false, responseTime);
                    updateStressTestResults(results, i + 1, count);
                }

                if (delay > 0 && i < count - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }

            stressTestRunning = false;
            finalizeStressTestResults(results);
        }

        function updateStressTestResults(results, current, total) {
            const successful = results.filter(r => r.success).length;
            const failed = results.filter(r => !r.success).length;
            const avgTime = results.length > 0 
                ? Math.round(results.reduce((sum, r) => sum + r.responseTime, 0) / results.length)
                : 0;

            let resultHTML = `
                <div class="result-item">
                    <span class="status pending">üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–æ ${current} –∏–∑ ${total}</span>
                    <p><strong>–£—Å–ø–µ—à–Ω—ã—Ö:</strong> ${successful} | <strong>–ù–µ—É–¥–∞—á–Ω—ã—Ö:</strong> ${failed}</p>
                    <p><strong>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è:</strong> ${avgTime}ms</p>
                    <div class="loading"></div>
                </div>
            `;

            showResult('stressResult', resultHTML);
        }

        function finalizeStressTestResults(results) {
            const successful = results.filter(r => r.success).length;
            const failed = results.filter(r => !r.success).length;
            const avgTime = results.length > 0 
                ? Math.round(results.reduce((sum, r) => sum + r.responseTime, 0) / results.length)
                : 0;
            const minTime = Math.min(...results.map(r => r.responseTime));
            const maxTime = Math.max(...results.map(r => r.responseTime));

            let resultHTML = `
                <div class="result-item">
                    <span class="status ${failed === 0 ? 'success' : 'error'}">
                        ${failed === 0 ? '‚úÖ' : '‚ö†Ô∏è'} –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω
                    </span>
                    <p><strong>–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤:</strong> ${results.length}</p>
                    <p><strong>–£—Å–ø–µ—à–Ω—ã—Ö:</strong> ${successful} (${Math.round(successful/results.length*100)}%)</p>
                    <p><strong>–ù–µ—É–¥–∞—á–Ω—ã—Ö:</strong> ${failed} (${Math.round(failed/results.length*100)}%)</p>
                    <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> –º–∏–Ω ${minTime}ms | —Å—Ä–µ–¥ ${avgTime}ms | –º–∞–∫—Å ${maxTime}ms</p>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É
            results.forEach(result => {
                const statusClass = result.success ? 'success' : 'error';
                const statusIcon = result.success ? '‚úÖ' : '‚ùå';
                resultHTML += `
                    <div class="result-item">
                        <span class="status ${statusClass}">${statusIcon}</span>
                        <strong>#${result.index}:</strong> "${result.query}" - ${result.responseTime}ms
                        ${result.error ? ` (${result.error})` : ''}
                    </div>
                `;
            });

            showResult('stressResult', resultHTML);
        }

        function stopStressTest() {
            stressTestRunning = false;
        }

        // –¢–µ—Å—Ç 5: –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
        async function runFullIntegrationTest() {
            let resultHTML = `
                <div class="result-item">
                    <span class="status pending">üîÑ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞...</span>
                    <div class="loading"></div>
                </div>
            `;
            showResult('fullTestResult', resultHTML);

            const tests = [
                { name: 'API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å', func: testApiAvailabilityInternal },
                { name: '–ü–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–æ–≤', func: () => testFilterEndpointInternal('brands') },
                { name: '–ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π', func: () => testFilterEndpointInternal('models') },
                { name: '–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∏–∞–º–µ—Ç—Ä–æ–≤', func: () => testFilterEndpointInternal('diameters') },
                { name: '–ü–æ–∏—Å–∫ BMW', func: () => testSearchInternal('BMW') },
                { name: '–ü–æ–∏—Å–∫ Mercedes', func: () => testSearchInternal('Mercedes') },
                { name: '–ü–æ–∏—Å–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º', func: () => testSearchInternal('—Ç–∏–≥—É–∞–Ω') },
                { name: '–ü–æ–∏—Å–∫ —Å –≥–æ–¥–æ–º', func: () => testSearchInternal('BMW 3 Series 2020') },
                { name: '–ü–æ–∏—Å–∫ —Ä–∞–∑–º–µ—Ä–∞', func: () => testSearchInternal('225/50R17') }
            ];

            const results = [];
            
            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                try {
                    const result = await test.func();
                    results.push({ ...result, name: test.name });
                } catch (error) {
                    results.push({ 
                        name: test.name, 
                        success: false, 
                        error: error.message,
                        responseTime: 0
                    });
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                const completed = i + 1;
                const progress = Math.round((completed / tests.length) * 100);
                updateFullTestProgress(results, completed, tests.length, progress);
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            finalizeFullTestResults(results);
        }

        function updateFullTestProgress(results, completed, total, progress) {
            const successful = results.filter(r => r.success).length;
            const failed = results.filter(r => !r.success).length;

            let resultHTML = `
                <div class="result-item">
                    <span class="status pending">üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress}% (${completed}/${total})</span>
                    <p><strong>–£—Å–ø–µ—à–Ω—ã—Ö:</strong> ${successful} | <strong>–ù–µ—É–¥–∞—á–Ω—ã—Ö:</strong> ${failed}</p>
                    <div class="loading"></div>
                </div>
            `;

            showResult('fullTestResult', resultHTML);
        }

        function finalizeFullTestResults(results) {
            const successful = results.filter(r => r.success).length;
            const failed = results.filter(r => !r.success).length;
            const avgTime = results.length > 0 
                ? Math.round(results.reduce((sum, r) => sum + (r.responseTime || 0), 0) / results.length)
                : 0;

            let resultHTML = `
                <div class="result-item">
                    <span class="status ${failed === 0 ? 'success' : (failed < results.length / 2 ? 'pending' : 'error')}">
                        ${failed === 0 ? '‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã' : failed < results.length / 2 ? '‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã' : '‚ùå –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–µ–Ω—ã'}
                    </span>
                    <p><strong>–û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> ${successful}/${results.length} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</p>
                    <p><strong>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:</strong> ${Math.round(successful/results.length*100)}%</p>
                    <p><strong>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${avgTime}ms</p>
                </div>
            `;

            results.forEach(result => {
                const statusClass = result.success ? 'success' : 'error';
                const statusIcon = result.success ? '‚úÖ' : '‚ùå';
                resultHTML += `
                    <div class="result-item">
                        <span class="status ${statusClass}">${statusIcon}</span>
                        <strong>${result.name}:</strong> 
                        ${result.success ? `${result.responseTime || 0}ms` : result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
                    </div>
                `;
            });

            showResult('fullTestResult', resultHTML);
        }

        // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
        async function testApiAvailabilityInternal() {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/tire_search/statistics`);
            const responseTime = Date.now() - startTime;
            return { success: response.ok, responseTime };
        }

        async function testFilterEndpointInternal(endpoint) {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/tire_search/${endpoint}`);
            const responseTime = Date.now() - startTime;
            return { success: response.ok, responseTime };
        }

        async function testSearchInternal(query) {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/tire_search`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query, limit: 5, offset: 0, use_llm: true })
            });
            const responseTime = Date.now() - startTime;
            return { success: response.ok, responseTime };
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            console.log('üß™ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ —à–∏–Ω –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!');
        });
    </script>
</body>
</html>