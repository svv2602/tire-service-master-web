<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ä–æ–ª–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-section {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        
        .success {
            color: #4caf50;
            font-weight: bold;
        }
        
        .error {
            color: #f44336;
            font-weight: bold;
        }
        
        .info {
            color: #2196f3;
            font-weight: bold;
        }
        
        .code-block {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .api-test {
            background: #e8f5e8;
            padding: 10px;
            border-left: 4px solid #4caf50;
            margin: 10px 0;
        }
        
        .step {
            background: #fff3e0;
            padding: 10px;
            border-left: 4px solid #ff9800;
            margin: 10px 0;
        }
        
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #1976d2;
        }
        
        .result {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ –¢–µ—Å—Ç —Ä–æ–ª–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫</h1>
        
        <div class="step">
            <h2>üìã –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <p>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ä—Ç–Ω–µ—Ä—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏, –∞ –∞–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ —Ç–æ—á–∫–∏.</p>
        </div>
        
        <div class="test-section">
            <h2>üîê –®–∞–≥ 1: –í—Ö–æ–¥ –ø–æ–¥ —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏</h2>
            
            <div class="api-test">
                <h3>–¢–µ—Å—Ç API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
                <button onclick="testAdminLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ –ê–¥–º–∏–Ω</button>
                <button onclick="testPartnerLogin()">–í–æ–π—Ç–∏ –∫–∞–∫ –ü–∞—Ä—Ç–Ω–µ—Ä</button>
                <button onclick="checkCurrentUser()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <div id="authResult" class="result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìä –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫</h2>
            
            <div class="api-test">
                <h3>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫</h3>
                <button onclick="testServicePointsAsAdmin()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∫ –ê–¥–º–∏–Ω</button>
                <button onclick="testServicePointsAsPartner()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∫ –ü–∞—Ä—Ç–Ω–µ—Ä</button>
                <button onclick="testServicePointsWithPartnerFilter()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞</button>
                <div id="servicePointsResult" class="result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            
            <div class="info">
                <h3>–î–ª—è –ê–¥–º–∏–Ω–∞ (admin@test.com):</h3>
                <ul>
                    <li>‚úÖ –í–∏–¥–∏—Ç –í–°–ï —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</li>
                    <li>‚úÖ –ú–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º</li>
                    <li>‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –≤–µ–¥–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä –ø–∞—Ä—Ç–Ω–µ—Ä–∞</li>
                </ul>
            </div>
            
            <div class="success">
                <h3>–î–ª—è –ü–∞—Ä—Ç–Ω–µ—Ä–∞ (partner@test.com):</h3>
                <ul>
                    <li>‚úÖ –í–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</li>
                    <li>‚úÖ –§–∏–ª—å—Ç—Ä –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ —Å–∫—Ä—ã—Ç</li>
                    <li>‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –≤–µ–¥–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º</li>
                </ul>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            
            <div class="step">
                <h3>1. –¢–µ—Å—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ:</h3>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ <a href="http://localhost:3008/admin/service-points" target="_blank">http://localhost:3008/admin/service-points</a></li>
                    <li>–í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –∞–¥–º–∏–Ω–æ–º: admin@test.com / admin123</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–Ω—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</li>
                    <li>–í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –ø–æ–¥ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º: partner@test.com / partner123</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</li>
                </ol>
            </div>
            
            <div class="step">
                <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ UI –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:</h3>
                <ul>
                    <li>–§–∏–ª—å—Ç—Ä "–ü–∞—Ä—Ç–Ω–µ—Ä" —Å–∫—Ä—ã—Ç –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</li>
                    <li>–ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É" —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏</li>
                    <li>–ö–æ–ª–æ–Ω–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ —Ä–æ–ª—å</li>
                </ul>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üìà –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
            
            <div class="success">
                <h3>‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:</h3>
                <ul>
                    <li>–°–æ–∑–¥–∞–Ω —Ö—É–∫ useRoleAccess() –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏</li>
                    <li>–î–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ª–æ–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ queryParams</li>
                    <li>Backend –ø–æ–ª–∏—Ç–∏–∫–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ</li>
                </ul>
            </div>
            
            <div class="info">
                <h3>üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ:</h3>
                <ul>
                    <li>–ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É"</li>
                    <li>–°–∫—Ä—ã—Ç–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</li>
                    <li>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let currentToken = null;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (currentToken) {
                headers['Authorization'] = `Bearer ${currentToken}`;
            }
            
            try {
                const response = await fetch(url, {
                    credentials: 'include',
                    headers,
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        // –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –ø–æ–¥ –∞–¥–º–∏–Ω–æ–º
        async function testAdminLogin() {
            const result = await apiRequest('/auth/login', {
                method: 'POST',
                body: JSON.stringify({
                    email: 'admin@test.com',
                    password: 'admin123'
                })
            });
            
            if (result.success && result.data.access_token) {
                currentToken = result.data.access_token;
                document.getElementById('authResult').textContent = 
                    `‚úÖ –ê–¥–º–∏–Ω –≤–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ\n–†–æ–ª—å: ${result.data.user?.role}\n–¢–æ–∫–µ–Ω: ${currentToken.substring(0, 20)}...`;
            } else {
                document.getElementById('authResult').textContent = 
                    `‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞: ${JSON.stringify(result, null, 2)}`;
            }
        }
        
        // –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –ø–æ–¥ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
        async function testPartnerLogin() {
            const result = await apiRequest('/auth/login', {
                method: 'POST',
                body: JSON.stringify({
                    email: 'partner@test.com',
                    password: 'partner123'
                })
            });
            
            if (result.success && result.data.access_token) {
                currentToken = result.data.access_token;
                document.getElementById('authResult').textContent = 
                    `‚úÖ –ü–∞—Ä—Ç–Ω–µ—Ä –≤–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ\n–†–æ–ª—å: ${result.data.user?.role}\n–ü–∞—Ä—Ç–Ω–µ—Ä ID: ${result.data.user?.partner?.id}\n–¢–æ–∫–µ–Ω: ${currentToken.substring(0, 20)}...`;
            } else {
                document.getElementById('authResult').textContent = 
                    `‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞: ${JSON.stringify(result, null, 2)}`;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function checkCurrentUser() {
            const result = await apiRequest('/auth/me');
            
            document.getElementById('authResult').textContent = 
                `–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:\n${JSON.stringify(result.data, null, 2)}`;
        }
        
        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫ –∫–∞–∫ –∞–¥–º–∏–Ω
        async function testServicePointsAsAdmin() {
            const result = await apiRequest('/service_points');
            
            if (result.success) {
                const points = result.data.data || result.data;
                document.getElementById('servicePointsResult').textContent = 
                    `‚úÖ –ê–¥–º–∏–Ω –∑–∞–≥—Ä—É–∑–∏–ª ${points.length} —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫:\n${JSON.stringify(points.map(p => ({id: p.id, name: p.name, partner_id: p.partner_id})), null, 2)}`;
            } else {
                document.getElementById('servicePointsResult').textContent = 
                    `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${JSON.stringify(result, null, 2)}`;
            }
        }
        
        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫ –∫–∞–∫ –ø–∞—Ä—Ç–Ω–µ—Ä
        async function testServicePointsAsPartner() {
            const result = await apiRequest('/service_points');
            
            if (result.success) {
                const points = result.data.data || result.data;
                document.getElementById('servicePointsResult').textContent = 
                    `‚úÖ –ü–∞—Ä—Ç–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∏–ª ${points.length} —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫:\n${JSON.stringify(points.map(p => ({id: p.id, name: p.name, partner_id: p.partner_id})), null, 2)}`;
            } else {
                document.getElementById('servicePointsResult').textContent = 
                    `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${JSON.stringify(result, null, 2)}`;
            }
        }
        
        // –¢–µ—Å—Ç —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞
        async function testServicePointsWithPartnerFilter() {
            const result = await apiRequest('/service_points?partner_id=1');
            
            if (result.success) {
                const points = result.data.data || result.data;
                document.getElementById('servicePointsResult').textContent = 
                    `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${points.length} —Ç–æ—á–µ–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ ID=1:\n${JSON.stringify(points.map(p => ({id: p.id, name: p.name, partner_id: p.partner_id})), null, 2)}`;
            } else {
                document.getElementById('servicePointsResult').textContent = 
                    `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º: ${JSON.stringify(result, null, 2)}`;
            }
        }
    </script>
</body>
</html> 