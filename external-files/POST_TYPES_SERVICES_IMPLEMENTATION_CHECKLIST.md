# üìã –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –¢–ò–ü–û–í –ü–û–°–¢–û–í –ò –ö–ê–¢–ï–ì–û–†–ò–ô –£–°–õ–£–ì

## üéØ –¶–ï–õ–¨ –ü–†–û–ï–ö–¢–ê
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Å–ª—É–≥ –¥–ª—è –ø–æ—Å—Ç–æ–≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â—É—é:
- –ü—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å –ø–æ—Å—Ç—ã –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —É—Å–ª—É–≥ (—à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂, –º–æ–π–∫–∞, –°–¢–û) - **–û–î–ò–ù –ü–û–°–¢ = –û–î–ù–ê –ö–ê–¢–ï–ì–û–†–ò–Ø**
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ –ø–æ—Å—Ç–∞–º –Ω—É–∂–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –£–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —á–µ—Ä–µ–∑ **JSON –ø–æ–ª–µ**
- –§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø —É—Å–ª—É–≥ –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## üîç –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ì–û –°–û–°–¢–û–Ø–ù–ò–Ø

### ‚úÖ –ß–¢–û –£–ñ–ï –ï–°–¢–¨:
- [x] –ú–æ–¥–µ–ª—å `ServiceCategory` —Å –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- [x] –ú–æ–¥–µ–ª—å `Service` –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [x] –ú–æ–¥–µ–ª—å `ServicePost` —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- [x] –ú–æ–¥–µ–ª—å `Booking` —Å –ø–æ–ª—è–º–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è —É—Å–ª—É–≥–∏
- [x] API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —É—Å–ª—É–≥
- [x] Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

### ‚ùå –ß–¢–û –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨:
- [ ] **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø** —Å–≤—è–∑—å –ø–æ—Å—Ç–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —É—Å–ª—É–≥ (NOT NULL)
- [ ] –ü–æ–ª–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
- [ ] JSON –ø–æ–ª–µ –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ service_points
- [ ] –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- [ ] UI –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- [ ] –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —à–∞–≥–∞ "–£—Å–ª—É–≥–∏" –≤ —Ñ–æ—Ä–º–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏

---

## üìä –≠–¢–ê–ü 1: BACKEND - –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### 1.1 –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- [ ] **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–≤—è–∑–∏ –ø–æ—Å—Ç–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø)**
  ```ruby
  # 20250627_add_service_category_to_service_posts.rb
  class AddServiceCategoryToServicePosts < ActiveRecord::Migration[8.0]
    def change
      # –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –∫–∞–∫ nullable –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
      add_reference :service_posts, :service_category, null: true, foreign_key: true
      add_index :service_posts, [:service_point_id, :service_category_id]
      
      # –í –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–¥–µ–ª–∞–µ–º –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    end
  end
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ—Å—Ç–∞–º**
  ```ruby
  # 20250627_assign_default_categories_to_posts.rb
  class AssignDefaultCategoriesToPosts < ActiveRecord::Migration[8.0]
    def up
      # –°–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–û–±—â–∏–µ —É—Å–ª—É–≥–∏" –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
      default_category = ServiceCategory.find_or_create_by!(
        name: '–û–±—â–∏–µ —É—Å–ª—É–≥–∏',
        description: '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –ø–æ—Å—Ç–æ–≤ –±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏',
        is_active: true,
        sort_order: 999
      )
      
      # –ù–∞–∑–Ω–∞—á–∞–µ–º –≤—Å–µ–º –ø–æ—Å—Ç–∞–º –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
      ServicePost.where(service_category_id: nil).update_all(
        service_category_id: default_category.id
      )
    end
    
    def down
      # –û—Ç–∫–∞—Ç: —É–±–∏—Ä–∞–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
      ServicePost.where(service_category_id: ServiceCategory.find_by(name: '–û–±—â–∏–µ —É—Å–ª—É–≥–∏')&.id)
                 .update_all(service_category_id: nil)
    end
  end
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**
  ```ruby
  # 20250627_make_service_category_required_in_posts.rb
  class MakeServiceCategoryRequiredInPosts < ActiveRecord::Migration[8.0]
    def change
      change_column_null :service_posts, :service_category_id, false
    end
  end
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö**
  ```ruby
  # 20250627_add_service_category_to_bookings.rb
  class AddServiceCategoryToBookings < ActiveRecord::Migration[8.0]
    def change
      add_reference :bookings, :service_category, null: true, foreign_key: true
      add_index :bookings, :service_category_id
    end
  end
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è JSON –ø–æ–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º**
  ```ruby
  # 20250627_add_category_contacts_to_service_points.rb
  class AddCategoryContactsToServicePoints < ActiveRecord::Migration[8.0]
    def change
      add_column :service_points, :category_contacts, :jsonb, default: {}
      add_index :service_points, :category_contacts, using: :gin
    end
  end
  ```

### 1.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å ServicePost**
  ```ruby
  # app/models/service_post.rb
  belongs_to :service_category # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø —Å–≤—è–∑—å (—É–±–∏—Ä–∞–µ–º optional: true)
  
  scope :by_category, ->(category_id) { where(service_category_id: category_id) }
  scope :with_category, -> { includes(:service_category) }
  
  validates :service_category_id, presence: true # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
  
  def category_name
    service_category.name
  end
  
  def supports_category?(category_id)
    service_category_id == category_id
  end
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å ServicePoint**
  ```ruby
  # app/models/service_point.rb
  
  # JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è category_contacts:
  # {
  #   "1": { "phone": "+380671234567", "email": "tire@example.com" },
  #   "2": { "phone": "+380671234568", "email": "wash@example.com" }
  # }
  
  def posts_for_category(category_id)
    service_posts.active.by_category(category_id)
  end
  
  def posts_count_for_category(category_id)
    posts_for_category(category_id).count
  end
  
  def contact_phone_for_category(category_id)
    category_contacts.dig(category_id.to_s, 'phone')
  end
  
  def contact_email_for_category(category_id)
    category_contacts.dig(category_id.to_s, 'email')
  end
  
  def set_category_contact(category_id, phone:, email: nil)
    self.category_contacts = category_contacts.merge(
      category_id.to_s => { 'phone' => phone, 'email' => email }.compact
    )
  end
  
  def remove_category_contact(category_id)
    updated_contacts = category_contacts.dup
    updated_contacts.delete(category_id.to_s)
    self.category_contacts = updated_contacts
  end
  
  def supports_category?(category_id)
    posts_for_category(category_id).exists?
  end
  
  def available_categories
    service_posts.includes(:service_category).map(&:service_category).uniq
  end
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å Booking**
  ```ruby
  # app/models/booking.rb
  belongs_to :service_category, optional: true
  
  scope :by_category, ->(category_id) { where(service_category_id: category_id) }
  
  validate :service_category_supported_by_service_point
  
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥
  before_validation :assign_service_category_from_services, on: :create
  
  private
  
  def service_category_supported_by_service_point
    return unless service_category_id && service_point_id
    
    unless service_point.supports_category?(service_category_id)
      errors.add(:service_category_id, '–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–∞–Ω–Ω–æ–π —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–æ–π')
    end
  end
  
  def assign_service_category_from_services
    return if service_category_id.present?
    return if services.empty?
    
    # –ë–µ—Ä–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–µ—Ä–≤–æ–π —É—Å–ª—É–≥–∏ (–≤—Å–µ —É—Å–ª—É–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    first_service_category = services.first&.category_id
    self.service_category_id = first_service_category if first_service_category
  end
  ```

### 1.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å ServicePointsController**
  ```ruby
  # app/controllers/api/v1/service_points_controller.rb
  
  def by_category
    # GET /api/v1/service_points/by_category?category_id=1&city_id=1
    category_id = params[:category_id]
    city_id = params[:city_id]
    
    service_points = ServicePoint.joins(:service_posts)
                                 .where(service_posts: { service_category_id: category_id, is_active: true })
                                 .where(is_active: true)
    
    service_points = service_points.where(city_id: city_id) if city_id.present?
    
    render json: {
      data: service_points.distinct.includes(:city, :partner, service_posts: :service_category),
      total_count: service_points.distinct.count
    }
  end
  
  def posts_by_category
    # GET /api/v1/service_points/:id/posts_by_category?category_id=1
    category_id = params[:category_id]
    posts = @service_point.posts_for_category(category_id)
    
    render json: {
      data: posts.includes(:service_category),
      category_contact: {
        phone: @service_point.contact_phone_for_category(category_id),
        email: @service_point.contact_email_for_category(category_id)
      }
    }
  end
  
  def update_category_contacts
    # PATCH /api/v1/service_points/:id/category_contacts
    contacts_data = params[:category_contacts] || {}
    
    contacts_data.each do |category_id, contact_info|
      @service_point.set_category_contact(
        category_id,
        phone: contact_info[:phone],
        email: contact_info[:email]
      )
    end
    
    if @service_point.save
      render json: { success: true, category_contacts: @service_point.category_contacts }
    else
      render json: { errors: @service_point.errors }, status: :unprocessable_entity
    end
  end
  
  private
  
  def service_point_params
    params.require(:service_point).permit(
      # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      category_contacts: {}
    )
  end
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å BookingsController**
  ```ruby
  # app/controllers/api/v1/bookings_controller.rb
  
  def booking_params
    params.require(:booking).permit(
      # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      :service_category_id
    )
  end
  
  # –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ index
  def index
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞
    
    if params[:service_category_id].present?
      @bookings = @bookings.by_category(params[:service_category_id])
    end
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
  end
  ```

### 1.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å DynamicAvailabilityService**
  ```ruby
  # app/services/dynamic_availability_service.rb
  
  def self.check_availability_with_category(service_point_id, date, start_time, duration, category_id)
    service_point = ServicePoint.find(service_point_id)
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    available_posts = service_point.posts_for_category(category_id)
    
    return { 
      available: false, 
      reason: '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥',
      available_posts_count: 0
    } if available_posts.empty?
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ—Å—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    datetime = DateTime.parse("#{date} #{start_time}")
    end_datetime = datetime + duration.minutes
    
    available_posts_count = 0
    available_posts.each do |post|
      next unless post.available_at_time?(datetime)
      
      # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Ç –ª–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
      overlapping_bookings = Booking.joins(:service_point)
                                   .where(service_point: service_point)
                                   .where(booking_date: date)
                                   .where('start_time < ? AND end_time > ?', end_datetime.strftime('%H:%M'), start_time)
                                   .where.not(status_id: BookingStatus.canceled_statuses)
      
      # –ï—Å–ª–∏ –Ω–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ—Å—Ç–∞ - –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω
      if overlapping_bookings.count < available_posts.count
        available_posts_count += 1
      end
    end
    
    {
      available: available_posts_count > 0,
      reason: available_posts_count > 0 ? nil : '–í—Å–µ –ø–æ—Å—Ç—ã –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–Ω—è—Ç—ã –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è',
      available_posts_count: available_posts_count,
      total_posts_count: available_posts.count,
      category_contact: {
        phone: service_point.contact_phone_for_category(category_id),
        email: service_point.contact_email_for_category(category_id)
      }
    }
  end
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å CategoryFilterService**
  ```ruby
  # app/services/category_filter_service.rb
  class CategoryFilterService
    def self.service_points_with_category(category_id, city_id = nil)
      query = ServicePoint.joins(:service_posts)
                          .where(service_posts: { service_category_id: category_id, is_active: true })
                          .where(is_active: true)
      
      query = query.where(city_id: city_id) if city_id.present?
      
      query.distinct.includes(:city, :partner, service_posts: :service_category)
    end
    
    def self.available_time_slots_by_category(service_point_id, date, category_id, duration = 60)
      service_point = ServicePoint.find(service_point_id)
      posts = service_point.posts_for_category(category_id)
      
      return [] if posts.empty?
      
      # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      available_slots = []
      
      posts.each do |post|
        post_slots = generate_slots_for_post(post, date, duration)
        available_slots.concat(post_slots)
      end
      
      # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
      available_slots.uniq.sort
    end
    
    private
    
    def self.generate_slots_for_post(post, date, duration)
      # –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
      # –£—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å—Ç–∞
      # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    end
  end
  ```

### 1.5 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤

- [ ] **–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ä–æ—É—Ç—ã**
  ```ruby
  # config/routes.rb
  namespace :api do
    namespace :v1 do
      resources :service_points do
        collection do
          get :by_category
        end
        
        member do
          get :posts_by_category
          patch :category_contacts, to: 'service_points#update_category_contacts'
        end
      end
      
      # –ù–æ–≤—ã–π endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
      post 'availability/check_with_category', to: 'availability#check_with_category'
    end
  end
  ```

---

## üé® –≠–¢–ê–ü 2: FRONTEND - –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–°

### 2.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ TypeScript

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è ServicePost**
  ```typescript
  // src/types/models.ts
  interface ServicePost {
    id: number;
    service_point_id: number;
    post_number: number;
    name: string;
    service_category_id: number; // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –ø–æ–ª–µ (—É–±–∏—Ä–∞–µ–º ?)
    service_category: ServiceCategory;
    slot_duration: number;
    is_active: boolean;
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  }
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è ServicePoint**
  ```typescript
  // src/types/models.ts
  interface ServicePoint {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    category_contacts: {
      [categoryId: string]: {
        phone: string;
        email?: string;
      };
    };
  }
  
  interface CategoryContact {
    phone: string;
    email?: string;
  }
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –¥–ª—è Booking**
  ```typescript
  // src/types/booking.ts
  interface BookingFormData {
    // –î–æ–±–∞–≤–ª—è–µ–º –ü–ï–†–í–´–ú —à–∞–≥–æ–º –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    service_category_id: number; // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –ø–æ–ª–µ
    city_id: number | null;
    service_point_id: number | null;
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  }
  
  interface Booking {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    service_category_id?: number;
    service_category?: ServiceCategory;
  }
  ```

### 2.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API —Å–ª–æ—è

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å servicePoints.api.ts**
  ```typescript
  // src/api/servicePoints.api.ts
  getServicePointsByCategory: builder.query<
    { data: ServicePoint[]; total_count: number }, 
    { categoryId: number; cityId?: number }
  >({
    query: ({ categoryId, cityId }) => ({
      url: 'service_points/by_category',
      params: { category_id: categoryId, city_id: cityId }
    }),
    providesTags: ['ServicePoint']
  }),
  
  getPostsByCategory: builder.query<
    { 
      data: ServicePost[]; 
      category_contact: { phone?: string; email?: string } 
    }, 
    { servicePointId: number; categoryId: number }
  >({
    query: ({ servicePointId, categoryId }) => 
      `service_points/${servicePointId}/posts_by_category?category_id=${categoryId}`,
    providesTags: ['ServicePost']
  }),
  
  updateCategoryContacts: builder.mutation<
    { success: boolean; category_contacts: Record<string, CategoryContact> },
    { id: number; category_contacts: Record<string, CategoryContact> }
  >({
    query: ({ id, category_contacts }) => ({
      url: `service_points/${id}/category_contacts`,
      method: 'PATCH',
      body: { category_contacts }
    }),
    invalidatesTags: ['ServicePoint']
  })
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å availability.api.ts**
  ```typescript
  // src/api/availability.api.ts
  export const availabilityApi = baseApi.injectEndpoints({
    endpoints: (builder) => ({
      checkAvailabilityWithCategory: builder.mutation<
        {
          available: boolean;
          reason?: string;
          available_posts_count: number;
          total_posts_count: number;
          category_contact: { phone?: string; email?: string };
        },
        {
          servicePointId: number;
          date: string;
          startTime: string;
          duration: number;
          categoryId: number;
        }
      >({
        query: (data) => ({
          url: 'availability/check_with_category',
          method: 'POST',
          body: data
        })
      })
    })
  });
  
  export const { useCheckAvailabilityWithCategoryMutation } = availabilityApi;
  ```

### 2.3 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] **–°–æ–∑–¥–∞—Ç—å CategorySelectionStep (–ü–ï–†–í–´–ô –®–ê–ì)**
  ```typescript
  // src/pages/bookings/components/CategorySelectionStep.tsx
  interface CategorySelectionStepProps {
    formData: BookingFormData;
    updateFormData: (data: Partial<BookingFormData>) => void;
    onNext: () => void;
  }
  
  const CategorySelectionStep: React.FC<CategorySelectionStepProps> = ({
    formData,
    updateFormData,
    onNext
  }) => {
    const { data: categories } = useGetServiceCategoriesQuery({ active: true });
    
    const handleCategorySelect = (categoryId: number) => {
      updateFormData({ 
        service_category_id: categoryId,
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        city_id: null,
        service_point_id: null
      });
      onNext();
    };
    
    return (
      <Box>
        <Typography variant="h6" gutterBottom>
          –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —É—Å–ª—É–≥
        </Typography>
        
        <Grid container spacing={2}>
          {categories?.data.map((category) => (
            <Grid item xs={12} sm={6} md={4} key={category.id}>
              <Card 
                sx={{ 
                  cursor: 'pointer',
                  border: formData.service_category_id === category.id ? 2 : 1,
                  borderColor: formData.service_category_id === category.id ? 'primary.main' : 'divider'
                }}
                onClick={() => handleCategorySelect(category.id)}
              >
                <CardContent>
                  <Typography variant="h6">{category.name}</Typography>
                  {category.description && (
                    <Typography variant="body2" color="text.secondary">
                      {category.description}
                    </Typography>
                  )}
                </CardContent>
              </Card>
            </Grid>
          ))}
        </Grid>
        
        {!formData.service_category_id && (
          <Alert severity="info" sx={{ mt: 2 }}>
            –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Å–ª—É–≥ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
          </Alert>
        )}
      </Box>
    );
  };
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å CityServicePointStep**
  ```typescript
  // src/pages/bookings/components/CityServicePointStep.tsx
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const { data: servicePointsData } = useGetServicePointsByCategoryQuery({
    categoryId: formData.service_category_id!,
    cityId: formData.city_id || undefined
  }, {
    skip: !formData.service_category_id || !formData.city_id
  });
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  const { data: selectedCategory } = useGetServiceCategoryByIdQuery(
    formData.service_category_id?.toString() || '',
    { skip: !formData.service_category_id }
  );
  
  return (
    <Box>
      {selectedCategory && (
        <Alert severity="info" sx={{ mb: 2 }}>
          –í—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: <strong>{selectedCategory.name}</strong>
        </Alert>
      )}
      
      {/* –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ –∏ —Ç–æ—á–∫–∏ */}
      {/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é */}
    </Box>
  );
  ```

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å DateTimeStep**
  ```typescript
  // src/pages/bookings/components/DateTimeStep.tsx
  
  const [checkAvailabilityWithCategory] = useCheckAvailabilityWithCategoryMutation();
  
  const checkAvailability = useCallback(async (date: Date, time: string) => {
    if (!formData.service_point_id || !formData.service_category_id) return;
    
    try {
      const result = await checkAvailabilityWithCategory({
        servicePointId: formData.service_point_id,
        date: date.toISOString().split('T')[0],
        startTime: time,
        duration: estimatedDuration,
        categoryId: formData.service_category_id
      }).unwrap();
      
      setAvailabilityInfo(result);
      
      if (result.available) {
        updateFormData({ booking_date: date.toISOString().split('T')[0], start_time: time });
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:', error);
    }
  }, [formData.service_point_id, formData.service_category_id, estimatedDuration]);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  {availabilityInfo?.category_contact?.phone && (
    <Alert severity="info" sx={{ mt: 2 }}>
      –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {availabilityInfo.category_contact.phone}
    </Alert>
  )}
  ```

### 2.4 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ NewBookingWithAvailabilityPage

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —à–∞–≥–æ–≤**
  ```typescript
  // src/pages/bookings/NewBookingWithAvailabilityPage.tsx
  
  const STEPS = [
    {
      id: 'category-selection',
      label: '–¢–∏–ø —É—Å–ª—É–≥',
      component: CategorySelectionStep,
    },
    {
      id: 'city-service-point',
      label: '–í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ –∏ —Ç–æ—á–∫–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è',
      component: CityServicePointStep,
    },
    {
      id: 'date-time',
      label: '–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è',
      component: DateTimeStep,
    },
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏
  ];
  
  const initialFormData: BookingFormData = {
    service_category_id: 0, // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
    city_id: null,
    service_point_id: null,
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  };
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–≥–æ–≤
  const isStepValid = (stepIndex: number): boolean => {
    switch (stepIndex) {
      case 0: // Category selection
        return formData.service_category_id > 0;
      case 1: // City and service point
        return formData.city_id !== null && formData.service_point_id !== null;
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏
    }
  };
  ```

### 2.5 –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å ServicePointFormPage - —à–∞–≥ PostsStep**
  ```typescript
  // src/pages/service-points/components/PostsStep.tsx
  
  interface PostFormData {
    post_number: number;
    name: string;
    service_category_id: number; // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –ø–æ–ª–µ
    slot_duration: number;
    is_active: boolean;
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  }
  
  const PostsStep: React.FC = () => {
    const { data: categories } = useGetServiceCategoriesQuery({ active: true });
    
    return (
      <Box>
        <Typography variant="h6" gutterBottom>
          –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å—Ç–æ–≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
        </Typography>
        
        {posts.map((post, index) => (
          <Card key={index} sx={{ mb: 2 }}>
            <CardContent>
              {/* –°–µ–ª–µ–∫—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –ø–æ–ª–µ */}
              <FormControl fullWidth required sx={{ mb: 2 }}>
                <InputLabel>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥</InputLabel>
                <Select
                  value={post.service_category_id || ''}
                  onChange={(e) => updatePost(index, 'service_category_id', Number(e.target.value))}
                  error={!post.service_category_id}
                >
                  {categories?.data.map((category) => (
                    <MenuItem key={category.id} value={category.id}>
                      {category.name}
                    </MenuItem>
                  ))}
                </Select>
                {!post.service_category_id && (
                  <FormHelperText error>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ª—É–≥ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</FormHelperText>
                )}
              </FormControl>
              
              {/* –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–æ—Å—Ç–∞ */}
            </CardContent>
          </Card>
        ))}
      </Box>
    );
  };
  ```

- [ ] **–°–æ–∑–¥–∞—Ç—å CategoryContactsStep**
  ```typescript
  // src/pages/service-points/components/CategoryContactsStep.tsx
  
  const CategoryContactsStep: React.FC<{ servicePointId: number }> = ({ servicePointId }) => {
    const { data: servicePoint } = useGetServicePointByIdQuery(servicePointId.toString());
    const { data: categories } = useGetServiceCategoriesQuery({ active: true });
    const [updateCategoryContacts] = useUpdateCategoryContactsMutation();
    
    const [contacts, setContacts] = useState<Record<string, CategoryContact>>({});
    
    useEffect(() => {
      if (servicePoint?.category_contacts) {
        setContacts(servicePoint.category_contacts);
      }
    }, [servicePoint]);
    
    const handleSave = async () => {
      try {
        await updateCategoryContacts({
          id: servicePointId,
          category_contacts: contacts
        }).unwrap();
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
      } catch (error) {
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
      }
    };
    
    return (
      <Box>
        <Typography variant="h6" gutterBottom>
          –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        </Typography>
        
        {categories?.data.map((category) => (
          <Card key={category.id} sx={{ mb: 2 }}>
            <CardContent>
              <Typography variant="subtitle1" gutterBottom>
                {category.name}
              </Typography>
              
              <Grid container spacing={2}>
                <Grid item xs={12} md={6}>
                  <TextField
                    fullWidth
                    label="–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω"
                    value={contacts[category.id]?.phone || ''}
                    onChange={(e) => setContacts(prev => ({
                      ...prev,
                      [category.id]: { ...prev[category.id], phone: e.target.value }
                    }))}
                    placeholder="+380671234567"
                  />
                </Grid>
                
                <Grid item xs={12} md={6}>
                  <TextField
                    fullWidth
                    label="Email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
                    value={contacts[category.id]?.email || ''}
                    onChange={(e) => setContacts(prev => ({
                      ...prev,
                      [category.id]: { ...prev[category.id], email: e.target.value }
                    }))}
                    placeholder="category@example.com"
                  />
                </Grid>
              </Grid>
            </CardContent>
          </Card>
        ))}
        
        <Button
          variant="contained"
          onClick={handleSave}
          sx={{ mt: 2 }}
        >
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã
        </Button>
      </Box>
    );
  };
  ```

---

## üß™ –≠–¢–ê–ü 3: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –í–ê–õ–ò–î–ê–¶–ò–Ø

### 3.1 Backend —Ç–µ—Å—Ç—ã

- [ ] **–¢–µ—Å—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π**
  ```ruby
  # spec/migrations/service_category_posts_spec.rb
  describe 'ServiceCategory migrations' do
    it 'assigns default category to existing posts' do
      # –¢–µ—Å—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    end
    
    it 'makes service_category_id required' do
      # –¢–µ—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª—è
    end
  end
  ```

- [ ] **–¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π**
  ```ruby
  # spec/models/service_post_spec.rb
  describe ServicePost do
    it 'requires service_category' do
      post = build(:service_post, service_category: nil)
      expect(post).not_to be_valid
      expect(post.errors[:service_category_id]).to include("can't be blank")
    end
    
    it 'filters posts by category' do
      category1 = create(:service_category)
      category2 = create(:service_category)
      
      post1 = create(:service_post, service_category: category1)
      post2 = create(:service_post, service_category: category2)
      
      expect(ServicePost.by_category(category1.id)).to include(post1)
      expect(ServicePost.by_category(category1.id)).not_to include(post2)
    end
  end
  ```

### 3.2 –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å seeds**
  ```ruby
  # db/seeds/service_categories_and_posts.rb
  
  # –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  tire_service = ServiceCategory.find_or_create_by!(
    name: '–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂',
    description: '–£—Å–ª—É–≥–∏ –ø–æ –∑–∞–º–µ–Ω–µ –∏ —Ä–µ–º–æ–Ω—Ç—É —à–∏–Ω',
    sort_order: 1
  )
  
  car_wash = ServiceCategory.find_or_create_by!(
    name: '–ê–≤—Ç–æ–º–æ–π–∫–∞',
    description: '–£—Å–ª—É–≥–∏ –ø–æ –º–æ–π–∫–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π',
    sort_order: 2
  )
  
  car_service = ServiceCategory.find_or_create_by!(
    name: '–°–¢–û',
    description: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ —Ä–µ–º–æ–Ω—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π',
    sort_order: 3
  )
  
  # –ù–∞–∑–Ω–∞—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—Å—Ç–∞–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
  ServicePoint.find_each do |service_point|
    # –ù–∞–∑–Ω–∞—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—Å—Ç–∞–º
    service_point.service_posts.each_with_index do |post, index|
      category = [tire_service, car_wash, car_service][index % 3]
      post.update!(service_category: category)
    end
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã
    service_point.update!(
      category_contacts: {
        tire_service.id.to_s => { phone: '+380671111111', email: 'tire@example.com' },
        car_wash.id.to_s => { phone: '+380672222222', email: 'wash@example.com' },
        car_service.id.to_s => { phone: '+380673333333', email: 'service@example.com' }
      }
    )
  end
  ```

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] **–í–°–ï –ø–æ—Å—Ç—ã –∏–º–µ—é—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (NOT NULL)**
- [ ] –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- [ ] –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- [ ] JSON –ø–æ–ª–µ category_contacts –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ç–æ—á–∫–∏
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä—å

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å–Ω–∏–∑–∏–ª–∞—Å—å
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±—É—á–µ–Ω—ã –Ω–æ–≤–æ–º—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É

---

## üìù –£–ü–†–û–©–ï–ù–ò–Ø –ù–ê –û–°–ù–û–í–ï –£–¢–û–ß–ù–ï–ù–ò–ô

1. **‚úÖ JSON –ø–æ–ª–µ –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã** - —É–ø—Ä–æ—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î
2. **‚úÖ –û–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞ –ø–æ—Å—Ç** - —É–ø—Ä–æ—â–∞–µ—Ç –ª–æ–≥–∏–∫—É –∏ UI
3. **‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è** - –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **‚úÖ –ë–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤** - —É–ø—Ä–æ—â–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞**: üü° –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π 