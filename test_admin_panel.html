<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        button {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            border: none;
            color: white;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .info { background: rgba(33, 150, 243, 0.3); }
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-section {
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        h3 {
            margin-top: 0;
            color: #FFD700;
        }
    </style>
</head>
<body>
    <h1>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</h1>
    
    <div class="container">
        <h2>üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
        <button onclick="login()">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
        <button onclick="checkAuth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        <button onclick="logout()">–í—ã–π—Ç–∏</button>
        <div id="auth-status" class="status"></div>
    </div>

    <div class="container">
        <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
        <div class="test-section">
            <h3>API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <button onclick="testUsersAPI()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button onclick="testCreateUser()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <div id="users-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>ü§ù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏</h2>
        <div class="test-section">
            <h3>API –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</h3>
            <button onclick="testPartnersAPI()">–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</button>
            <button onclick="testCreatePartner()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</button>
            <div id="partners-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>üè¢ –°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</h2>
        <div class="test-section">
            <h3>API —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫</h3>
            <button onclick="testServicePointsAPI()">–ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
            <div id="service-points-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>üìä –î–∞—à–±–æ—Ä–¥</h2>
        <div class="test-section">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
            <button onclick="openDashboard()">–û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥</button>
            <button onclick="openUsers()">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button onclick="openPartners()">–ü–∞—Ä—Ç–Ω–µ—Ä—ã</button>
            <button onclick="openServicePoints()">–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001';
        const APP_BASE = 'http://localhost:3008';
        const TOKEN_KEY = 'tvoya_shina_auth_token';

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('auth-status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }

        function showResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function login() {
            try {
                showStatus('üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É...', 'info');
                
                const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        auth: {
                            login: 'test@test.com',
                            password: 'password'
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    localStorage.setItem(TOKEN_KEY, data.auth_token);
                    showStatus('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É! –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω.', 'success');
                    console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', data.user);
                } else {
                    showStatus('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É: ' + (data.message || data.error), 'error');
                }
            } catch (error) {
                showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É: ' + error.message, 'error');
            }
        }

        function checkAuth() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (token) {
                showStatus(`‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ${token.substring(0, 20)}...`, 'success');
            } else {
                showStatus('‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.', 'error');
            }
        }

        function logout() {
            localStorage.removeItem(TOKEN_KEY);
            showStatus('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω, —Ç–æ–∫–µ–Ω —É–¥–∞–ª–µ–Ω', 'success');
        }

        async function testUsersAPI() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                showResult('users-result', { error: '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!' });
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/users`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                showResult('users-result', { 
                    status: response.status, 
                    data: data,
                    success: response.ok 
                });
            } catch (error) {
                showResult('users-result', { error: error.message });
            }
        }

        async function testCreateUser() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                showResult('users-result', { error: '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!' });
                return;
            }

            try {
                const userData = {
                    user: {
                        email: `test.user.${Date.now()}@example.com`,
                        first_name: '–¢–µ—Å—Ç',
                        last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                        role_id: 3, // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                        is_active: true,
                        password: 'password123',
                        password_confirmation: 'password123'
                    }
                };

                const response = await fetch(`${API_BASE}/api/v1/users`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                showResult('users-result', { 
                    status: response.status, 
                    data: data,
                    success: response.ok 
                });
            } catch (error) {
                showResult('users-result', { error: error.message });
            }
        }

        async function testPartnersAPI() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                showResult('partners-result', { error: '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!' });
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/partners`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                showResult('partners-result', { 
                    status: response.status, 
                    data: data,
                    success: response.ok 
                });
            } catch (error) {
                showResult('partners-result', { error: error.message });
            }
        }

        async function testCreatePartner() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                showResult('partners-result', { error: '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!' });
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/partners/create_test`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                showResult('partners-result', { 
                    status: response.status, 
                    data: data,
                    success: response.ok 
                });
            } catch (error) {
                showResult('partners-result', { error: error.message });
            }
        }

        async function testServicePointsAPI() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                showResult('service-points-result', { error: '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!' });
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/service_points`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                showResult('service-points-result', { 
                    status: response.status, 
                    data: data,
                    success: response.ok 
                });
            } catch (error) {
                showResult('service-points-result', { error: error.message });
            }
        }

        function openDashboard() {
            window.open(`${APP_BASE}/dashboard`, '_blank');
        }

        function openUsers() {
            window.open(`${APP_BASE}/users`, '_blank');
        }

        function openPartners() {
            window.open(`${APP_BASE}/partners`, '_blank');
        }

        function openServicePoints() {
            window.open(`${APP_BASE}/service-points`, '_blank');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkAuth();
        }
    </script>
</body>
</html>
