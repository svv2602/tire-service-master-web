<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–±—ç–∫–µ–Ω–¥</h1>
        
        <div class="test-section info">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤</h3>
            <button onclick="checkServices()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã</button>
            <div id="services-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üîê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h3>
            <div>
                <input type="email" id="email" placeholder="Email" value="test@example.com">
                <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="password123">
                <input type="text" id="firstName" placeholder="–ò–º—è" value="–¢–µ—Å—Ç">
                <input type="text" id="lastName" placeholder="–§–∞–º–∏–ª–∏—è" value="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
                <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="+380501234567">
            </div>
            <button onclick="registerUser()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <button onclick="loginUser()">–õ–æ–≥–∏–Ω</button>
            <button onclick="getProfile()" id="profileBtn" disabled>–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
            <div id="auth-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üìç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
            <button onclick="getRegions()">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–≥–∏–æ–Ω—ã</button>
            <button onclick="getServicePoints()">–ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
            <button onclick="getServices()">–ü–æ–ª—É—á–∏—Ç—å —É—Å–ª—É–≥–∏</button>
            <div id="data-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üîÑ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <button onclick="runFullTest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            <div id="full-test-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let authToken = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken && { 'Authorization': `Bearer ${authToken}` }),
                        ...options.headers
                    },
                    ...options
                });

                const data = await response.json();
                return { success: response.ok, status: response.status, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
        async function checkServices() {
            const result = document.getElementById('services-result');
            result.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            try {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ API
                const apiCheck = await fetch(`${API_BASE}/health`);
                const apiStatus = apiCheck.ok ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
                const frontendCheck = await fetch('http://localhost:3000');
                const frontendStatus = frontendCheck.ok ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                
                result.textContent = `API (–ø–æ—Ä—Ç 8000): ${apiStatus}\n–§—Ä–æ–Ω—Ç–µ–Ω–¥ (–ø–æ—Ä—Ç 3000): ${frontendStatus}`;
                result.className = 'result success';
            } catch (error) {
                result.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                result.className = 'result error';
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            const result = document.getElementById('auth-result');
            result.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            
            const timestamp = Date.now();
            const email = document.getElementById('email').value || `test${timestamp}@example.com`;
            const password = document.getElementById('password').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const phone = document.getElementById('phone').value || `+38050${timestamp.toString().slice(-7)}`;
            
            const response = await apiRequest('/clients/register', {
                method: 'POST',
                body: JSON.stringify({
                    client: {
                        email,
                        password,
                        password_confirmation: password,
                        first_name: firstName,
                        last_name: lastName,
                        phone
                    }
                })
            });

            if (response.success) {
                authToken = response.data.auth_token;
                document.getElementById('profileBtn').disabled = false;
                result.textContent = `‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!\n–¢–æ–∫–µ–Ω: ${authToken.substring(0, 20)}...\n–°–æ–æ–±—â–µ–Ω–∏–µ: ${response.data.message}`;
                result.className = 'result success';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –ª–æ–≥–∏–Ω–∞
                document.getElementById('email').value = email;
            } else {
                result.textContent = `‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:\n${JSON.stringify(response.data || response.error, null, 2)}`;
                result.className = 'result error';
            }
        }

        // –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loginUser() {
            const result = document.getElementById('auth-result');
            result.textContent = '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É...';
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            const response = await apiRequest('/auth/login', {
                method: 'POST',
                body: JSON.stringify({
                    auth: { login: email, password }
                })
            });

            if (response.success) {
                authToken = response.data.auth_token;
                document.getElementById('profileBtn').disabled = false;
                result.textContent = `‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${response.data.user.first_name} ${response.data.user.last_name}\n–†–æ–ª—å: ${response.data.user.role}\n–¢–æ–∫–µ–Ω: ${authToken.substring(0, 20)}...`;
                result.className = 'result success';
            } else {
                result.textContent = `‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:\n${JSON.stringify(response.data || response.error, null, 2)}`;
                result.className = 'result error';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        async function getProfile() {
            const result = document.getElementById('auth-result');
            result.textContent = '–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è...';
            
            const response = await apiRequest('/users/me');

            if (response.success) {
                result.textContent = `‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–µ–Ω:\nID: ${response.data.id}\nEmail: ${response.data.email}\n–ò–º—è: ${response.data.first_name} ${response.data.last_name}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${response.data.phone}\n–ê–∫—Ç–∏–≤–µ–Ω: ${response.data.is_active ? '–¥–∞' : '–Ω–µ—Ç'}`;
                result.className = 'result success';
            } else {
                result.textContent = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:\n${JSON.stringify(response.data || response.error, null, 2)}`;
                result.className = 'result error';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤
        async function getRegions() {
            const result = document.getElementById('data-result');
            result.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤...';
            
            const response = await apiRequest('/regions');

            if (response.success) {
                const count = response.data.data?.length || 0;
                result.textContent = `‚úÖ –†–µ–≥–∏–æ–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${count}\n–ü–∞–≥–∏–Ω–∞—Ü–∏—è: ${response.data.pagination ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}`;
                result.className = 'result success';
            } else {
                result.textContent = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–≥–∏–æ–Ω–æ–≤:\n${JSON.stringify(response.data || response.error, null, 2)}`;
                result.className = 'result error';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫
        async function getServicePoints() {
            const result = document.getElementById('data-result');
            result.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫...';
            
            const response = await apiRequest('/service_points');

            if (response.success) {
                const count = response.data.data?.length || 0;
                result.textContent = `‚úÖ –°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${count}\n–ü–∞–≥–∏–Ω–∞—Ü–∏—è: ${response.data.pagination ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}`;
                if (count > 0) {
                    result.textContent += `\n–ü—Ä–∏–º–µ—Ä —Ç–æ—á–∫–∏: ${response.data.data[0].name}`;
                }
                result.className = 'result success';
            } else {
                result.textContent = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫:\n${JSON.stringify(response.data || response.error, null, 2)}`;
                result.className = 'result error';
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Å–ª—É–≥
        async function getServices() {
            const result = document.getElementById('data-result');
            result.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥...';
            
            const response = await apiRequest('/services');

            if (response.success) {
                const count = response.data.data?.length || 0;
                result.textContent = `‚úÖ –£—Å–ª—É–≥–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${count}`;
                if (count > 0) {
                    result.textContent += `\n–ü—Ä–∏–º–µ—Ä —É—Å–ª—É–≥–∏: ${response.data.data[0].name}`;
                }
                result.className = 'result success';
            } else {
                result.textContent = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥:\n${JSON.stringify(response.data || response.error, null, 2)}`;
                result.className = 'result error';
            }
        }

        // –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        async function runFullTest() {
            const result = document.getElementById('full-test-result');
            result.textContent = '–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...\n';
            result.className = 'result info';
            
            const tests = [
                { name: 'Health Check', func: () => apiRequest('/health') },
                { name: '–†–µ–≥–∏–æ–Ω—ã', func: () => apiRequest('/regions') },
                { name: '–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏', func: () => apiRequest('/service_points') },
                { name: '–£—Å–ª—É–≥–∏', func: () => apiRequest('/services') }
            ];
            
            let passed = 0;
            let total = tests.length;
            
            for (const test of tests) {
                try {
                    const response = await test.func();
                    if (response.success) {
                        result.textContent += `‚úÖ ${test.name}: –£–°–ü–ï–•\n`;
                        passed++;
                    } else {
                        result.textContent += `‚ùå ${test.name}: –û–®–ò–ë–ö–ê\n`;
                    }
                } catch (error) {
                    result.textContent += `‚ùå ${test.name}: –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï - ${error.message}\n`;
                }
            }
            
            result.textContent += `\n=== –ò–¢–û–ì–û ===\n–ü—Ä–æ–π–¥–µ–Ω–æ: ${passed}/${total}\n–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: ${Math.round(passed/total*100)}%`;
            result.className = passed === total ? 'result success' : 'result error';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            checkServices();
        };
    </script>
</body>
</html> 