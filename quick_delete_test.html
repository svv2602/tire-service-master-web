<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        button.delete { background: #dc3545; }
        button.delete:hover { background: #c82333; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏</h1>
    
    <div class="section">
        <h3>–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞</h3>
        <button onclick="setAuthToken()">üîë –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        <div id="auth-status"></div>
    </div>

    <div class="section">
        <h3>–®–∞–≥ 2: –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ API</h3>
        <button onclick="testDirectDelete()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É ID=12</button>
        <div id="delete-status"></div>
    </div>

    <div class="section">
        <h3>–õ–æ–≥–∏</h3>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <pre id="logs"></pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        const TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyLCJyb2xlIjoiYWRtaW4iLCJleHAiOjE3NDk2NjQ3MzQsInRva2VuX3R5cGUiOiJhY2Nlc3MifQ.SRwkltPo-hx-Ugh1Rt9nIYfPudE5aqYQToiLuQ1NeOc';

        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').textContent = '';
        }

        function setAuthToken() {
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–ª—é—á–µ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
                localStorage.setItem('tvoya_shina_token', TOKEN);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = {
                    id: 2,
                    email: 'admin@test.com',
                    first_name: 'Admin',
                    last_name: 'User',
                    role: 'admin',
                    is_active: true
                };
                localStorage.setItem('tvoya_shina_user', JSON.stringify(user));
                
                document.getElementById('auth-status').innerHTML = 
                    '<div class="success">‚úÖ –¢–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!</div>';
                
                log('üîë –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ localStorage');
                log(`   –ö–ª—é—á: tvoya_shina_token`);
                log(`   –ó–Ω–∞—á–µ–Ω–∏–µ: ${TOKEN.substring(0, 30)}...`);
                log(`   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin@test.com`);
                
            } catch (error) {
                document.getElementById('auth-status').innerHTML = 
                    '<div class="error">‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞</div>';
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        async function testDirectDelete() {
            const token = localStorage.getItem('tvoya_shina_token');
            if (!token) {
                document.getElementById('delete-status').innerHTML = 
                    '<div class="error">‚ùå –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω!</div>';
                return;
            }

            try {
                log('üóëÔ∏è –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏ ID=12 –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 3...');
                
                const url = `${API_BASE}/service_categories/3/services/12`;
                log(`üì§ URL –∑–∞–ø—Ä–æ—Å–∞: ${url}`);
                log(`üîê –¢–æ–∫–µ–Ω: ${token.substring(0, 30)}...`);

                const response = await fetch(url, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);

                if (response.ok || response.status === 204) {
                    document.getElementById('delete-status').innerHTML = 
                        '<div class="success">‚úÖ –£—Å–ª—É–≥–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!</div>';
                    log('‚úÖ –£—Å–ª—É–≥–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π API –∑–∞–ø—Ä–æ—Å');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É—Å–ª—É–≥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏–ª–∞—Å—å
                    setTimeout(checkServicesList, 1000);
                    
                } else {
                    const errorText = await response.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${errorText}`);
                    document.getElementById('delete-status').innerHTML = 
                        `<div class="error">‚ùå –û—à–∏–±–∫–∞ ${response.status}: ${errorText}</div>`;
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
                document.getElementById('delete-status').innerHTML = 
                    `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        async function checkServicesList() {
            try {
                log('üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è...');
                
                const token = localStorage.getItem('tvoya_shina_token');
                const response = await fetch(`${API_BASE}/service_categories/3/services`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ª—É–≥ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ 3: ${data.data?.length || 0}`);
                
                if (data.data) {
                    const serviceIds = data.data.map(s => s.id);
                    log(`üìã ID —É—Å–ª—É–≥: [${serviceIds.join(', ')}]`);
                    
                    if (serviceIds.includes(12)) {
                        log('‚ö†Ô∏è –£—Å–ª—É–≥–∞ ID=12 –≤—Å–µ –µ—â–µ –≤ —Å–ø–∏—Å–∫–µ - —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ');
                    } else {
                        log('‚úÖ –£—Å–ª—É–≥–∞ ID=12 –±–æ–ª—å—à–µ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ - —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ');
                    }
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–∏—Å–∫–∞: ${error.message}`);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            const token = localStorage.getItem('tvoya_shina_token');
            if (token) {
                document.getElementById('auth-status').innerHTML = 
                    '<div class="info">‚ÑπÔ∏è –¢–æ–∫–µ–Ω —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>';
                log('‚ÑπÔ∏è –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω –≤ localStorage');
            } else {
                log('‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å');
            }
        };
    </script>
</body>
</html>
