<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Services API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border: 1px solid #ff9999; }
        .success { background: #e6ffe6; border: 1px solid #99ff99; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { white-space: pre-wrap; }
        .log { background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug Services API</h1>
        
        <div>
            <h3>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            <button onclick="testLogin()">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
            <button onclick="checkToken()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
            <button onclick="clearAuth()">–û—á–∏—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
        </div>

        <div>
            <h3>API —Ç–µ—Å—Ç—ã</h3>
            <button onclick="testServiceCategories()">–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥</button>
            <button onclick="testDirectFetch()">–ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å —Å fetch</button>
            <button onclick="testWithoutAuth()">–ó–∞–ø—Ä–æ—Å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</button>
        </div>

        <div>
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
            <div id="results"></div>
        </div>

        <div>
            <h3>–õ–æ–≥–∏</h3>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        const TOKEN_KEY = 'tvoya_shina_token';

        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function showResult(data, isError = false) {
            const results = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isError ? 'error' : 'success'}`;
            resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            results.appendChild(resultDiv);
        }

        async function testLogin() {
            log('üîê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@test.com',
                        password: 'admin123'
                    })
                });

                log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem(TOKEN_KEY, data.auth_token);
                    log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                    showResult(data);
                } else {
                    const error = await response.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error}`);
                    showResult({ error }, true);
                }
            } catch (error) {
                log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}`);
                showResult({ error: error.message }, true);
            }
        }

        function checkToken() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (token) {
                log(`‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ${token.substring(0, 50)}...`);
                showResult({ token: token.substring(0, 50) + '...', length: token.length });
            } else {
                log('‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
                showResult({ error: '–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω' }, true);
            }
        }

        function clearAuth() {
            localStorage.removeItem(TOKEN_KEY);
            log('üóëÔ∏è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—á–∏—â–µ–Ω–∞');
            showResult({ message: '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—á–∏—â–µ–Ω–∞' });
        }

        async function testServiceCategories() {
            log('üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Å–ª—É–≥...');
            
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                log('‚ùå –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞, —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                showResult({ error: '–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/service_categories`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json'
                    }
                });

                log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${data.data?.length || 0} –∫–∞—Ç–µ–≥–æ—Ä–∏–π`);
                    showResult(data);
                } else {
                    const error = await response.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ API: ${error}`);
                    showResult({ error }, true);
                }
            } catch (error) {
                log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: ${error.message}`);
                showResult({ error: error.message }, true);
            }
        }

        async function testDirectFetch() {
            log('üéØ –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ API...');
            
            try {
                const response = await fetch(`${API_BASE}/service_categories`);
                log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${response.status}`);
                
                const data = await response.json();
                showResult(data, !response.ok);
            } catch (error) {
                log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`);
                showResult({ error: error.message }, true);
            }
        }

        async function testWithoutAuth() {
            log('üîì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            try {
                const response = await fetch(`${API_BASE}/service_categories`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                log(`–°—Ç–∞—Ç—É—Å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${response.status}`);
                const data = await response.json();
                showResult(data, !response.ok);
            } catch (error) {
                log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`);
                showResult({ error: error.message }, true);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkToken();
        };
    </script>
</body>
</html>
