<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section h3 { margin-top: 0; color: #333; }
        button { 
            padding: 10px 15px; 
            margin: 5px; 
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .primary { background: #1976d2; color: white; }
        .success { background: #4caf50; color: white; }
        .danger { background: #f44336; color: white; }
        .info { background: #2196f3; color: white; }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .result.success { background: #e8f5e8; color: #2e7d32; }
        .result.error { background: #ffebee; color: #c62828; }
        .auth-status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .auth-status.success { background: #e8f5e8; color: #2e7d32; }
        .auth-status.error { background: #ffebee; color: #c62828; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</h1>
        
        <div class="section">
            <h3>üìä –°—Ç–∞—Ç—É—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</h3>
            <div id="auth-status" class="auth-status error">‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
            <button class="primary" onclick="login()">–í–æ–π—Ç–∏ (test@test.com)</button>
            <button class="danger" onclick="logout()">–í—ã–π—Ç–∏</button>
            <button class="info" onclick="checkAuth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        </div>

        <div class="section">
            <h3>üë• –¢–µ—Å—Ç API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <button class="success" onclick="testUsers()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button class="info" onclick="testUserById()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID</button>
            <div id="users-result" class="result"></div>
        </div>

        <div class="section">
            <h3>üè¢ –¢–µ—Å—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö API</h3>
            <button class="success" onclick="testServicePoints()">–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
            <button class="success" onclick="testPartners()">–ü–∞—Ä—Ç–Ω–µ—Ä—ã</button>
            <button class="success" onclick="testBookings()">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <div id="admin-result" class="result"></div>
        </div>

        <div class="section">
            <h3>üåê –ü–µ—Ä–µ—Ö–æ–¥—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
            <button class="info" onclick="openAdmin()">–û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
            <button class="info" onclick="openUsers()">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</button>
            <button class="info" onclick="openServicePoints()">–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏</button>
        </div>

        <div class="section">
            <h3>üìù –õ–æ–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
            <div id="log-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        const FRONTEND_BASE = 'http://localhost:3008';
        const TOKEN_KEY = 'tvoya_shina_auth_token';
        const USER_KEY = 'tvoya_shina_user';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log-result');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.className = `result ${type}`;
            console.log(logEntry);
        }

        function updateAuthStatus() {
            const token = localStorage.getItem(TOKEN_KEY);
            const user = localStorage.getItem(USER_KEY);
            const statusEl = document.getElementById('auth-status');
            
            if (token && user) {
                statusEl.className = 'auth-status success';
                statusEl.innerHTML = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                try {
                    const userData = JSON.parse(user);
                    statusEl.innerHTML += ` (${userData.email}, ${userData.role})`;
                } catch (e) {
                    log('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                }
            } else {
                statusEl.className = 'auth-status error';
                statusEl.innerHTML = '‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
            }
        }

        async function login() {
            log('üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É...');
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        auth: {
                            login: 'test@test.com',
                            password: 'test123'
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è frontend
                    localStorage.setItem(TOKEN_KEY, data.tokens.access);
                    localStorage.setItem(USER_KEY, JSON.stringify(data.user));
                    
                    log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É!', 'success');
                    log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.user.first_name} ${data.user.last_name} (${data.user.role})`);
                    updateAuthStatus();
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function logout() {
            localStorage.removeItem(TOKEN_KEY);
            localStorage.removeItem(USER_KEY);
            log('‚úÖ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
            updateAuthStatus();
        }

        function checkAuth() {
            const token = localStorage.getItem(TOKEN_KEY);
            const user = localStorage.getItem(USER_KEY);
            
            if (token && user) {
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage', 'success');
                log(`–¢–æ–∫–µ–Ω: ${token.substring(0, 30)}...`);
            } else {
                log('‚ùå –î–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
            }
            updateAuthStatus();
        }

        async function testUsers() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                document.getElementById('users-result').textContent = '‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
                document.getElementById('users-result').className = 'result error';
                return;
            }

            try {
                log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
                const response = await fetch(`${API_BASE}/api/v1/users?page=1&per_page=5`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                if (response.ok) {
                    const result = `‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.data?.length || 0}
–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${data.pagination?.total_count || 'N/A'}
–ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.data?.[0]?.email || 'N/A'}`;
                    
                    document.getElementById('users-result').textContent = result;
                    document.getElementById('users-result').className = 'result success';
                    log('‚úÖ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                } else {
                    document.getElementById('users-result').textContent = `‚ùå –û—à–∏–±–∫–∞: ${JSON.stringify(data, null, 2)}`;
                    document.getElementById('users-result').className = 'result error';
                    log('‚ùå –û—à–∏–±–∫–∞ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
                }
            } catch (error) {
                document.getElementById('users-result').textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
                document.getElementById('users-result').className = 'result error';
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}`, 'error');
            }
        }

        async function testUserById() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                document.getElementById('users-result').textContent = '‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
                document.getElementById('users-result').className = 'result error';
                return;
            }

            try {
                log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID...');
                const response = await fetch(`${API_BASE}/api/v1/users/1`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                if (response.ok) {
                    const result = `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:
ID: ${data.data?.id}
Email: ${data.data?.email}
–†–æ–ª—å: ${data.data?.role}
–ê–∫—Ç–∏–≤–µ–Ω: ${data.data?.is_active ? '–î–∞' : '–ù–µ—Ç'}`;
                    
                    document.getElementById('users-result').textContent = result;
                    document.getElementById('users-result').className = 'result success';
                    log('‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    document.getElementById('users-result').textContent = `‚ùå –û—à–∏–±–∫–∞: ${JSON.stringify(data, null, 2)}`;
                    document.getElementById('users-result').className = 'result error';
                    log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID', 'error');
                }
            } catch (error) {
                document.getElementById('users-result').textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
                document.getElementById('users-result').className = 'result error';
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`, 'error');
            }
        }

        async function testServicePoints() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                document.getElementById('admin-result').textContent = '‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
                document.getElementById('admin-result').className = 'result error';
                return;
            }

            try {
                log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫...');
                const response = await fetch(`${API_BASE}/api/v1/service_points?page=1&per_page=3`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                const result = `–°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ç–æ—á–∫–∏: ${response.ok ? '‚úÖ' : '‚ùå'}
–°—Ç–∞—Ç—É—Å: ${response.status}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${data.data?.length || 0}
–û–±—â–µ–µ: ${data.pagination?.total_count || 'N/A'}`;
                
                document.getElementById('admin-result').textContent = result;
                document.getElementById('admin-result').className = response.ok ? 'result success' : 'result error';
                log(`${response.ok ? '‚úÖ' : '‚ùå'} API —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫: ${response.status}`, response.ok ? 'success' : 'error');
            } catch (error) {
                document.getElementById('admin-result').textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                document.getElementById('admin-result').className = 'result error';
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ç–æ—á–µ–∫: ${error.message}`, 'error');
            }
        }

        async function testPartners() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                document.getElementById('admin-result').textContent = '‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
                document.getElementById('admin-result').className = 'result error';
                return;
            }

            try {
                log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤...');
                const response = await fetch(`${API_BASE}/api/v1/partners?page=1&per_page=3`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                const result = `–ü–∞—Ä—Ç–Ω–µ—Ä—ã: ${response.ok ? '‚úÖ' : '‚ùå'}
–°—Ç–∞—Ç—É—Å: ${response.status}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${data.data?.length || 0}`;
                
                document.getElementById('admin-result').textContent = result;
                document.getElementById('admin-result').className = response.ok ? 'result success' : 'result error';
                log(`${response.ok ? '‚úÖ' : '‚ùå'} API –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤: ${response.status}`, response.ok ? 'success' : 'error');
            } catch (error) {
                document.getElementById('admin-result').textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                document.getElementById('admin-result').className = 'result error';
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤: ${error.message}`, 'error');
            }
        }

        async function testBookings() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                document.getElementById('admin-result').textContent = '‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è';
                document.getElementById('admin-result').className = 'result error';
                return;
            }

            try {
                log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π...');
                const response = await fetch(`${API_BASE}/api/v1/bookings?page=1&per_page=3`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                const result = `–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ${response.ok ? '‚úÖ' : '‚ùå'}
–°—Ç–∞—Ç—É—Å: ${response.status}
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${data.data?.length || 0}`;
                
                document.getElementById('admin-result').textContent = result;
                document.getElementById('admin-result').className = response.ok ? 'result success' : 'result error';
                log(`${response.ok ? '‚úÖ' : '‚ùå'} API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${response.status}`, response.ok ? 'success' : 'error');
            } catch (error) {
                document.getElementById('admin-result').textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                document.getElementById('admin-result').className = 'result error';
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ${error.message}`, 'error');
            }
        }

        function openAdmin() {
            window.open(`${FRONTEND_BASE}/admin`, '_blank');
            log('üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å');
        }

        function openUsers() {
            window.open(`${FRONTEND_BASE}/admin/users`, '_blank');
            log('üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏');
        }

        function openServicePoints() {
            window.open(`${FRONTEND_BASE}/admin/service-points`, '_blank');
            log('üåê –û—Ç–∫—Ä—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateAuthStatus();
        };
    </script>
</body>
</html>
