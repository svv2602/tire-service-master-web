<!DOCTYPE html>
<html>
<head>
    <title>–ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: #4CAF50; background: #f0f8f0; padding: 10px; border-radius: 5px; }
        .error { color: #f44336; background: #fff0f0; padding: 10px; border-radius: 5px; }
        .info { color: #2196F3; background: #f0f8ff; padding: 10px; border-radius: 5px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞</h1>
    <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –∏—Å—Ç–µ–∫—à–∏–º —Ç–æ–∫–µ–Ω–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.</p>
    
    <div>
        <button onclick="checkCurrentState()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
        <button onclick="getNewToken()">üîë –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω</button>
        <button onclick="openFrontend()">üöÄ –û—Ç–∫—Ä—ã—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥</button>
        <button onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        const API_BASE = 'http://localhost:8000';
        const TOKEN_KEY = 'tvoya_shina_token';
        const USER_KEY = 'tvoya_shina_user';
        const REFRESH_KEY = 'tvoya_shina_refresh_token';

        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="${type}"><pre>${JSON.stringify(message, null, 2)}</pre></div>`;
        }

        function checkCurrentState() {
            const token = localStorage.getItem(TOKEN_KEY);
            const user = localStorage.getItem(USER_KEY);
            const refreshToken = localStorage.getItem(REFRESH_KEY);
            
            const state = {
                —Ç–æ–∫–µ–Ω: token ? token.substring(0, 30) + '...' : '–ù–ï–¢',
                –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user ? JSON.parse(user).first_name + ' ' + JSON.parse(user).last_name : '–ù–ï–¢',
                refresh_—Ç–æ–∫–µ–Ω: refreshToken ? refreshToken.substring(0, 30) + '...' : '–ù–ï–¢',
                –≤—Å–µ_–∫–ª—é—á–∏: Object.keys(localStorage).filter(key => key.includes('tvoya_shina')),
                —Å—Ç–∞—Ç—É—Å: (token && user) ? '–ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï' : '–¢–†–ï–ë–£–ï–¢–°–Ø –í–•–û–î'
            };
            
            showResult(state, token && user ? 'success' : 'error');
        }

        async function getNewToken() {
            showResult('üîÑ –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        auth: { email: 'admin@test.com', password: 'admin' }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                    localStorage.setItem(TOKEN_KEY, data.auth_token);
                    localStorage.setItem(USER_KEY, JSON.stringify(data.user));
                    if (data.refresh_token) {
                        localStorage.setItem(REFRESH_KEY, data.refresh_token);
                    }
                    
                    showResult({
                        —Å—Ç–∞—Ç—É—Å: '–£–°–ü–ï–•',
                        —Å–æ–æ–±—â–µ–Ω–∏–µ: '–¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!',
                        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: data.user.first_name + ' ' + data.user.last_name,
                        —Ä–æ–ª—å: data.user.role,
                        —Ç–æ–∫–µ–Ω_—Å–æ—Ö—Ä–∞–Ω–µ–Ω: true,
                        refresh_—Ç–æ–∫–µ–Ω_—Å–æ—Ö—Ä–∞–Ω–µ–Ω: !!data.refresh_token,
                        –¥–µ–π—Å—Ç–≤–∏–µ: '–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞'
                    }, 'success');
                    
                } else {
                    showResult({ 
                        —Å—Ç–∞—Ç—É—Å: '–û–®–ò–ë–ö–ê',
                        –¥–µ—Ç–∞–ª–∏: data 
                    }, 'error');
                }
            } catch (error) {
                showResult({ 
                    —Å—Ç–∞—Ç—É—Å: '–û–®–ò–ë–ö–ê –°–ï–¢–ò',
                    —Å–æ–æ–±—â–µ–Ω–∏–µ: error.message 
                }, 'error');
            }
        }

        function openFrontend() {
            const token = localStorage.getItem(TOKEN_KEY);
            if (!token) {
                showResult({
                    —Å—Ç–∞—Ç—É—Å: '–û–®–ò–ë–ö–ê',
                    —Å–æ–æ–±—â–µ–Ω–∏–µ: '–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω!'
                }, 'error');
                return;
            }
            
            window.open('http://localhost:3008/users', '_blank');
            showResult({
                —Å—Ç–∞—Ç—É—Å: '–£–°–ü–ï–•',
                —Å–æ–æ–±—â–µ–Ω–∏–µ: '–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ',
                —Å—Å—ã–ª–∫–∞: 'http://localhost:3008/users'
            }, 'success');
        }

        function clearAll() {
            localStorage.removeItem(TOKEN_KEY);
            localStorage.removeItem(USER_KEY);
            localStorage.removeItem(REFRESH_KEY);
            
            showResult({
                —Å—Ç–∞—Ç—É—Å: '–û–ß–ò–©–ï–ù–û',
                —Å–æ–æ–±—â–µ–Ω–∏–µ: '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã',
                –æ—Å—Ç–∞–≤—à–∏–µ—Å—è_–∫–ª—é—á–∏: Object.keys(localStorage).filter(key => key.includes('tvoya_shina'))
            }, 'info');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkCurrentState();
        };
    </script>
</body>
</html> 